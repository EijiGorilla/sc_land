"use strict";(self.webpackChunksc_land=self.webpackChunksc_land||[]).push([[8521],{32500:(e,t,i)=>{i.d(t,{I:()=>f,b:()=>y});var n=i(37081),s=i(33280),r=i(94951),o=i(14801),a=i(74876),l=i(116),d=i(41012),c=i(58406),h=i(98634),u=i(64201),p=i(19253),_=i(4760),m=i(53178);function y(e){const t=new u.kG,{vertex:i,fragment:y}=t;return(0,d.Sv)(i,e),t.include(r.w,e),t.include(a.H,e),t.include(s.f5,e),t.include(o.R,e),t.include(m.j,e),t.attributes.add(_.T.POSITION,"vec3"),t.attributes.add(_.T.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(_.T.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.terrainDepthTest&&t.varyings.add("depth","float"),i.main.add(h.H`
    vpos = position;
    ${e.terrainDepthTest?"depth = (view * vec4(vpos, 1.0)).z;":""}
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}`),y.uniforms.add(new p.A("tex",(e=>e.texture)),new c.p("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),y.include(l.Y),y.main.add(h.H`
    discardBySlice(vpos);
    ${e.terrainDepthTest?"terrainDepthTest(depth);":""}
    ${e.output===n.H_.ObjectAndLayerIdColor?"fragColor = vec4(0, 0, 0, 1);\n           return;":""}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos);`),t}const f=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}))},55364:(e,t,i)=>{function n(){return[1,0,0,1,0,0]}function s(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}i.d(t,{Ue:()=>n,d9:()=>s});const r=[1,0,0,1,0,0];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:r,clone:s,create:n,createView:function(e,t){return new Float64Array(e,t,6)},fromValues:function(e,t,i,n,s,r){return[e,t,i,n,s,r]}},Symbol.toStringTag,{value:"Module"}))},50264:(e,t,i)=>{i.d(t,{Iu:()=>d,Jp:()=>o,U1:()=>a,U_:()=>r,Us:()=>c,bA:()=>l,yR:()=>s});var n=i(24204);function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function r(e,t){const i=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5];let l=i*r-n*s;return l?(l=1/l,e[0]=r*l,e[1]=-n*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-r*o)*l,e[5]=(n*o-i*a)*l,e):null}function o(e,t,i){const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],d=i[0],c=i[1],h=i[2],u=i[3],p=i[4],_=i[5];return e[0]=n*d+r*c,e[1]=s*d+o*c,e[2]=n*h+r*u,e[3]=s*h+o*u,e[4]=n*p+r*_+a,e[5]=s*p+o*_+l,e}function a(e,t,i){const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],d=Math.sin(i),c=Math.cos(i);return e[0]=n*c+r*d,e[1]=s*c+o*d,e[2]=n*-d+r*c,e[3]=s*-d+o*c,e[4]=a,e[5]=l,e}function l(e,t,i){const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],d=i[0],c=i[1];return e[0]=n*d,e[1]=s*d,e[2]=r*c,e[3]=o*c,e[4]=a,e[5]=l,e}function d(e,t,i){const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],d=i[0],c=i[1];return e[0]=n,e[1]=s,e[2]=r,e[3]=o,e[4]=n*d+r*c+a,e[5]=s*d+o*c+l,e}function c(e,t){const i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=-i,e[3]=n,e[4]=0,e[5]=0,e}function h(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}const u=o,p=h;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],d=t[0],c=t[1],h=t[2],u=t[3],p=t[4],_=t[5],m=(0,n.bn)();return Math.abs(i-d)<=m*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(s-c)<=m*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(r-h)<=m*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-u)<=m*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(a-p)<=m*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-_)<=m*Math.max(1,Math.abs(l),Math.abs(_))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:c,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},identity:s,invert:r,mul:u,multiply:o,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},multiplyScalarAndAdd:function(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e},rotate:a,scale:l,set:function(e,t,i,n,s,r,o){return e[0]=t,e[1]=i,e[2]=n,e[3]=s,e[4]=r,e[5]=o,e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:p,subtract:h,translate:d},Symbol.toStringTag,{value:"Module"}))},67593:(e,t,i)=>{i.d(t,{E:()=>u,H:()=>h});var n=i(29303),s=i(21389),r=i(13611),o=i(32035);const a=(0,i(12400).Ue)(),l=(0,s.Ue)(),d=(0,s.Ue)(),c=(0,s.Ue)();function h(e,t,i){return(0,o.i)(a,t[0],t[1],1),(0,o.q)(a,a,(0,n.p4)(l,i)),0===a[2]?(0,r.t8)(e,a[0],a[1]):(0,r.t8)(e,a[0]/a[2],a[1]/a[2])}function u(e,t,i){return p(d,t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),p(c,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]),(0,n.Jp)(e,(0,n.uj)(d,d),c),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e}function p(e,t,i,s,r,d,c,h,u){(0,n.t8)(e,t,s,d,i,r,c,1,1,1),(0,o.i)(a,h,u,1),(0,n.uj)(l,e);const[p,_,m]=(0,o.q)(a,a,(0,n.p4)(l,l));return(0,n.t8)(l,p,0,0,0,_,0,0,0,m),(0,n.Jp)(e,l,e)}},76335:(e,t,i)=>{i.d(t,{Sy:()=>l,UZ:()=>o,XZ:()=>a,x3:()=>d});var n=i(29909),s=i(78952),r=i(77981);const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new n.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:s.Z.WebMercator}),minus180Line:new n.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:s.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new n.Z({paths:[[[180,-180],[180,180]]],spatialReference:s.Z.WGS84}),minus180Line:new n.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:s.Z.WGS84})}};function a(e,t){return Math.ceil((e-t)/(2*t))}function l(e,t){const i=d(e);for(const n of i)for(const e of n)e[0]+=t;return e}function d(e){return(0,r.oU)(e)?e.rings:e.paths}},47991:(e,t,i)=>{i.d(t,{SR:()=>h,Ui:()=>c});var n=i(46784),s=i(65156),r=i(376),o=i(69662),a=i(77981),l=i(76335),d=i(92975);function c(e){return u(e,!0)}function h(e){return u(e,!1)}function u(e,t){if(null==e)return null;const i=e.spatialReference,s=(0,d.C5)(i),o=(0,n.AK)(e)?e.toJSON():e;if(!s)return o;const c=(0,d.sS)(i)?102100:4326,h=l.UZ[c].maxX,u=l.UZ[c].minX;if((0,a.wp)(o))return _(o,h,u);if((0,a.aW)(o))return o.points=o.points.map((e=>_(e,h,u))),o;if((0,a.YX)(o))return p(o,s);if((0,a.oU)(o)||(0,a.l9)(o)){const e=(0,r.$P)(b,o),i={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},n=(0,l.XZ)(i.xmin,u)*(2*h),s=0===n?o:(0,l.Sy)(o,n);return i.xmin+=n,i.xmax+=n,i.xmax>h?v(s,h,t):i.xmin<u?v(s,u,t):s}return o}function p(e,t){if(!t)return e;const i=function(e,t){const i=[],{ymin:n,ymax:s,xmin:r,xmax:o}=e,a=e.xmax-e.xmin,[l,d]=t.valid,{x:c,frameId:h}=m(e.xmin,t),{x:u,frameId:p}=m(e.xmax,t),_=c===u&&a>0;if(a>2*d){const e={xmin:r<o?c:u,ymin:n,xmax:d,ymax:s},t={xmin:l,ymin:n,xmax:r<o?u:c,ymax:s},a={xmin:0,ymin:n,xmax:d,ymax:s},_={xmin:l,ymin:n,xmax:0,ymax:s},m=[],f=[];y(e,a)&&m.push(h),y(e,_)&&f.push(h),y(t,a)&&m.push(p),y(t,_)&&f.push(p);for(let i=h+1;i<p;i++)m.push(i),f.push(i);i.push(new g(e,[h]),new g(t,[p]),new g(a,m),new g(_,f))}else c>u||_?i.push(new g({xmin:c,ymin:n,xmax:d,ymax:s},[h]),new g({xmin:l,ymin:n,xmax:u,ymax:s},[p])):i.push(new g({xmin:c,ymin:n,xmax:u,ymax:s},[h]));return i}(e,t).map((e=>e.extent));return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}function _(e,t,i){if(Array.isArray(e)){const n=e[0];if(n>t){const i=(0,l.XZ)(n,t);e[0]=n+i*(-2*t)}else if(n<i){const t=(0,l.XZ)(n,i);e[0]=n+t*(-2*i)}}else{const n=e.x;if(n>t){const i=(0,l.XZ)(n,t);e.x+=i*(-2*t)}else if(n<i){const t=(0,l.XZ)(n,i);e.x+=t*(-2*i)}}return e}function m(e,t){const[i,n]=t.valid,s=2*n;let r,o=0;return e>n?(r=Math.ceil(Math.abs(e-n)/s),e-=r*s,o=r):e<i&&(r=Math.ceil(Math.abs(e-i)/s),e+=r*s,o=-r),{x:e,frameId:o}}function y(e,t){const{xmin:i,ymin:n,xmax:s,ymax:r}=t;return f(e,i,n)&&f(e,i,r)&&f(e,s,r)&&f(e,s,n)}function f(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function v(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=!(0,a.l9)(e);if(n&&(0,o.Zy)(e),i)return(new x).cut(e,t);const s=n?e.rings:e.paths,r=n?4:2,l=s.length,d=-2*t;for(let o=0;o<l;o++){const e=s[o];if(e&&e.length>=r){const t=[];for(const i of e)t.push([i[0]+d,i[1]]);s.push(t)}}return n?e.rings=s:e.paths=s,e}class g{constructor(e,t){this.extent=e,this.frameIds=t}}const b=(0,s.Ue)();class x{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,t){let i;if(this._xCut=t,e.rings)this._closed=!0,i=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,i=e.paths,this._minPts=2}for(const s of i){if(!s||s.length<this._minPts)continue;let e=!0;for(const t of s)e?(this.moveTo(t),e=!1):this.lineTo(t);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),i=[];for(const s of this._linesIn)s&&s.length>=this._minPts&&i.push(s);const n=-2*this._xCut;for(const s of this._linesOut)if(s&&s.length>=this._minPts){for(const e of s)e[0]+=n;i.push(s)}return this._closed?e.rings=i:e.paths=i,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const t=this._side(e[0]);if(t*this._prevSide==-1){const i=this._intersect(this._prevPt,e);this._lineTo(this._xCut,i,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}close(){const e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,t,i){this._closed?(this._lineIn.push([i<=0?e:this._xCut,t]),this._lineOut.push([i>=0?e:this._xCut,t])):(i<=0&&this._lineIn.push([e,t]),i>=0&&this._lineOut.push([e,t]))}_lineTo(e,t,i){this._closed?(T(this._lineIn,i<=0?e:this._xCut,t),T(this._lineOut,i>=0?e:this._xCut,t)):i<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):i>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}_checkClosingPt(e){const t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,t){const i=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+i*(t[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function T(e,t,i){const n=e.length;n>1&&e[n-1][0]===t&&e[n-2][0]===t?e[n-1][1]=i:e.push([t,i])}},59568:(e,t,i)=>{i.d(t,{L:()=>h});var n=i(27366),s=i(7138),r=i(49861),o=(i(93169),i(32718),i(84936),i(69912)),a=i(80885),l=i(79803),d=i(65156),c=i(47991);let h=class extends s.Z{constructor(e){super(e)}get bounds(){const e=this.coords;return null==e?.extent?null:(0,d.oJ)(e.extent)}get coords(){const e=this.element.georeference?.coords;return(0,l.projectOrLoad)(e,this.spatialReference).geometry}get normalizedCoords(){return a.Z.fromJSON((0,c.Ui)(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?(0,d.oJ)(e):null}};(0,n._)([(0,r.Cb)()],h.prototype,"spatialReference",void 0),(0,n._)([(0,r.Cb)()],h.prototype,"element",void 0),(0,n._)([(0,r.Cb)()],h.prototype,"bounds",null),(0,n._)([(0,r.Cb)()],h.prototype,"coords",null),(0,n._)([(0,r.Cb)()],h.prototype,"normalizedCoords",null),(0,n._)([(0,r.Cb)()],h.prototype,"normalizedBounds",null),h=(0,n._)([(0,o.j)("esri.layers.support.MediaElementView")],h)},42069:(e,t,i)=>{i.d(t,{A:()=>c});var n=i(27366),s=i(42537),r=i(66978),o=i(94172),a=i(49861),l=(i(93169),i(32718),i(84936),i(69912)),d=i(5354);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,d.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,s.kB)((()=>e.abort()))),await(0,o.N1)((()=>this.view.defaultsFromMap?.heightModelInfoReady),t),(0,r.k_)(t);const i=(0,d.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,n._)([(0,a.Cb)()],t.prototype,"view",void 0),(0,n._)([(0,a.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,n._)([(0,l.j)("esri.views.3d.layers.LayerView3D")],t),t}},48521:(e,t,i)=>{i.r(t),i.d(t,{default:()=>X});var n=i(27366),s=i(10064),r=i(42537),o=(i(93169),i(67593)),a=i(66978),l=i(94172),d=i(49861),c=(i(32718),i(84936),i(69912)),h=i(21389),u=i(65156),p=i(59568),_=i(26279),m=i(42069),y=i(7138),f=i(16889),v=i(92026),g=i(68860),b=i(50264),x=i(55364),T=i(13611),w=i(6644),E=i(46634),C=i(1614),I=i(87888),O=i(34010);const P=Symbol(),M=Symbol();let D=class extends y.Z{get updating(){return this._updatingHandles.updating}get _preferredInteractionTool(){return this.options?.tool??"transform"}get _toolType(){switch(this._preferredInteractionTool){case"transform":return"transform-3d";case"reshape":return"reshape-3d"}}get _validatedSelectedElement(){const e=this.selectedElement;if(!e)return null;const{layer:{source:t}}=this;return t?"hasElement"in t?t.hasElement(e)?e:null:t===e?e:null:null}constructor(e){super(e),this.enabled=!1,this._updatingHandles=new E.R,this._isOpacityToggled=!1,this._factor=1,this._tool=null,this._object=null,this._createToolAbortController=null,this._onPointerMove=(0,a.Ds)((async e=>{const t=await this._updatingHandles.addPromise(this._findElementAtScreenPoint(e));this.destroyed||(this.removeHandles(M),t&&t!==this.selectedElement&&(this.view.cursor="pointer",this.addHandles((0,r.kB)((()=>this.view.cursor=null)),M)))})),this._tmpMat2=(0,x.Ue)(),this._tmpVec2=(0,w.Ue)()}destroy(){this._createToolAbortController=(0,v.IM)(this._createToolAbortController)}initialize(){this.addHandles([(0,r.ed)(this._updatingHandles),this._updatingHandles.add((()=>this.enabled),(e=>this._enableDisable(e)),l.nn),this._updatingHandles.add((()=>this._preferredInteractionTool),(e=>this._preferredInteractionToolChanged(e)))])}_enableDisable(e){if(!e)return void this.removeHandles(P);this._dynamicImports();const{view:t}=this,i=new I.G7;i.add(I.Lk.undo,(()=>{this._object?.operations?.undo(),this._object?.emit("modified-externally")})),i.add(I.Lk.redo,(()=>{this._object?.operations?.redo(),this._object?.emit("modified-externally")})),i.addToggle(I.Lk.preserveAspectRatio,(e=>{"transform-3d"===this._tool?.type&&(this._tool.preserveAspectRatio="key-down"===e.type)})),i.addToggle(I.Lk.rotateIncrements,(e=>{"transform-3d"===this._tool?.type&&(this._tool.snapRotation="key-down"===e.type)})),i.add(I.Lk.toggleOpacity,(()=>{const e=this._object?.element;e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)})),i.add(I.Lk.moveUp,(()=>this._move(0,this._factor))),i.add(I.Lk.moveDown,(()=>this._move(0,-this._factor))),i.add(I.Lk.moveRight,(()=>this._move(this._factor,0))),i.add(I.Lk.moveLeft,(()=>this._move(-this._factor,0))),i.addToggle(I.Lk.factorModifier,(e=>this._factor="key-down"===e.type?10:1)),this._isOpacityToggled=!1,this.addHandles([i.register(t,C.f.TOOL),(0,r.kB)((()=>{this._isOpacityToggled&&this.selectedElement&&(this.selectedElement.opacity*=2,this._isOpacityToggled=!1)})),t.on("immediate-click",(e=>this._onClick(e)),C.f.TOOL),t.on("pointer-move",(e=>this._onPointerMove(e).catch((()=>{}))),C.f.TOOL),this._updatingHandles.add((()=>this._validatedSelectedElement),((e,t)=>{t&&e!==t&&this._isOpacityToggled&&(t.opacity*=2,this._isOpacityToggled=!1),this._selectedElementChanged(e)}),l.nn),(0,r.kB)((()=>{t.cursor=null,this._removeTool()}))],P)}async _onClick(e){await this._updatingHandles.addPromise(e.async((async()=>{const t=await this._findElementAtScreenPoint(e);this.destroyed||(t&&e.stopPropagation(),this.selectedElement=t,this.selectedElement&&(this.view.cursor=null))})))}async _selectedElementChanged(e){e?.georeference?this._object?.element!==e&&await this._updatingHandles.addPromise(this._recreateTool()):this._removeTool()}async _recreateTool(){this._createToolAbortController=(0,v.IM)(this._createToolAbortController),this._removeTool();const e=this._validatedSelectedElement;if(!e)return;const t=new AbortController;this._createToolAbortController=t;const{ManipulatedObject3DMediaElement:i,ExtentTransformTool:n,ReshapeTool3D:s}=await this._dynamicImports();if(t.signal.aborted)return;const{view:o,layer:a,_toolType:l}=this;switch(this._object=new i({view:o,layer:a,element:e,tool:this._preferredInteractionTool}),l){case"transform-3d":{this._tool=new n({view:o,object:this._object});const e=o.inputManager;e.isModifierKeyDown(I.Lk.rotateIncrements.key)&&(this._tool.snapRotation=!0),e.isModifierKeyDown(I.Lk.preserveAspectRatio.key)&&(this._tool.preserveAspectRatio=!0)}break;case"reshape-3d":{const e=(0,O.u)(o);this.addHandles(e,this._tool);const{snappingManager:t}=e;this._tool=new s({view:o,object:this._object,enableMidpoints:!1,enableZShape:!1,snappingManager:t,enableMoveObject:!1,autoHideManipulators:!0,enableDeleteVertices:!1})}}this.addHandles([(0,r.kB)((()=>{this._object=(0,v.SC)(this._object),this._tool&&(o.tools.remove(this._tool),this._tool=null)}))],this._tool),o.addAndActivateTool(this._tool)}_preferredInteractionToolChanged(e){const{_tool:t}=this;if(!t)return;if(this._toolType!==t.type)return void this._updatingHandles.addPromise(this._recreateTool());const{_object:i}=this;i&&(i.tool=e)}async _dynamicImports(){const[{ManipulatedObject3DMediaElement:e},{ExtentTransformTool:t,ReshapeTool3D:n}]=await Promise.all([Promise.all([i.e(7877),i.e(2723),i.e(2582)]).then(i.bind(i,2582)),Promise.all([i.e(9058),i.e(7877),i.e(8103),i.e(6850),i.e(7585),i.e(8875),i.e(3093),i.e(6315),i.e(8035),i.e(6599),i.e(242),i.e(7146)]).then(i.bind(i,28711))]);return{ManipulatedObject3DMediaElement:e,ExtentTransformTool:t,ReshapeTool3D:n}}async _findElementAtScreenPoint(e){const t=(await this.view.hitTest(e,{include:[this.layer]})).results[0];return"media"===t?.type?t.element:null}_removeTool(){this._tool&&this.removeHandles(this._tool)}_move(e,t){const{view:i,_object:n}=this,s=n?.operations;if(!s)return;const r=i.overlayPixelSizeInMapUnits(i.pointsOfInterest.focus.location)*(0,g.c9)(i.spatialReference)/(0,g.c9)(s.data.spatialReference),{_tmpMat2:o,_tmpVec2:a}=this,l=(0,b.Us)(o,(0,f.Vl)(360-this.view.camera.heading)),d=(0,T.t8)(a,r*e,r*t);(0,T.iu)(d,d,l),s.move(d[0],d[1],0),n.emit("modified-externally")}};(0,n._)([(0,d.Cb)({constructOnly:!0})],D.prototype,"view",void 0),(0,n._)([(0,d.Cb)({constructOnly:!0})],D.prototype,"layer",void 0),(0,n._)([(0,d.Cb)()],D.prototype,"selectedElement",void 0),(0,n._)([(0,d.Cb)()],D.prototype,"enabled",void 0),(0,n._)([(0,d.Cb)()],D.prototype,"options",void 0),(0,n._)([(0,d.Cb)()],D.prototype,"updating",null),(0,n._)([(0,d.Cb)()],D.prototype,"_preferredInteractionTool",null),(0,n._)([(0,d.Cb)()],D.prototype,"_validatedSelectedElement",null),D=(0,n._)([(0,c.j)("esri.views.3d.layers.support.MediaLayerInteraction")],D);var S=i(19265),A=i(91526),R=i(2952),L=i(78289),H=i(39077),j=i(1487),U=i(78485),k=i(4760),V=i(8080),Z=i(67581);let z=class extends y.Z{constructor(){super(...arguments),this.tool="transform"}};(0,n._)([(0,d.Cb)()],z.prototype,"tool",void 0),z=(0,n._)([(0,c.j)("esri.views.3d.layers.support.MediaLayerInteractionOptions")],z);const N=e=>{let t=class extends e{constructor(){super(...arguments),this.layer=null,this.interactive=!1,this.interactionOptions=new z,this.selectedElement=null}};return(0,n._)([(0,d.Cb)()],t.prototype,"layer",void 0),(0,n._)([(0,d.Cb)()],t.prototype,"interactive",void 0),(0,n._)([(0,d.Cb)()],t.prototype,"interactionOptions",void 0),(0,n._)([(0,d.Cb)()],t.prototype,"selectedElement",void 0),t=(0,n._)([(0,c.j)("esri.views.layers.MediaLayerView")],t),t};var G=i(69787),W=i(8548);let B=class extends((0,m.A)(N(Z.Z))){get interactive(){return this._interaction.enabled}set interactive(e){this._interaction&&(this._interaction.enabled=e)}get selectedElement(){return this._interaction.selectedElement}set selectedElement(e){this._interaction&&(this._interaction.selectedElement=e)}get visibleAtCurrentScale(){return(0,G.GB)(this.layer.effectiveScaleRange,this.view.scale)}constructor(e){super(e),this.type="media-3d",this.drapeSourceType=_.Lw.Features,this.updatePolicy=U.j.ASYNC,this._uidToElement=new Map,this._renderedElements=new Map,this._lastDrapingExtent=null,this._update=(0,a.Ds)((async(e,t,i)=>{const n=await this._collectMediaElements(e,t,i);this._synchronizeRenderElements(n)}),0);const{view:t,layer:i}=e;this._interaction=new D({view:t,layer:i}),this.addHandles((0,l.YP)((()=>this.interactionOptions),(e=>this._interaction.options=e),l.tX))}initialize(){const{view:e,layer:t}=this;this._renderer=e.basemapTerrain.overlayManager.registerGeometryDrapeSource(this);const i=()=>this._updateWithLastDrapingExtent();this.addHandles([(0,r.kB)((()=>e.basemapTerrain.overlayManager.unregisterDrapeSource(this))),(0,l.on)((()=>t.effectiveSource),"change",i),(0,l.on)((()=>t.effectiveSource),"refresh",i)]),this._updatingHandles.add((()=>this.suspended),i)}setDrapingExtent(e,t){this._lastDrapingExtent={overlays:e,spatialReference:t},this._updateWithLastDrapingExtent()}getHit(e){const t=this._uidToElement.get(e);return t?{type:"media",element:t,layer:this.layer}:null}isUpdating(){return super.isUpdating()||this._interaction.updating}_updateWithLastDrapingExtent(){if(null==this._lastDrapingExtent||this.suspended)return void(this._renderer&&this._synchronizeRenderElements(new Set));const{overlays:e,spatialReference:t}=this._lastDrapingExtent;this._updatingHandles.addPromise(this._update(e,t).catch((()=>{})))}async _collectMediaElements(e,t,i){const n=this.layer.effectiveSource;return null==n?new Set:new Set((await Promise.all(e.map((e=>n.queryElements((0,u.HH)(e.extent,t),{signal:i}))))).flat())}_synchronizeRenderElements(e){this._synchronizeRenderElementsRemove(e),this._synchronizeRenderElementsAdd(e)}_synchronizeRenderElementsRemove(e){this._renderedElements.forEach(((t,i)=>{e.has(i)||(this._removeElement(i,t),this.emit("element-render-changed",{element:i}))}))}_synchronizeRenderElementsAdd(e){for(const t of e)this._renderedElements.has(t)||this._createRenderElement(t)}_removeElement(e,t){let{renderData:i,handle:n}=t;this._destroyRenderData(e,i),this._renderedElements.delete(e),this._uidToElement.delete(e.uid),n.remove()}async _createRenderElement(e){const t=new p.L({spatialReference:this.view.spatialReference,element:e}),i={renderData:null,handle:(0,r.AL)([this._updatingHandles.add((()=>e.opacity),(e=>{null!=i.renderData&&i.renderData.material.setParameters({opacity:e})})),this._updatingHandles.add((()=>t.coords),(()=>{null!=i.renderData?this._updateGeometry(t,i,i.renderData):this._initializeRenderData(t,i)})),this._updatingHandles.add((()=>e.content),(()=>this._initializeRenderData(t,i))),(0,r.ed)(t)])};this._renderedElements.set(e,i),this._uidToElement.set(e.uid,e),this._updatingHandles.addPromise(e.load().catch((()=>{}))),this._initializeRenderData(t,i)}_initializeRenderData(e,t){const{coords:i,element:n}=e,{contentWidth:s,contentHeight:r}=n;if(null==i||null==n.content)return void(t.renderData=this._destroyRenderData(n,t.renderData));if(null!=t.renderData)return;const o=this._createTexture(n.content),l=o.load(this.view._stage.renderView.renderingContext);this.view._stage.add(o),(0,a.y8)(l)&&this._updatingHandles.addPromise(l);const d=new V.j({initTextureTransparent:!0,textureId:o.id,opacity:n.opacity,perspectiveInterpolation:!0}),c=this._getPositionAttributeArray(i),h=this._getPerspectiveDivideAttributeArray(c,s,r),u=[0,1,2,0,2,3],p=new R.Z(d,[[k.T.POSITION,new A.a(c,u,3,!0)],[k.T.UV0,new A.a([0,0,1,0,1,1,0,1],u,2,!0)],[k.T.PERSPECTIVEDIVIDE,new A.a(h,u,1,!0)]]),_=new H.z(p,{layerUid:this.layer.uid,graphicUid:n.uid});this._renderer.addGeometries([_],L.T.ADD),t.renderData={renderGeometry:_,texture:o,material:d},this.emit("element-render-changed",{element:n})}_updateGeometry(e,t,i){const{coords:n,element:s}=e;if(null==n||null==s.content)return void(t.renderData=this._destroyRenderData(s,t.renderData));const r=this._getPositionAttributeArray(n);i.renderGeometry.geometry.setAttributeData(k.T.POSITION,r);const o=this._getPerspectiveDivideAttributeArray(r,s.contentWidth,s.contentHeight);i.renderGeometry.geometry.setAttributeData(k.T.PERSPECTIVEDIVIDE,o),i.renderGeometry.geometry.invalidateBoundingInfo(),this._renderer.modifyGeometries([i.renderGeometry],L.$.GEOMETRY),this.emit("element-render-changed",{element:s})}_getPositionAttributeArray(e){const[t,i,n,s]=e.rings[0];return[t[0],t[1],S.gi,s[0],s[1],S.gi,n[0],n[1],S.gi,i[0],i[1],S.gi]}_getPerspectiveDivideAttributeArray(e,t,i){(0,o.E)(F,[0,0,t,0,t,i,0,i],[e[0],e[1],e[3],e[4],e[6],e[7],e[9],e[10]]);const n=F[6]/F[8]*t,s=F[7]/F[8]*i;return[1,1+n,1+n+s,1+s]}_destroyRenderData(e,t){if(null==t)return null;const i=t.texture;return i.unload(),this.view._stage.remove(i),this._renderer.removeGeometries([t.renderGeometry],L.T.REMOVE),this.emit("element-render-changed",{element:e}),null}_createTexture(e){const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,i=e instanceof HTMLImageElement?e.naturalHeight:e.height;if("getFrame"in e)throw new s.Z("media-layer-view-3d","animation is not supported");return new j.x(e,{wrap:{s:W.e8.CLAMP_TO_EDGE,t:W.e8.CLAMP_TO_EDGE},preMultiplyAlpha:!0,width:t,height:i,mipmap:!0,updateCallback:()=>this.view.basemapTerrain.overlayManager.setDrawTexturesDirty()})}get test(){}};(0,n._)([(0,d.Cb)({readOnly:!0})],B.prototype,"type",void 0),(0,n._)([(0,d.Cb)()],B.prototype,"layer",void 0),(0,n._)([(0,d.Cb)()],B.prototype,"interactive",null),(0,n._)([(0,d.Cb)()],B.prototype,"selectedElement",null),(0,n._)([(0,d.Cb)({readOnly:!0})],B.prototype,"visibleAtCurrentScale",null),B=(0,n._)([(0,c.j)("esri.views.3d.layers.MediaLayerView3D")],B);const F=(0,h.Ue)(),X=B},64642:(e,t,i)=>{i.d(t,{IM:()=>a,W1:()=>o,lV:()=>l,wp:()=>r});var n=i(55158),s=i(4760);const r=(0,n.U$)().vec3f(s.T.POSITION),o=(0,n.U$)().vec3f(s.T.POSITION).vec2f(s.T.UV0),a=(0,n.U$)().vec3f(s.T.POSITION).vec4u8(s.T.COLOR),l=(0,n.U$)().vec3f(s.T.POSITION).vec2f(s.T.UV0).vec4u8(s.T.OBJECTANDLAYERIDCOLOR)},8080:(e,t,i)=>{i.d(t,{j:()=>D});var n=i(25158),s=i(37081),r=i(68401),o=i(17363),a=i(56529),l=i(78041),d=i(93822),c=i(97731),h=i(4760),u=i(12594),p=i(64642),_=i(11983),m=i(33236),y=(i(98634),i(82144)),f=i(78914),v=i(14124),g=i(50411),b=i(32500),x=i(36207);class T extends f.A{constructor(e,t,n){super(e,t,new y.J(b.I,(()=>i.e(8957).then(i.bind(i,18957)))),n,w)}_getPipelineState(e,t){const{oitPass:i,output:n,hasOccludees:r,enableOffset:o,cullFace:a}=e,d=i===v.M.NONE,c=i===v.M.FrontFace;return(0,x.sm)({blending:n===s.H_.Color?d?x.xW:(0,l.j7)(i):null,culling:(0,x.zp)(a),depthTest:{func:(0,l.Bh)(i)},depthWrite:(0,l.W$)(e),drawBuffers:(0,l.u_)(i,n),colorWrite:x.gf,stencilWrite:r?g.s3:null,stencilTest:r?t?g.eD:g.RY:null,polygonOffset:d||c?null:(0,l.je)(o)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}const w=new Map([[h.T.POSITION,0],[h.T.UV0,2],[h.T.PERSPECTIVEDIVIDE,3]]);var E=i(27366),C=i(60113),I=i(80848),O=i(5775),P=i(12085);class M extends P.W{constructor(){super(...arguments),this.cullFace=r.Vr.None,this.hasSlicePlane=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=C.I.None,this.emissionSource=I.jo.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,E._)([(0,O.o)({count:r.Vr.COUNT})],M.prototype,"cullFace",void 0),(0,E._)([(0,O.o)()],M.prototype,"hasSlicePlane",void 0),(0,E._)([(0,O.o)()],M.prototype,"enableOffset",void 0),(0,E._)([(0,O.o)()],M.prototype,"writeDepth",void 0),(0,E._)([(0,O.o)()],M.prototype,"hasOccludees",void 0),(0,E._)([(0,O.o)()],M.prototype,"terrainDepthTest",void 0),(0,E._)([(0,O.o)()],M.prototype,"cullAboveTerrain",void 0),(0,E._)([(0,O.o)()],M.prototype,"perspectiveInterpolation",void 0);class D extends _.c{constructor(e){super(e,R),this._configuration=new M,this.vertexAttributeLocations=w,this.supportsEdges=!0,this.produces=new Map([[d.r.OPAQUE_MATERIAL,e=>(0,s.Gy)(e)],[d.r.TRANSPARENT_MATERIAL,e=>(0,s.D5)(e)&&this.parameters.writeDepth],[d.r.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(0,s.D5)(e)&&!this.parameters.writeDepth],[d.r.DRAPED_MATERIAL,e=>(0,s.D5)(e)||(0,s.Gy)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<l.ve,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new S(e)}createBufferWriter(){const e=p.W1.clone();return this.parameters.perspectiveInterpolation&&e.f32(h.T.PERSPECTIVEDIVIDE),new A(e)}}class S extends o.Fj{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.acquireTechnique(T,e)}}class A extends u.G{write(e,t,i,s,r,o){for(const a of this.vertexBufferLayout.fields.keys()){const s=i.get(a);if(s)if(a===h.T.PERSPECTIVEDIVIDE){(0,c.hu)(1===s.size);const e=r.getField(a,n.ly);e&&(0,m.XW)(s,e,o)}else(0,m.i9)(a,s,e,t,r,o)}}}class R extends a.Mt{constructor(){super(...arguments),this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=r.Vr.None,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}},11983:(e,t,i)=>{i.d(t,{c:()=>r});var n=i(56529),s=i(42235);class r extends n.F5{intersect(e,t,i,n,r,o){return(0,s.Bw)(e,i,n,r,void 0,o)}}},67581:(e,t,i)=>{i.d(t,{Z:()=>m});var n=i(27366),s=i(7138),r=i(91505),o=i(79056),a=i(32718),l=i(92026),d=i(67426),c=i(49861),h=(i(93169),i(84936),i(69912)),u=i(46634),p=i(69787);let _=class extends((0,o.IG)((0,d.v)(r.Z.EventedMixin(s.Z)))){constructor(e){super(e),this._updatingHandles=new u.R,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer?.title||"no title";a.Z.getLogger(this).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}}))}destroy(){this._updatingHandles=(0,l.SC)(this._updatingHandles)}get fullOpacity(){return(this.layer?.opacity??1)*(this.parent?.fullOpacity??1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this._updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){const e=this.view.timeExtent,t=this.layer?.visibilityTimeExtent;return!e||!t||!e.intersection(t).isEmpty}canResume(){const e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready&&(0,p.Cy)(e)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){const e=this.parent?.suspended?this.parent.suspendInfo:{};this.view?.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0);const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.Cy)(t)&&this.visibleAtCurrentScale||(e.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(e.outsideVisibilityTimeExtent=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,n._)([(0,c.Cb)()],_.prototype,"view",void 0),(0,n._)([(0,c.Cb)()],_.prototype,"fullOpacity",null),(0,n._)([(0,c.Cb)()],_.prototype,"layer",void 0),(0,n._)([(0,c.Cb)()],_.prototype,"parent",void 0),(0,n._)([(0,c.Cb)({readOnly:!0})],_.prototype,"suspended",null),(0,n._)([(0,c.Cb)({readOnly:!0})],_.prototype,"suspendInfo",null),(0,n._)([(0,c.Cb)({readOnly:!0})],_.prototype,"legendEnabled",null),(0,n._)([(0,c.Cb)({type:Boolean,readOnly:!0})],_.prototype,"updating",null),(0,n._)([(0,c.Cb)({readOnly:!0})],_.prototype,"updatingProgress",null),(0,n._)([(0,c.Cb)()],_.prototype,"updateSuspended",null),(0,n._)([(0,c.Cb)()],_.prototype,"visible",null),(0,n._)([(0,c.Cb)({readOnly:!0})],_.prototype,"visibleAtCurrentScale",null),(0,n._)([(0,c.Cb)({readOnly:!0})],_.prototype,"visibleAtCurrentTimeExtent",null),_=(0,n._)([(0,h.j)("esri.views.layers.LayerView")],_);const m=_}}]);
//# sourceMappingURL=8521.e511fd2a.chunk.js.map