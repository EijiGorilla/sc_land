"use strict";(self.webpackChunksc_land=self.webpackChunksc_land||[]).push([[6372,4397,2463,2170,5140],{84397:(e,t,n)=>{n.d(t,{c:()=>i,g:()=>r});var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}},55364:(e,t,n)=>{function i(){return[1,0,0,1,0,0]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}n.d(t,{Ue:()=>i,d9:()=>r});const o=[1,0,0,1,0,0];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:i,createView:function(e,t){return new Float64Array(e,t,6)},fromValues:function(e,t,n,i,r,o){return[e,t,n,i,r,o]}},Symbol.toStringTag,{value:"Module"}))},50264:(e,t,n)=>{n.d(t,{Iu:()=>d,Jp:()=>s,U1:()=>a,U_:()=>o,Us:()=>h,bA:()=>l,yR:()=>r});var i=n(24204);function r(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function o(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5];let l=n*o-i*r;return l?(l=1/l,e[0]=o*l,e[1]=-i*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*a-o*s)*l,e[5]=(i*s-n*a)*l,e):null}function s(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],d=n[0],h=n[1],p=n[2],c=n[3],u=n[4],v=n[5];return e[0]=i*d+o*h,e[1]=r*d+s*h,e[2]=i*p+o*c,e[3]=r*p+s*c,e[4]=i*u+o*v+a,e[5]=r*u+s*v+l,e}function a(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],d=Math.sin(n),h=Math.cos(n);return e[0]=i*h+o*d,e[1]=r*h+s*d,e[2]=i*-d+o*h,e[3]=r*-d+s*h,e[4]=a,e[5]=l,e}function l(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],d=n[0],h=n[1];return e[0]=i*d,e[1]=r*d,e[2]=o*h,e[3]=s*h,e[4]=a,e[5]=l,e}function d(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],d=n[0],h=n[1];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=i*d+o*h+a,e[5]=r*d+s*h+l,e}function h(e,t){const n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=-n,e[3]=i,e[4]=0,e[5]=0,e}function p(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}const c=s,u=p;Object.freeze(Object.defineProperty({__proto__:null,add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},equals:function(e,t){const n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],d=t[0],h=t[1],p=t[2],c=t[3],u=t[4],v=t[5],_=(0,i.bn)();return Math.abs(n-d)<=_*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-h)<=_*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-p)<=_*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-c)<=_*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-u)<=_*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(l-v)<=_*Math.max(1,Math.abs(l),Math.abs(v))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},fromRotation:h,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},identity:r,invert:o,mul:c,multiply:s,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},multiplyScalarAndAdd:function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e},rotate:a,scale:l,set:function(e,t,n,i,r,o,s){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},sub:u,subtract:p,translate:d},Symbol.toStringTag,{value:"Module"}))},97942:(e,t,n)=>{function i(e){let t,n,i=[],r=!1;return function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(s,i)||(n=e.apply(this,s),t=this,i=s,r=!0),n}}n.d(t,{H:()=>i})},92463:(e,t,n)=>{n.r(t),n.d(t,{hydratedAdapter:()=>l});var i=n(53866),r=n(77577),o=n(848),s=n(80885),a=n(29909);const l={convertToGEGeometry:function(e,t){if(null==t)return null;let n="cache"in t?t.cache._geVersion:void 0;return null==n&&(n=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=n)),n},exportPoint:function(e,t,n){const i=e.hasZ(t),r=e.hasM(t),s=new o.Z({x:e.getPointX(t),y:e.getPointY(t),spatialReference:n});return i&&(s.z=e.getPointZ(t)),r&&(s.m=e.getPointM(t)),s.cache._geVersion=t,s},exportPolygon:function(e,t,n){const i=new s.Z({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return i.cache._geVersion=t,i},exportPolyline:function(e,t,n){const i=new a.Z({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return i.cache._geVersion=t,i},exportMultipoint:function(e,t,n){const i=new r.Z({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:n});return i.cache._geVersion=t,i},exportExtent:function(e,t,n){const r=e.hasZ(t),o=e.hasM(t),s=new i.Z({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:n});if(r){const n=e.getZExtent(t);s.zmin=n.vmin,s.zmax=n.vmax}if(o){const n=e.getMExtent(t);s.mmin=n.vmin,s.mmax=n.vmax}return s.cache._geVersion=t,s}}},2170:(e,t,n)=>{n.r(t),n.d(t,{buffer:()=>M,changeDefaultSpatialReferenceTolerance:()=>Y,clearDefaultSpatialReferenceTolerance:()=>$,clip:()=>d,contains:()=>p,convexHull:()=>P,crosses:()=>c,cut:()=>h,densify:()=>R,difference:()=>C,disjoint:()=>y,distance:()=>u,equals:()=>v,extendedSpatialReferenceInfo:()=>l,flipHorizontal:()=>D,flipVertical:()=>Z,generalize:()=>k,geodesicArea:()=>N,geodesicBuffer:()=>A,geodesicDensify:()=>U,geodesicLength:()=>j,intersect:()=>T,intersectLinesToPoints:()=>W,intersects:()=>_,isSimple:()=>x,nearestCoordinate:()=>H,nearestVertex:()=>E,nearestVertices:()=>I,offset:()=>V,overlaps:()=>f,planarArea:()=>z,planarLength:()=>F,relate:()=>w,rotate:()=>L,simplify:()=>b,symmetricDifference:()=>O,touches:()=>m,union:()=>S,within:()=>g});n(59486);var i=n(25243),r=n(99058),o=n(92463),s=n(78952);function a(e){const t=Array.isArray(e)?e[0].spatialReference:e.spatialReference;return t?(0,i.TJ)(s.Z,t):s.Z.WGS84}function l(e){return r.G.extendedSpatialReferenceInfo(e)}function d(e,t){return r.G.clip(o.hydratedAdapter,a(e),e,t)}function h(e,t){return r.G.cut(o.hydratedAdapter,a(e),e,t)}function p(e,t){return r.G.contains(o.hydratedAdapter,a(e),e,t)}function c(e,t){return r.G.crosses(o.hydratedAdapter,a(e),e,t)}function u(e,t,n){return r.G.distance(o.hydratedAdapter,a(e),e,t,n)}function v(e,t){return r.G.equals(o.hydratedAdapter,a(e),e,t)}function _(e,t){return r.G.intersects(o.hydratedAdapter,a(e),e,t)}function m(e,t){return r.G.touches(o.hydratedAdapter,a(e),e,t)}function g(e,t){return r.G.within(o.hydratedAdapter,a(e),e,t)}function y(e,t){return r.G.disjoint(o.hydratedAdapter,a(e),e,t)}function f(e,t){return r.G.overlaps(o.hydratedAdapter,a(e),e,t)}function w(e,t,n){return r.G.relate(o.hydratedAdapter,a(e),e,t,n)}function x(e){return r.G.isSimple(o.hydratedAdapter,a(e),e)}function b(e){return r.G.simplify(o.hydratedAdapter,a(e),e)}function P(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.G.convexHull(o.hydratedAdapter,a(e),e,t)}function C(e,t){return r.G.difference(o.hydratedAdapter,a(e),e,t)}function O(e,t){return r.G.symmetricDifference(o.hydratedAdapter,a(e),e,t)}function T(e,t){return r.G.intersect(o.hydratedAdapter,a(e),e,t)}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r.G.union(o.hydratedAdapter,a(e),e,t)}function V(e,t,n,i,s,l){return r.G.offset(o.hydratedAdapter,a(e),e,t,n,i,s,l)}function M(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r.G.buffer(o.hydratedAdapter,a(e),e,t,n,i)}function A(e,t,n,i,s,l){return r.G.geodesicBuffer(o.hydratedAdapter,a(e),e,t,n,i,s,l)}function H(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return r.G.nearestCoordinate(o.hydratedAdapter,a(e),e,t,n)}function E(e,t){return r.G.nearestVertex(o.hydratedAdapter,a(e),e,t)}function I(e,t,n,i){return r.G.nearestVertices(o.hydratedAdapter,a(e),e,t,n,i)}function G(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent?.center??null:null}function L(e,t,n){if(null==e)throw new q;const i=e.spatialReference;if(null==(n=n??G(e)))throw new q;const o=e.constructor.fromJSON(r.G.rotate(e,t,n));return o.spatialReference=i,o}function D(e,t){if(null==e)throw new q;const n=e.spatialReference;if(null==(t=t??G(e)))throw new q;const i=e.constructor.fromJSON(r.G.flipHorizontal(e,t));return i.spatialReference=n,i}function Z(e,t){if(null==e)throw new q;const n=e.spatialReference;if(null==(t=t??G(e)))throw new q;const i=e.constructor.fromJSON(r.G.flipVertical(e,t));return i.spatialReference=n,i}function k(e,t,n,i){return r.G.generalize(o.hydratedAdapter,a(e),e,t,n,i)}function R(e,t,n){return r.G.densify(o.hydratedAdapter,a(e),e,t,n)}function U(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return r.G.geodesicDensify(o.hydratedAdapter,a(e),e,t,n,i)}function z(e,t){return r.G.planarArea(o.hydratedAdapter,a(e),e,t)}function F(e,t){return r.G.planarLength(o.hydratedAdapter,a(e),e,t)}function N(e,t,n){return r.G.geodesicArea(o.hydratedAdapter,a(e),e,t,n)}function j(e,t,n){return r.G.geodesicLength(o.hydratedAdapter,a(e),e,t,n)}function W(e,t){return r.G.intersectLinesToPoints(o.hydratedAdapter,a(e),e,t)}function Y(e,t){r.G.changeDefaultSpatialReferenceTolerance(e,t)}function $(e){r.G.clearDefaultSpatialReferenceTolerance(e)}class q extends Error{constructor(){super("Illegal Argument Exception")}}},85577:(e,t,n)=>{n.d(t,{r:()=>w});n(59486);var i=n(52639),r=(n(51508),n(42537)),o=n(17842),s=n(25243),a=n(13611),l=n(6644),d=n(12400),h=n(48202),p=n(38054),c=n(76014),u=n(38561),v=n(848),_=n(29909),m=n(78952),g=n(75021),y=n(16072),f=n(16851);class w extends u.a{constructor(e){super(),this._graphicsLayer=e,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new v.Z({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("intersectionPoint",t.view.effectiveTheme.accentColor))}visualizePoint(e,t){return this._visualizeSnappingIndicator(new v.Z({x:e.point[0],y:e.point[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("point",t.view.effectiveTheme.accentColor))}visualizeLine(e,t){return this._visualizeSnappingIndicator(new _.Z({paths:[[[...e.lineStart],[...e.lineEnd]]],spatialReference:(0,s.TJ)(m.Z,t.spatialReference)}),this._getOrCreateSymbol("line",t.view.effectiveTheme.accentColor))}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new _.Z({paths:[[[...e.lineStart],[...e.lineEnd]]],spatialReference:(0,s.TJ)(m.Z,t.spatialReference)}),this._getOrCreateSymbol("parallelSign",t.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(e,t){const n=(0,l.Ue)(),i=(0,l.Ue)(),r=(0,d.Ue)();(0,a.$X)(n,(0,p.eR)(e.centerVertex),(0,p.eR)(e.previousVertex)),(0,a.$X)(i,(0,p.eR)(e.nextVertex),(0,p.eR)(e.previousVertex)),(0,a.kC)(r,n,i);const o="rightAngleQuad"+(r[2]<0?45:225);return this._visualizeSnappingIndicator(new _.Z({paths:[[[...e.previousVertex],[...e.centerVertex],[...e.nextVertex]]],spatialReference:(0,s.TJ)(m.Z,t.spatialReference)}),this._getOrCreateSymbol(o,t.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(e,t){const n=new i.Z({geometry:e,symbol:t});return this._graphicsLayer.add(n),(0,r.kB)((()=>{this._graphicsLayer.remove(n)}))}_getOrCreateSymbol(e,t){const n=this._symbolPairingsByType;return n.get(e)?.color!==t&&n.set(e,{color:t,symbol:x(e,t)}),n.get(e).symbol}}function x(e,t){const n=[...t.toRgb(),255*t.a];switch(e){case"point":return new y.Z({outline:{width:.5,color:[0,0,0,1]},size:10,color:t});case"intersectionPoint":return new y.Z({outline:new f.Z({width:1.5,color:t}),size:15,color:[0,0,0,0]});case"line":return new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:h.kP.Butt,joinStyle:h.r4.Round,miterLimit:10,width:(0,o.Wz)(c.c.lineHintWidthTarget),color:n}]}}});case"parallelSign":return new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:n}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:n}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const i="rightAngleQuad45"===e?45:225;return new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,o.Wz)(c.c.rightAngleHintSize),rotation:i,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,o.Wz)(c.c.rightAngleHintOutlineSize),color:n},{type:"CIMSolidFill",enable:!0,color:[...t.toRgb(),255*t.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}},9843:(e,t,n)=>{n.d(t,{Z:()=>ee});var i,r=n(27366),o=n(7138),s=(n(93169),n(49861)),a=(n(32718),n(84936),n(69912)),l=(n(59486),n(10064),n(91505)),d=n(84652),h=n(92026),p=n(66978),c=n(17842),u=n(93655),v=n(55946),_=n(50951),m=n(85577),g=n(14813),y=n(84954),f=n(17877),w=n(34019),x=n(71040);let b=i=class extends l.Z.EventedAccessor{constructor(e){super(e),this._hasZ=null,this._cursorScreenPoint=null,this._activePointerId=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=(0,g.Y6)(!!e.hasZ,!1,e.view.spatialReference),this._snappingManager=e.snappingManager,this._editGeometryOperations=new f.c(new y.XE(e.editGeometryType??"polygon",this._coordinateHelper),_.JY.Local),this._snappingGraphicsLayer=new u.Z({id:i.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),this._snappingContext=new w.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new m.r(this._snappingGraphicsLayer)}),this._activeComponent=new y.wA(e.view.spatialReference,_.JY.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}normalizeCtorArgs(e){const t={...e};return delete t.editGeometryType,delete t.snappingManager,t}initialize(){this._snappingOperation=new x.y({view:this.view}),"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}destroy(){this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this._snappingOperation=(0,h.SC)(this._snappingOperation),this._editGeometryOperations.destroy()}get _committedVertices(){return this._editGeometryOperations.data.components[0].vertices.map((e=>e.pos))}get vertices(){return null!=this._stagedVertex?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return null!=this._hasZ?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}get _stagedVertex(){return this._snappingOperation.stagedPoint}set _stagedVertex(e){this._snappingOperation.stagedPoint=(0,d.d9)(e)}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this.canUndo&&this._editGeometryOperations.undo()}redo(){this.canRedo&&this._editGeometryOperations.redo()}getCoordsFromScreenPoint(e){const t=e&&this.screenToMap(e);return null==t?null:t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return null==t?null:t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){const n=this.elevationInfo??P;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,c.s1)(e.x,e.y),n,this._getGeometryZValue())}else{const n=this.elevationInfo??C;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,c.s1)(e.x,e.y),n,0),null!=t&&(t.z=void 0)}else t=this.view.toMap(e),null!=t&&(t.z=this.hasZ?this._getGeometryZValue():void 0);return t}_pushCursorVertex(e,t){const n=(0,v.T)(e[0],e[1],void 0,this.view.spatialReference);this._stagedVertexUnsnapped=n;const i=this._snappingManager;if(null==i)return this._stagedVertex=n,void t();(0,p.R8)(this._snappingOperation.snap({point:n},i,this._snappingContext)).then((()=>{t()}))}_popCursorVertex(){this._stagedVertexUnsnapped=null,this._stagedVertex=null}_getGeometryZValue(){return this.defaultZ}_abortSnapping(){this._snappingOperation.abort()}_isDuplicateOfLastVertex(e){const t=this._editGeometryOperations.data.components[0].getLastVertex()?.pos;if(t&&e[0]===t[0]&&e[1]===t[1])return!0;const{x:n,y:i}=this._coordinateHelper.vectorToDehydratedPoint(e);return null!=this._lastVertexUnsnapped&&n===this._lastVertexUnsnapped.x&&i===this._lastVertexUnsnapped.y}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(null==this._activePointerId||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=null!=this._stagedVertex?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);null!=t&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};b.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",(0,r._)([(0,s.Cb)({readOnly:!0})],b.prototype,"vertices",null),(0,r._)([(0,s.Cb)({type:Boolean,nonNullable:!0})],b.prototype,"interactiveUndoDisabled",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],b.prototype,"history",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],b.prototype,"redoHistory",void 0),(0,r._)([(0,s.Cb)()],b.prototype,"snapToScene",void 0),(0,r._)([(0,s.Cb)()],b.prototype,"view",void 0),(0,r._)([(0,s.Cb)()],b.prototype,"elevationInfo",void 0),(0,r._)([(0,s.Cb)({nonNullable:!0})],b.prototype,"defaultZ",void 0),(0,r._)([(0,s.Cb)()],b.prototype,"hasZ",null),(0,r._)([(0,s.Cb)()],b.prototype,"_snappingOperation",void 0),(0,r._)([(0,s.Cb)()],b.prototype,"_stagedVertex",null),b=i=(0,r._)([(0,a.j)("esri.views.draw.DrawAction")],b);const P={mode:"absolute-height",offset:0},C={mode:"on-the-ground",offset:0};const O=b;class T{constructor(e,t,n){this.view=e,this.vertexIndex=t,this.vertices=n,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class S{constructor(e,t,n){this.view=e,this.vertexIndex=t,this.vertices=n,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class V{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.view=e,this.vertexIndex=t,this.vertices=n,this.mapPoint=i,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===n.length?n[0]:null}preventDefault(){this.defaultPrevented=!0}}class M{constructor(e){this.vertices=e,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===e.length?e[0]:null}preventDefault(){this.defaultPrevented=!0}}var A=n(1614),H=n(87888),E=n(72612),I=n(848);const G=Symbol("view-handles"),L=Symbol("undo-redo-handles");let D=class extends O{constructor(e){super(e),this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._removeUndoRedoHandles(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,E.vT)(e),"touch"===e.pointerType&&this._updateCursor())}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,E.vT)(e),"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),A.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:n}=e;t===H.Sn.vertexAdd&&!n&&this._cursorScreenPoint?(e.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(e)):t!==H.Sn.complete||n?t!==H.Sn.undo||this.interactiveUndoDisabled||n?t!==H.Sn.redo||this.interactiveUndoDisabled||n?t!==H.Sn.pan||n||e.stopPropagation():(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),A.f.TOOL),this.view.on("key-up",(e=>{e.key===H.Sn.pan&&e.stopPropagation()}),A.f.TOOL)],G)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new S(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new T(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new T(this.view,e.vertices[0].index,t))}}))],L)}_removeViewHandles(){this.removeHandles(G)}_removeUndoRedoHandles(){this.removeHandles(L)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||this._editGeometryOperations.appendVertex(t)}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new V(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new I.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new M(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this._removeViewHandles()}};D=(0,r._)([(0,a.j)("esri.views.draw.MultipointDrawAction")],D);const Z=D;var k=n(74509),R=n(66038),U=n(46640),z=n(45900);let F=class extends(l.Z.EventedMixin(z.m)){constructor(e){super(e),this.defaultZ=0,this.elevationInfo=null,this.hasZ=!0,this.mode=null,this.snapToScene=null,this.type="draw-3d"}initialize(){const e=this.view,t=(0,k.mF)(this.hasZ,this.elevationInfo);this.drawOperation=new R.wW({view:e,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:"3d"===e.type?new U.iW(e,t):null,elevationDrawSurface:"3d"===e.type?new U.aL(t,this.defaultZ,e):null,hasM:!1,elevationInfo:t}),this.addHandles([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,h.SC)(this.drawOperation),this._set("view",null)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.geometryIncludingUncommittedVertices}onInputEvent(e){this.drawOperation.onInputEvent(e)}canRedo(){return this.drawOperation.canRedo}canUndo(){return this.drawOperation.canUndo}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}onComplete(e){this.emit("complete",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}};(0,r._)([(0,s.Cb)({constructOnly:!0,nonNullable:!0})],F.prototype,"defaultZ",void 0),(0,r._)([(0,s.Cb)()],F.prototype,"drawOperation",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],F.prototype,"elevationInfo",void 0),(0,r._)([(0,s.Cb)({value:!0})],F.prototype,"enabled",null),(0,r._)([(0,s.Cb)({constructOnly:!0})],F.prototype,"geometryType",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],F.prototype,"hasZ",void 0),(0,r._)([(0,s.Cb)({constructOnly:!0})],F.prototype,"mode",void 0),(0,r._)([(0,s.Cb)()],F.prototype,"snapToScene",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],F.prototype,"type",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],F.prototype,"updating",null),(0,r._)([(0,s.Cb)({constructOnly:!0,nonNullable:!0})],F.prototype,"view",void 0),F=(0,r._)([(0,a.j)("esri.views.draw.DrawTool")],F);let N=class extends O{constructor(e){super(e),this._addVertexOnPointerUp=!1,this._drawTool=null}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",(e=>{e.key===H.Sn.complete&&(this._drawTool?this.complete():(this._abortSnapping(),this._vertexAddHandler(e)))}),A.f.TOOL)])}_addViewHandles2DOnly(){"2d"===this.view.type&&this.addHandles([this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,E.vT)(e),"touch"===e.pointerType&&this._updateCursor())}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,E.vT)(e),"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),A.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)e.stopPropagation(),this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL)])}_addDrawTool(){const e=new F({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new V(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new M(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new V(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new I.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new M(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};N=(0,r._)([(0,a.j)("esri.views.draw.PointDrawAction")],N);const j=N;var W=n(78005);let Y=class extends O{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=W.n}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){return this._drawTool?.canUndo()??super.canUndo()}canRedo(){return this._drawTool?.canRedo()??super.canRedo()}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles(this.view.on("key-down",(e=>{const{key:t,repeat:n}=e;t!==H.Sn.vertexAdd||n?t!==H.Sn.complete||n?t!==H.Sn.undo||this.interactiveUndoDisabled||n?t!==H.Sn.redo||this.interactiveUndoDisabled||n||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))}),A.f.TOOL))}_addViewHandles2DOnly(){"2d"===this.view.type&&(this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,E.vT)(e),"touch"===e.pointerType&&this._updateCursor())}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=(0,E.vT)(e),"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,E.vT)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),A.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(t)}}),A.f.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:n}=e;t!==H.Sn.pan||n||(e.stopPropagation(),this._panEnabled=!0)}),A.f.TOOL),this.view.on("key-up",(e=>{e.key===H.Sn.pan&&(e.stopPropagation(),this._panEnabled=!1)}),A.f.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new S(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new T(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new T(this.view,e.vertices[0].index,t))}}))])}_addDrawTool(){const e=new F({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),e.on("vertex-add",(t=>{if(1===t.vertices.length){const{view:n}=this,i=t.vertices[0].vertexIndex,r=e.getVertexCoords();this.emit("vertex-add",new T(n,i,r)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new T(n,i,r))}})),e.on("vertex-remove",(t=>{if(1===t.vertices.length){const{view:n}=this,i=t.vertices[0].vertexIndex,r=e.getVertexCoords();this.emit("vertex-remove",new S(n,i,r)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new S(n,i,r))}})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new V(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new M(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t))}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new V(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new I.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<3)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new M(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};(0,r._)([(0,s.Cb)()],Y.prototype,"_dragEnabled",null),(0,r._)([(0,s.Cb)()],Y.prototype,"_clickEnabled",null),(0,r._)([(0,s.Cb)({type:W.A})],Y.prototype,"mode",void 0),Y=(0,r._)([(0,a.j)("esri.views.draw.PolygonDrawAction")],Y);const $=Y;let q=class extends O{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=W.n}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){return this._drawTool?.canUndo()??super.canUndo()}canRedo(){return this._drawTool?.canRedo()??super.canRedo()}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",(e=>{const{key:t,repeat:n}=e;t!==H.Sn.vertexAdd||n?t!==H.Sn.complete||n?t!==H.Sn.undo||this.interactiveUndoDisabled||n?t!==H.Sn.redo||this.interactiveUndoDisabled||n||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))}),A.f.TOOL)])}_addViewHandles2DOnly(){"2d"===this.view.type&&(this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&!this._panEnabled&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,E.vT)(e),"touch"===e.pointerType&&this._updateCursor())}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,E.vT)(e),"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,E.vT)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),A.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(t)}}),A.f.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:n}=e;t!==H.Sn.pan||n||(e.stopPropagation(),this._panEnabled=!0)}),A.f.TOOL),this.view.on("key-up",(e=>{e.key===H.Sn.pan&&(e.stopPropagation(),this._panEnabled=!1)}),A.f.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new S(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new T(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new T(this.view,e.vertices[0].index,t))}}))])}_addDrawTool(){const e=new F({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{if(1!==t.vertices.length)return;const{view:n}=this,i=t.vertices[0].vertexIndex,r=e.getVertexCoords();this.emit("vertex-add",new T(n,i,r)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new T(n,i,r))})),e.on("vertex-remove",(t=>{if(1!==t.vertices.length)return;const{view:n}=this,i=t.vertices[0].vertexIndex,r=e.getVertexCoords();this.emit("vertex-remove",new S(n,i,r)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new S(n,i,r))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new V(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new M(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t))}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new V(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new I.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<2)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new M(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};(0,r._)([(0,s.Cb)()],q.prototype,"_clickEnabled",null),(0,r._)([(0,s.Cb)()],q.prototype,"_dragEnabled",null),(0,r._)([(0,s.Cb)({type:W.A})],q.prototype,"mode",void 0),q=(0,r._)([(0,a.j)("esri.views.draw.PolylineDrawAction")],q);const J=q;var X=n(3826);let B=class extends O{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){"click"===this.mode?this.addHandles(this._getClickModeViewHandles()):this.addHandles(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",(e=>{e.stopPropagation(),e.mapPoint&&!this._panEnabled&&null!=this.getCoordsFromScreenPoint((0,E.vT)(e))&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),A.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,E.vT)(e),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()))}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),null==this._activePointerId&&"touch"!==e.pointerType&&(this._cursorScreenPoint=(0,E.vT)(e),this._updateCursor())}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0,this._cursorScreenPoint=(0,E.vT)(e),this._updateCursor())}),A.f.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&this._addVertexOnPointerUp&&(this._abortSnapping(),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(e),2===this._committedVertices.length&&this._drawCompleteHandler(e),this._isDragging=!1)}),A.f.TOOL),this.view.on("key-down",(e=>{e.key===H.Sn.complete&&this._cursorScreenPoint?(this._abortSnapping(),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key===H.Sn.pan&&(this._panEnabled=!0)}),A.f.TOOL),this.view.on("key-up",(e=>{e.key===H.Sn.pan&&(this._panEnabled=!1)}),A.f.TOOL),this.view.on("drag",(e=>{null!=this._activePointerId&&e.stopPropagation()}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,E.vT)(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,E.vT)(e),null==this._activePointerId&&"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0)}),A.f.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=null,e.stopPropagation(),this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)}),A.f.TOOL),this.view.on("key-down",(e=>{e.key===H.Sn.vertexAdd&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===H.Sn.complete&&this._cursorScreenPoint&&2===this.vertices.length&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),A.f.TOOL)]}_addDrawTool(){const e=new F({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{1===t.vertices.length&&this.emit("vertex-add",new T(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new V(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new M(e.getVertexCoords())),this._removeDrawTool()})),this.view.on("key-down",(t=>{t.key!==H.Sn.vertexAdd||t.repeat||"click"!==this.mode?t.key!==H.Sn.complete||t.repeat||e.completeCreateOperation():e.drawOperation.numCommittedVertices>0?e.completeCreateOperation():e.drawOperation.commitStagedVertex()}),A.f.TOOL)])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(t))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=(0,X.Gn)(this.view,this._committedVertices[0]));const n=this._committedVertices.length-1,i=new T(this.view,n,this.vertices);this.emit("vertex-add",i)}_updateCursor(){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const e=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null!=e&&this._pushCursorVertex(e.vertex,(()=>this.emit("cursor-update",new V(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new I.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return this._drawTool.completeCreateOperation(),void this.removeAllHandles();if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new M(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}_resetGeometry(){this._editGeometryOperations.destroy(),this._editGeometryOperations=new f.c(new y.XE("polygon",this._coordinateHelper),_.JY.Local),this._activeComponent=new y.wA(this._coordinateHelper.spatialReference,_.JY.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}};(0,r._)([(0,s.Cb)({type:["freehand","click"]})],B.prototype,"mode",void 0),B=(0,r._)([(0,a.j)("esri.views.draw.SegmentDrawAction")],B);const Q=B;let K=class extends o.Z{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,t){this.reset();const n={view:this.view,...t};switch(e){case"point":n.editGeometryType="point",this.activeAction=new j(n);break;case"polyline":n.editGeometryType="polyline",this.activeAction=new J(n);break;case"multipoint":n.editGeometryType="polygon",this.activeAction=new Z(n);break;case"polygon":n.editGeometryType="polygon",this.activeAction=new $(n);break;case"rectangle":case"circle":case"ellipse":case"triangle":n.editGeometryType="polygon",this.activeAction=new Q(n)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};(0,r._)([(0,s.Cb)()],K.prototype,"activeAction",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],K.prototype,"type",void 0),(0,r._)([(0,s.Cb)()],K.prototype,"view",void 0),K=(0,r._)([(0,a.j)("esri.views.draw.Draw")],K);const ee=K},45900:(e,t,n)=>{n.d(t,{m:()=>h});var i=n(27366),r=n(7138),o=(n(93169),n(32718),n(66978)),s=n(49861),a=(n(84936),n(69912)),l=n(99034),d=n(92853);let h=class extends r.Z{constructor(e){super(e),this.manipulators=new d.D,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[l.bH.MANAGER,!0],[l.bH.USER,!0]]),this._creationFinishedResolver=(0,o.hh)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(l.bH.USER)}set editable(e){this.setEditableFlag(l.bH.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===l.bH.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach((n=>{let{manipulator:i}=n;i.dragging&&(t=!0,i.events.emit("drag",{action:"end",start:e,screenPoint:e}))})),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(l.bH.USER)&&this.getEditableFlag(l.bH.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,i._)([(0,s.Cb)({constructOnly:!0})],h.prototype,"view",void 0),(0,i._)([(0,s.Cb)({readOnly:!0})],h.prototype,"active",null),(0,i._)([(0,s.Cb)({value:!0})],h.prototype,"visible",null),(0,i._)([(0,s.Cb)({value:!0})],h.prototype,"editable",null),(0,i._)([(0,s.Cb)({readOnly:!0})],h.prototype,"manipulators",void 0),(0,i._)([(0,s.Cb)({readOnly:!0})],h.prototype,"updating",null),(0,i._)([(0,s.Cb)()],h.prototype,"cursor",null),(0,i._)([(0,s.Cb)({readOnly:!0})],h.prototype,"automaticManipulatorSelection",void 0),(0,i._)([(0,s.Cb)()],h.prototype,"hasFocusedManipulators",null),(0,i._)([(0,s.Cb)()],h.prototype,"hasGrabbedManipulators",void 0),(0,i._)([(0,s.Cb)()],h.prototype,"hasHoveredManipulators",void 0),(0,i._)([(0,s.Cb)()],h.prototype,"firstGrabbedManipulator",void 0),(0,i._)([(0,s.Cb)({readOnly:!0})],h.prototype,"created",void 0),(0,i._)([(0,s.Cb)({readOnly:!0})],h.prototype,"removeIncompleteOnCancel",void 0),h=(0,i._)([(0,a.j)("esri.views.interactive.InteractiveToolBase")],h)},92853:(e,t,n)=>{n.d(t,{D:()=>s});var i,r,o=n(80987);(r=i||(i={}))[r.WhenToolEditable=0]="WhenToolEditable",r[r.WhenToolNotEditable=1]="WhenToolNotEditable",r[r.Always=2]="Always";class s{constructor(){this._isToolEditable=!0,this._manipulators=new o.Z,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.WhenToolEditable;this.addMany([e],t)}addMany(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.WhenToolEditable;for(const n of e){const e={manipulator:n,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((e=>{let{manipulator:t}=e;return t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((r=>{let{manipulator:o,attached:s}=r;if(!s||!o.interactive)return;const a=o.intersectionDistance(e,t);null!=a&&a<i&&(i=a,n=o)})),n}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===i.Always||(this._isToolEditable?e.visibilityPredicate===i.WhenToolEditable:e.visibilityPredicate===i.WhenToolNotEditable)}}},74229:(e,t,n)=>{n.d(t,{$Q:()=>v,AN:()=>b,BS:()=>S,Cf:()=>g,M2:()=>u,Mz:()=>M,Xd:()=>c,dJ:()=>x,di:()=>f,fW:()=>y,hM:()=>T,kY:()=>C,uI:()=>w,zh:()=>P});var i=n(63780),r=(n(93169),n(84652)),o=n(16889),s=n(17842),a=n(79803),l=n(69048),d=n(37818),h=n(74509),p=n(17877);function c(e,t){return e.events.on("drag",function(e,t){let n=null,i=null;return r=>{if("cancel"===r.action)return void(null!=i&&(i.execute({action:"cancel"}),n=null,i=null));const o={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&null==n&&(n=new T,i=new T,t(e,n,i,r.pointerType,o)),null!=n&&n.execute(o),"end"===r.action&&null!=n&&(n=null,i=null)}}(e,t))}function u(e,t){const n=[e.x,e.y,e.z??0],i=t,r=[Math.cos(i),Math.sin(i)],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===o)return null;r[0]/=o,r[1]/=o;const s=e=>{const t=(e.x-n[0])*r[0]+(e.y-n[1])*r[1];e.x=n[0]+t*r[0],e.y=n[1]+t*r[1]};return e=>(s(e.mapStart),s(e.mapEnd),{...e,axis:r})}function v(e){let t=null;return n=>{if("start"===n.action&&(t=function(e,t){const n=e.operations;if(!n)return null;const i=n.data.geometry,r=(0,d.D)(t);if(i.spatialReference.equals(r))return m(e,n,(()=>{}));if("mesh"!==i.type){const t=_(i,r);if(null==t)return null;const o=i.spatialReference;return m(e,p.c.fromGeometry(t,n.viewingMode),(()=>{const e=(0,a.project)(i,o);n.trySetGeometry(e)}))}if((0,l.QK)(i)){const t=_(i.origin,r);if(!t)return null;const o=i.spatialReference,s=p.c.fromGeometry(t,n.viewingMode);return m(e,n,(()=>{const e=(0,a.project)(s.data.geometry,o),t=e.x-i.origin.x,r=e.y-i.origin.y,l=(e.z??0)-(i.origin.z??0);n.move(t,r,l)}))}return null}(e,n.mapStart.spatialReference)),null==t)return null;const i=n.mapEnd.x-n.mapStart.x,r=n.mapEnd.y-n.mapStart.y,o=(n.mapEnd.z??0)-(n.mapStart.z??0);return t.move(i,r,o,n.action),{...n,translationX:i,translationY:r,translationZ:o}}}function _(e,t){return null==e?null:e.spatialReference.equals(t)?e.clone():(0,a.project)(e,t)}function m(e,t,n){let i=0,r=0,o=0;return{move:(s,a,l,d)=>{"start"===d&&(i=0,r=0,o=0);const h=s-i,p=a-r,c=l-o;t.move(h,p,c),i+=h,r+=p,o+=c,n(),"end"===d&&e.endInteraction?.()}}}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,i=null;const r=null==t||e.spatialReference?.equals(t)?e=>e:e=>null!=e?(0,a.project)(e,t):e,o={exclude:[],...n};return t=>{if("start"===t.action&&(i=r(e.toMap(t.screenStart,o))),null==i)return null;const n=r(e.toMap(t.screenEnd,o));return null!=n?{...t,mapStart:i,mapEnd:n}:null}}function y(e){const t=e.map((e=>v(e))).filter(i.pC);return e=>{const n=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,r=e.mapEnd.z-e.mapStart.z;return t.forEach((t=>t(e))),{...e,translationX:n,translationY:i,translationZ:r}}}function f(e,t){const n=new Map;for(const i of t)n.set(i,(0,r.d9)(e[i]));return t=>(n.forEach(((t,n)=>{e[n]=t})),t)}function w(e){const t=e.operations?.createResetState();return e=>(t?.remove(),e)}function x(e){const t=e.map((e=>w(e))).filter((e=>null!=e));return e=>(t.forEach((t=>t(e))),e)}function b(){let e=0,t=0,n=0;return i=>{"start"===i.action&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);const r=i.mapEnd.x-e,o=i.mapEnd.y-t,s=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:r,mapDeltaY:o,mapDeltaZ:s,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function P(){let e=0,t=0;return n=>{"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);const i=n.screenEnd.x-e,r=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:r}}}function C(e,t){let n=null,i=0,r=0;return a=>{if("start"===a.action&&(n=e.toScreen?.(t),null!=n&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=a.screenStart.x-n.x,r=a.screenStart.y-n.y))),null==n)return null;const l=(0,o.uZ)(a.screenEnd.x-i,0,e.width),d=(0,o.uZ)(a.screenEnd.y-r,0,e.height),h=(0,s.vW)(l,d);return a.screenStart=n,a.screenEnd=h,a}}const O=()=>{};class T{constructor(){this.execute=O}next(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T;return null!=e&&(this.execute=n=>{const i=e(n);null!=i&&t.execute(i)}),t}}function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("2d"===e.type)return e=>e;let i=null;return r=>{"start"===r.action&&(i=e.toMap(r.screenStart,{exclude:n}),null!=i&&(i.z=(0,h.Ou)(i,e,t)));const o=e.toMap(r.screenEnd,{exclude:n});null!=o&&(o.z=(0,h.Ou)(o,e,t));const s=null!=i&&null!=o?{sceneStart:i,sceneEnd:o}:null;return{...r,scenePoints:s}}}function V(e,t,n){const i=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,r=(0,d.WG)(e);return r.z=i,r.hasZ=!0,r.z=(0,h.Ou)(r,t,n),r}function M(e,t){if("2d"===e.type)return e=>e;let n=null;return i=>{"start"===i.action&&(n=V(i.mapStart,e,t));const r=V(i.mapEnd,e,t),o=null!=n&&null!=r?{sceneStart:n,sceneEnd:r}:null;return{...i,scenePoints:o}}}},34019:(e,t,n)=>{n.d(t,{N:()=>i});class i{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}},80151:(e,t,n)=>{n.d(t,{W:()=>c});var i=n(92026),r=n(66978),o=n(94172),s=n(70178),a=n(37818),l=n(74509),d=n(74229),h=n(34019),p=n(93463);function c(e){let{predicate:t=(()=>!0),snappingManager:n,snappingContext:a,updatingHandles:c,useZ:g=!0}=e;const y=new d.hM;if(null==n)return{snappingStep:[m,y],cancelSnapping:m};let f,w=null,x=null,b=null;const P=()=>{w=(0,i.IM)(w),n.doneSnapping(),x?.frameTask.remove(),x=null,f=(0,i.hw)(f),b=null},C=(O=n,T=g,S=y,(0,r.Ds)((async(e,t)=>{let{frameTask:n,point:i,scenePoint:r,context:o,event:a,delta:l,getLastState:d}=e;const h=await n.schedule((()=>O.snap({point:i,scenePoint:r,context:o,signal:t})),t);if(h.valid){let e=await n.schedule((()=>h.apply()),t);const r=d();null!=r.point&&i!==r.point&&(e=O.update({point:r.point,scenePoint:r.scenePoint,context:o})),null!=r.updatePoint&&(0,s.kg)(e,r.updatePoint)||(_(a.mapEnd,e,l,T),S.execute(a))}})));var O,T,S;let V=null,M=null,A=null;return{snappingStep:[e=>{if(!t(e))return e;const{action:i}=e;if("start"===i){const{info:t}=e,i=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(p.T8.SNAPPING):p.sq}(n.view);if(x=function(e,t,n){return{context:new h.N({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}(a,e,i),x.context.selfSnappingZ=null,!g&&null!=t){const e=function(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const r of n){const t=e.getZ(r.pos);if(null!=i&&null!=t&&Math.abs(t-i)>1e-6)return null;null==i&&(i=t)}return i}(a.coordinateHelper,t.handle.component);null!=e&&(x.context.selfSnappingZ={value:e,elevationInfo:a.elevationInfo??l.jG})}}if(null!=x){const{context:t,originalScenePos:s,originalPos:a}=x,{mapEnd:l,mapStart:d,scenePoints:h}=e,p=u(a,v(l,d)),m=v(d,a),y={...e,action:"update"},P=x.context,O=function(e,t){return null==e||null==t?null:u(e,v(t.sceneEnd,t.sceneStart))}(s,h),T=n.update({point:p,scenePoint:O,context:t});if(A=T,_(l,T,m,g),V=p,M=O,"end"!==i){const{frameTask:e}=x;null==w&&(w=new AbortController),b=t=>{c.addPromise((0,r.R8)(C({frameTask:e,event:y,context:P,point:p,scenePoint:O,delta:m,getLastState:()=>({point:V,scenePoint:M,updatePoint:t.forceUpdate?null:A})},w.signal)))},b({forceUpdate:!1}),null==f&&(f=(0,o.YP)((()=>n.options.effectiveEnabled),(()=>b?.({forceUpdate:!0}))))}}return"end"===i&&P(),e},y],cancelSnapping:e=>(P(),e)}}function u(e,t){let[n,i,r]=t;const o=(0,a.WG)(e);return o.x+=n,o.y+=i,o.hasZ&&(o.z+=r),o}function v(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function _(e,t,n,i){let[r,o,s]=n;e.x=t.x+r,e.y=t.y+o,i&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}function m(e){return e}},38561:(e,t,n)=>{n.d(t,{a:()=>d});var i=n(42537),r=n(90609),o=n(53397),s=n(5916),a=n(61309),l=n(41216);class d{draw(e,t){const n=function(e){const t=[];for(const n of e){let e=!0;for(const i of t)if(n.equals(i)){e=!1;break}e&&t.push(n)}return t}(e),d=this.sortUniqueHints(n),h=[];for(const i of d)i instanceof r.w&&h.push(this.visualizeIntersectionPoint(i,t)),i instanceof o.w&&h.push(this.visualizeLine(i,t)),i instanceof s.L&&h.push(this.visualizeParallelSign(i,t)),i instanceof l.y&&h.push(this.visualizeRightAngleQuad(i,t)),i instanceof a.n&&h.push(this.visualizePoint(i,t));return(0,i.AL)(h)}sortUniqueHints(e){return e}}},61309:(e,t,n)=>{n.d(t,{n:()=>o});var i=n(32035),r=n(55054);class o extends r.r{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof o&&(0,i.p)(this.point,e.point)}}},32845:(e,t,n)=>{n.d(t,{V:()=>d});var i=n(27366),r=n(7138),o=n(32718),s=n(94172),a=n(49861),l=(n(93169),n(84936),n(69912));let d=class extends r.Z{constructor(e){super(e),this.tool=null,this._loggedUnsupportedErrorOnce=!1,null!=e?.visible&&(this.visible=e.visible)}initialize(){this.addHandles((0,s.YP)((()=>({ready:null!=this.view&&this.view.ready,supported:this.supported})),(e=>{let{ready:t,supported:n}=e;!t||n||this._loggedUnsupportedErrorOnce||(this.logError(this.unsupportedErrorMessage),this._loggedUnsupportedErrorOnce=!0)}),s.tX))}destroy(){this.removeTool(),this.view=null}get active(){return null!=this.tool&&this.tool.active}get disabled(){return null==this.view||!this.view.ready||!this.supported}get supported(){return null==this.view||this.view.type===this.supportedViewType}get view(){return this._get("view")}set view(e){if(e===this.view)return;this.removeTool(),this._set("view",e);const t="tools";this.removeHandles(t),null!=e&&this.addHandles(e.tools.on("after-remove",(e=>{e.item===this.tool&&this._set("tool",null)})),t)}set visible(e){this._set("visible",e),null!=this.tool&&(this.tool.visible=e)}createTool(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{interactive:!1};if(this.removeTool(),null==this.view||!this.view.ready||!this.supported)return;const t=this.constructTool();t.created?(this._set("tool",t),this.view.tools.add(t)):e.interactive?(this._set("tool",t),this.view.addAndActivateTool(t),(0,s.gx)((()=>t.created),(()=>{t.active&&null!=this.view&&(this.view.activeTool=null)}),{initial:!0,once:!0})):t.destroy()}removeTool(){const e=this.tool;if(null==e)return;const t=this.view?.tools;null!=t?t.remove(e):e.destroy(),this._set("tool",null)}logError(){o.Z.getLogger(this).error(...arguments)}};(0,i._)([(0,a.Cb)({constructOnly:!0})],d.prototype,"tool",void 0),(0,i._)([(0,a.Cb)()],d.prototype,"active",null),(0,i._)([(0,a.Cb)()],d.prototype,"disabled",null),(0,i._)([(0,a.Cb)()],d.prototype,"supported",null),(0,i._)([(0,a.Cb)({value:null})],d.prototype,"view",null),(0,i._)([(0,a.Cb)({type:Boolean,value:!0})],d.prototype,"visible",null),d=(0,i._)([(0,l.j)("esri.widgets.support.InteractiveToolViewModel")],d)},82052:(e,t,n)=>{n.d(t,{s:()=>m});var i=n(27366),r=n(49861),o=(n(93169),n(32718),n(84936),n(69912)),s=n(33565),a=n(8905),l=n(68860),d=(n(80975),n(80532)),h=n(67005);const p="esri-unit-select",c={base:p,label:`${p}__label`,select:`${p}__select`};let u=class extends s.Z{constructor(e,t){super(e,t),this._onSelectChange=e=>{this.onChange(e.target.value)}}loadDependencies(){return(0,a.h)({label:()=>Promise.resolve().then(n.bind(n,35738)),option:()=>n.e(9790).then(n.bind(n,19790)),select:()=>n.e(6369).then(n.bind(n,26369))})}render(){const{messages:e,options:t,selectLabel:n,value:i,_onSelectChange:r}=this;return(0,h.u)("div",{class:c.base,key:"units"},(0,h.u)("calcite-label",{class:c.label},n,(0,h.u)("calcite-select",{class:c.select,label:n,onCalciteSelectChange:r},t.map((t=>(0,h.u)("calcite-option",{key:t,selected:t===i,value:t},(0,l.ZO)(t)?e.systems[t]:e.units[t]?.pluralCapitalized))))))}};(0,i._)([(0,r.Cb)()],u.prototype,"options",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"onChange",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"selectLabel",void 0),(0,i._)([(0,r.Cb)()],u.prototype,"value",void 0),(0,i._)([(0,r.Cb)(),(0,d.H)("esri/core/t9n/Units")],u.prototype,"messages",void 0),u=(0,i._)([(0,o.j)("esri.widgets.support.UnitSelect")],u);const v="esri-measurement-widget-content",_={base:v,actions:`${v}__actions`,error:`${v}__error`,hint:`${v}__hint`,hintText:`${v}__hint-text`,panelError:`${v}__panel--error`,settings:`${v}__settings`,measurement:`${v}__measurement`,measurementItem:`${v}__measurement-item`,measurementItemDisabled:`${v}__measurement-item--disabled`,measurementItemTitle:`${v}__measurement-item__title`,measurementItemValue:`${v}__measurement-item__value`};let m=class extends s.Z{constructor(e,t){super(e,t)}loadDependencies(){return(0,a.h)({button:()=>Promise.resolve().then(n.bind(n,32275))})}render(){return(0,h.u)("div",{class:_.base},this._renderContent())}_renderContent(){const{supported:e,active:t,state:n}=this;switch(n){case"disabled":case"ready":return e?t?this._renderHint():this._renderActions():this._renderUnsupportedMessage();case"measuring":case"measured":return[this._renderSettings(),this._renderMeasurement(),this._renderActions()]}}_renderUnsupportedMessage(){return(0,h.u)("section",{class:_.error,key:"unsupported"},(0,h.u)("p",null,this.messages.unsupported))}_renderHint(){const{messages:e}=this;return(0,h.u)("section",{class:_.hint,key:"hint"},(0,h.u)("p",{class:_.hintText},e.hint))}_renderSettings(){return(0,h.u)("div",{class:_.settings,key:"settings"},(0,h.u)(u,{options:this.unitOptions,selectLabel:this.messages.unit,value:this.unit,onChange:this.onUnitChange}))}_renderMeasurement(){return(0,h.u)("section",{class:_.measurement,key:"measurement"},this.measurementItems.map((e=>this._renderMeasurementItem(e))))}_renderMeasurementItem(e){let{key:t,title:n,value:i}=e;return(0,h.u)("div",{class:this.classes(_.measurementItem,null==i&&_.measurementItemDisabled),key:t},(0,h.u)("span",{class:_.measurementItemTitle},n),(0,h.u)("span",{"aria-live":"polite",class:_.measurementItemValue},i??this.messages.notApplicable))}_renderActions(){const{messages:e}=this;return(0,h.u)("div",{class:_.actions},(0,h.u)("calcite-button",{class:this.newMeasurementButtonClass,disabled:"disabled"===this.state,onclick:this.onNewMeasurementClick},e.newMeasurement))}};(0,i._)([(0,r.Cb)()],m.prototype,"active",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"measurementItems",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"messages",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"newMeasurementButtonClass",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"onNewMeasurementClick",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"onUnitChange",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"state",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"supported",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"unit",void 0),(0,i._)([(0,r.Cb)()],m.prototype,"unitOptions",void 0),m=(0,i._)([(0,o.j)("esri.widgets.support.MeasurementWidgetContent")],m)}}]);
//# sourceMappingURL=6372.a34c6c38.chunk.js.map