"use strict";(self.webpackChunksc_land=self.webpackChunksc_land||[]).push([[8178],{58178:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var r=n(14921),s=n(10064),i=n(32718),a=n(66978),o=n(92975),u=n(83406),l=n(68928),c=n(19995),h=n(75878),p=n(47615),d=n(68808),y=n(45927),g=n(52410),f=n(6701);class _{constructor(){this._queryEngine=null,this._customParameters=null}destroy(){var e;null!==(e=this._queryEngine)&&void 0!==e&&e.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:n,getFeatureOutputFormat:r,fields:i,geometryType:o,featureType:u,objectIdField:p,customParameters:d}=e,{spatialReference:_,getFeatureSpatialReference:m}=(0,y.fU)(n,u,e.spatialReference);this._featureType=u,this._customParameters=d,this._getFeatureUrl=n,this._getFeatureOutputFormat=r,this._getFeatureSpatialReference=m;try{await(0,c._W)(m,_)}catch{throw new s.Z("unsupported-projection","Projection not supported",{inSpatialReference:m,outSpatialReference:_})}(0,a.k_)(t);const w=g.Z.fromLayerJSON({fields:i,dateFieldsTimeReference:i.some((e=>"esriFieldTypeDate"===e.type))?{timeZoneIANA:f.pt}:null}),F=await this._snapshotFeatures({fieldsIndex:w,geometryType:o,objectIdField:p,spatialReference:_},t.signal);return this._queryEngine=new h.q({fieldsIndex:w,geometryType:o,hasM:!1,hasZ:!1,objectIdField:p,spatialReference:_,timeInfo:null,featureStore:new l.Z({geometryType:o,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(F),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new s.Z("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){var t;return this._customParameters=e,null!==(t=this._snapshotTask)&&void 0!==t&&t.abort(),this._snapshotTask=(0,r.vr)((e=>this._snapshotFeatures(this._queryEngine,e))),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),(0,a.D_)(e)||i.Z.getLogger("esri.layers.WFSLayer").error(new s.Z("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))})),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e,t){var n;let{objectIdField:r,geometryType:s,spatialReference:i,fieldsIndex:l}=e;const h=await(0,y.Bm)(null!==(n=this._getFeatureUrl)&&void 0!==n?n:"",this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:t});(0,p.O3)(h,this._getFeatureSpatialReference.wkid),(0,a.k_)(t);const g=(0,p.lG)(h,{geometryType:s,hasZ:!1,objectIdField:r});if(!(0,o.fS)(i,this._getFeatureSpatialReference))for(const a of g)null!=a.geometry&&(a.geometry=(0,u.GH)((0,c.iV)((0,u.di)(a.geometry,s,!1,!1),this._getFeatureSpatialReference,i)));let f=1;for(const a of g){const e={};(0,d.O0)(l,e,a.attributes,!0),a.attributes=e,null==e[r]&&(a.objectId=e[r]=f++)}return g}}},68808:(e,t,n)=>{n.d(t,{O0:()=>p,av:()=>u,b:()=>f,d1:()=>c,og:()=>g});var r=n(63231),s=n(92975),i=n(37270);class a{constructor(){this.code=null,this.description=null}}class o{constructor(e){this.error=new a,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function u(e){return new o(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function c(e){return new l(e)}const h=new Set;function p(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];h.clear();for(const a in n){const s=e.get(a);if(!s)continue;const o=d(s,n[a]);if(h.add(s.name),s&&(r||s.editable)){const e=(0,i.Qc)(s,o);if(e)return u((0,i.vP)(e,s,o));t[s.name]=o}}for(const i of null!==(s=null===e||void 0===e?void 0:e.requiredFields)&&void 0!==s?s:[]){var s;if(!h.has(i.name))return u('missing required field "'.concat(i.name,'"'))}return null}function d(e,t){let n=t;return(0,i.H7)(e)&&"string"==typeof t?n=parseFloat(t):(0,i.qN)(e)&&null!=t&&"string"!=typeof t?n=String(t):(0,i.y2)(e)&&"string"==typeof t&&(n=(0,r.sG)(t)),(0,i.Pz)(n)}let y;function g(e,t){if(!e||!(0,s.JY)(t))return e;if("rings"in e||"paths"in e){if(null==y)throw new TypeError("geometry engine not loaded");return y.simplify(t,e)}return e}async function f(e,t){!(0,s.JY)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return null==y&&(y=await Promise.all([n.e(9058),n.e(3645)]).then(n.bind(n,50309))),y}()}}}]);
//# sourceMappingURL=8178.2ecd96bb.chunk.js.map