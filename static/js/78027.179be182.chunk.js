"use strict";(self.webpackChunksc_land=self.webpackChunksc_land||[]).push([[78027],{25810:(e,t,n)=>{n.d(t,{Z:()=>f});var i=n(27366),r=(n(59486),n(48805)),s=n(11582),o=n(17768),a=n(46784),l=n(49861),c=n(89125),u=(n(84936),n(93169),n(69912)),d=n(25243),h=n(585);let p=class extends((0,a.eC)(s.j)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=r.n.Direct,this.offset=0,this.orientation=0}};(0,i._)([(0,l.Cb)({type:["length"],json:{write:{isRequired:!0}}})],p.prototype,"type",void 0),(0,i._)([(0,l.Cb)({type:h.Z,json:{write:!0}})],p.prototype,"startPoint",void 0),(0,i._)([(0,l.Cb)({type:h.Z,json:{write:!0}})],p.prototype,"endPoint",void 0),(0,i._)([(0,l.Cb)({type:r.V,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"measureType",void 0),(0,i._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"offset",void 0),(0,i._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.p)((e=>o.BV.normalize((0,d.q9)(e),0,!0)))],p.prototype,"orientation",void 0),p=(0,i._)([(0,u.j)("esri.analysis.LengthDimension")],p);const f=p},48805:(e,t,n)=>{var i;n.d(t,{V:()=>r,n:()=>i}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));const r=[i.Horizontal,i.Vertical,i.Direct]},99894:(e,t,n)=>{function i(){return new Float32Array(4)}function r(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,n,i){const r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}function o(){return i()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function u(){return s(0,0,1,0)}function d(){return s(0,0,0,1)}n.d(t,{al:()=>s,d9:()=>r});const h=o(),p=a(),f=l(),_=c(),g=u(),m=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:m,UNIT_X:f,UNIT_Y:_,UNIT_Z:g,ZEROS:h,clone:r,create:i,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:d,unitX:l,unitY:c,unitZ:u,zeros:o},Symbol.toStringTag,{value:"Module"}))},97942:(e,t,n)=>{function i(e){let t,n,i=[],r=!1;return function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o,i)||(n=e.apply(this,o),t=this,i=o,r=!0),n}}n.d(t,{H:()=>i})},87072:(e,t,n)=>{function i(e){var t;const n=e.layer;return"floorInfo"in n&&null!==(t=n.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?s(e.view.floors,n.floorInfo.floorField):null}function r(e,t){var n;return"floorInfo"in t&&null!==(n=t.floorInfo)&&void 0!==n&&n.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(null===e||void 0===e||!e.length)return null;const n=e.filter((e=>""!==e)).map((e=>"'".concat(e,"'")));return n.push("''"),"".concat(t," IN (").concat(n.join(","),") OR ").concat(t," IS NULL")}n.d(t,{c:()=>i,f:()=>r})},78027:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Er});var i,r=n(27366),s=n(7138),o=n(42537),a=n(32718),l=n(92026),c=n(94172),u=n(49861),d=(n(93169),n(84936),n(69912)),h=n(98074),p=n(48805),f=n(68860),_=n(74177),g=n(16889),m=n(47898),v=n(29134),y=n(7025),S=n(32035),b=n(12400),w=n(14320),P=n(51378),C=n(55946),R=n(37818),M=n(9052),x=n(5986),T=n(92975),O=n(25003);function D(e,t,n){const r=A(e,t,n,i.Direct);return null!=r?(0,m.yG)(r.direct,r.unit):null}function E(e,t,n){const r=A(e,t,n,i.Horizontal);return null!=r?(0,m.yG)(r.horizontal,r.unit):null}function A(e,t,n,r){const s=(0,O.m)(n),o=(0,f.j5)(s);if(null==o)return null;const a=t[2]-e[2];if(r===i.Vertical)return{verticalSigned:a,unit:o};if(!(0,x.S)(e,n,L,s)||!(0,x.S)(t,n,G,s))return null;if(r===i.Direct)return{direct:(0,S.q)(G,L),unit:o};if((0,S.s)(U,e[0],e[1],t[2]),!(0,x.S)(U,n,U,s))return null;const l=(0,S.q)(U,G);return r===i.Horizontal?{horizontal:l,unit:o}:{direct:(0,S.q)(G,L),horizontal:l,vertical:Math.abs(a),unit:o}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(i||(i={}));const z=(0,b.Ue)(),j=(0,b.Ue)(),L=(0,b.Ue)(),G=(0,b.Ue)(),U=(0,b.Ue)();n(59486);var H=n(2170);n(96334);(0,b.Ue)();var k=n(94393),V=n(15559),F=n(47072),I=n(78952);function N(e,t,n){return(0,F.T)(n,Z,q,W,e,t,n)}function Z(e,t,n){return(0,m.yG)((0,V.cA)(Y,e,t,n).distance,"meters")}function q(e,t,n){return(0,m.yG)((0,H.geodesicLength)(function(e,t,n){return{type:"polyline",spatialReference:n,paths:[[[...e],[...t]]]}}(e,t,n),"meters"),"meters")}function W(e,t,n){return(0,k.k)(e,n,K)&&(0,k.k)(t,n,Q)?(0,m.yG)((0,V.cA)(Y,K,Q,I.Z.WGS84).distance,"meters"):null}const Y=new V._q,B=(0,b.Ue)(),X=(0,b.Ue)(),K=(0,b.Ue)(),Q=(0,b.Ue)();function J(e,t){var n;return null!==(n=function(e,t){if(!(0,T.fS)(e.spatialReference,t.spatialReference))return null;const{spatialReference:n}=e;return B[0]=e.x,B[1]=e.y,B[2]=e.hasZ?e.z:0,X[0]=t.x,X[1]=t.y,X[2]=t.hasZ?t.z:0,N(B,X,n)}(e,t))&&void 0!==n?n:function(e,t){const{spatialReference:n}=e;return(0,T.fS)(n,t.spatialReference)?(z[0]=e.x,z[1]=e.y,z[2]=e.hasZ?e.z:0,j[0]=t.x,j[1]=t.y,j[2]=t.hasZ?t.z:0,E(z,j,n)):null}(e,t)}(0,b.Ue)(),(0,b.Ue)();function $(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,dimension:{offset:i,measureType:r,orientation:s}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i,measureType:r,orientation:s}}function ee(e,t){var n,i,r;let{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,offset:a,measureType:l,orientation:c}=e,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==s||null==o)return null;const d=re(null!==(n=null===u||void 0===u?void 0:u.directSegment)&&void 0!==n?n:new M.y,{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o},t),h=null!==(i=null===u||void 0===u?void 0:u.primaryOffsetAxis)&&void 0!==i?i:(0,b.Ue)();ae(h,{measureType:l,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,directSegment:d,orientation:c,renderCoordsHelper:t});const f=null!==(r=null===u||void 0===u?void 0:u.dimensionSegment)&&void 0!==r?r:new M.y;return ce({elevationAlignedStartPoint:s,elevationAlignedEndPoint:o})&&l===p.n.Vertical?((0,S.c)(f.startRenderSpace,d.startRenderSpace),(0,S.c)(f.endRenderSpace,d.endRenderSpace)):ue(f,{offsetAxis:h,offset:a,relativeToSegment:d,renderCoordsHelper:t}),{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,directSegment:d,dimensionSegment:f,primaryOffsetAxis:h,spatialReference:t.spatialReference}}function te(e,t,n,i){return t===ne.Start?((0,S.c)(e.startRenderSpace,n.startRenderSpace),(0,S.c)(e.endRenderSpace,i.startRenderSpace)):((0,S.c)(e.startRenderSpace,n.endRenderSpace),(0,S.c)(e.endRenderSpace,i.endRenderSpace)),e}var ne;function ie(e,t,n,i){switch(t){case p.n.Direct:return re(e,n,i);case p.n.Horizontal:case p.n.Vertical:{const{elevationAlignedStartPoint:r,elevationAlignedEndPoint:s,dimension:o,geometry:a}=n;let l;o.measureType===p.n.Direct?(l=function(e,t){const n=e.directSegment.eval(.5,P.WM.get()),i=t.worldUpAtPosition(n,P.WM.get()),r=e.dimensionSegment.eval(.5,P.WM.get()),s=(0,S.z)(P.WM.get(),r,n);return!(0,S.G)(s,b.AG)&&(0,S.k)(s,i)>0}(a,i)===r.z>s.z,t===p.n.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment,{startRenderSpace:i,endRenderSpace:r}=e.directSegment;return(0,S.w)(i,t)<(0,S.w)(r,n)}(a);const[c,u]=l?[r,s]:[s,r],d=(0,R.WG)(u,se);return t===p.n.Horizontal?d.z=c.z:(d.x=c.x,d.y=c.y),i.toRenderCoords(c,e.startRenderSpace),i.toRenderCoords(d,e.endRenderSpace),e}}}function re(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(ne||(ne={}));const se=(0,C.T)(0,0,0,null);const oe=new M.y;function ae(e,t){const{measureType:n,elevationAlignedStartPoint:i,elevationAlignedEndPoint:r,directSegment:{startRenderSpace:s,endRenderSpace:o},directSegment:a,renderCoordsHelper:l}=t,c=a.eval(.5,P.WM.get()),u=l.worldUpAtPosition(c,P.WM.get()),d=l.worldBasisAtPosition(c,w.R.Y,P.WM.get());switch(n){case p.n.Horizontal:(0,S.c)(e,u);break;case p.n.Vertical:(0,S.k)(s,u)<(0,S.k)(o,u)?(0,S.z)(e,o,s):(0,S.z)(e,s,o),(0,S.b)(e,e,u),(0,S.b)(e,e,u);break;case p.n.Direct:{var h;const n=null!==(h=t.orientation)&&void 0!==h?h:0;if(ce({elevationAlignedStartPoint:i,elevationAlignedEndPoint:r}))(0,v.Us)(le,-(0,g.Vl)(n),u),(0,S.e)(e,d,le);else{const t=(0,S.z)(P.WM.get(),o,s),i=(0,S.b)(P.WM.get(),t,u);(0,S.b)(i,i,t),(0,v.Us)(le,(0,g.Vl)(n),t),(0,S.e)(e,i,le)}break}}return(0,S.G)(e,b.AG)?(0,S.c)(e,d):(0,S.n)(e,e)}const le=(0,y.Ue)();function ce(e){let{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;return null!=t&&null!=n&&t.x===n.x&&t.y===n.y}function ue(e,t){const{offsetAxis:n,offset:i,relativeToSegment:{startRenderSpace:r,endRenderSpace:s},relativeToSegment:o,renderCoordsHelper:a}=t,l=i/a.unitInMeters,[c,u]=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const r=(0,S.k)(t,n),s=(0,S.k)(e,n),o=Math.abs(r-s)+i;return r>s?[o,i]:[i,o]}(r,s,n,l);return(0,S.r)(e.startRenderSpace,o.startRenderSpace,n,c),(0,S.r)(e.endRenderSpace,o.endRenderSpace,n,u),e}function de(e,t,n){const i=t.directSegment.eval(.5,P.WM.get());return n.worldUpAtPosition(i,e)}function he(e,t){const{startRenderSpace:n,endRenderSpace:i}=t.directSegment;return(0,S.z)(e,i,n)}function pe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:i,endRenderSpace:r}=t.dimensionSegment;return n.invert?(0,S.z)(e,i,r):(0,S.z)(e,r,i)}function fe(e,t){const n=e.directSegment.eval(.5,P.WM.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}const _e=(0,b.Ue)();function ge(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n}=e;if(null==t||null==n)return!1;const i=function(e,t){const{spatialReference:n}=e;return(0,T.fS)(n,t.spatialReference)?(z[0]=e.x,z[1]=e.y,z[2]=e.hasZ?e.z:0,j[0]=t.x,j[1]=t.y,j[2]=t.hasZ?t.z:0,D(z,j,n)):null}(t,n);return null!=i&&(0,m.nn)(i,"meters").value>F.Y}function me(e){return null!=e.geometry}let ve=class extends s.Z{constructor(e){super(e)}initialize(){const e=(0,c.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._watchComputation(t)}));this.addHandles((0,o.ed)(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,_.R)(this.view)}_watchComputation(e){return(0,c.YP)((()=>$(e)),(t=>{const{measureType:n}=t;if(ge(t)&&n!==p.n.Direct){const t=Math.round((0,f.En)(F.Y,"meters","kilometers"));return a.Z.getLogger(this).warnOnce("A ".concat(n," dimension in the analysis (id: '").concat(this.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(t,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}const i=ee(t,this.view.renderCoordsHelper,e.geometry);e.geometry=i,e.result.length=function(e,t,n){if(null==e)return null;let i;if(t===p.n.Horizontal)i=J(e.elevationAlignedStartPoint,e.elevationAlignedEndPoint);else{const{startRenderSpace:t,endRenderSpace:n}=e.dimensionSegment;i=D(t,n,e.spatialReference)}if(null==i)return null;const r=t===p.n.Vertical?(0,f.yv)(i.value,i.unit,n):(0,f.wd)(i.value,i.unit,n);return(0,m.nn)(i,r)}(i,n,this._defaultUnit)}),c.tX)}};(0,r._)([(0,u.Cb)({constructOnly:!0})],ve.prototype,"analysisViewData",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],ve.prototype,"view",void 0),(0,r._)([(0,u.Cb)()],ve.prototype,"analysis",null),(0,r._)([(0,u.Cb)()],ve.prototype,"_defaultUnit",null),ve=(0,r._)([(0,d.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],ve);var ye=n(84702),Se=n(51995),be=n(17768),we=n(17842),Pe=n(86361),Ce=n(55652),Re=n(86950);function Me(e){return(0,Re.G)(e.accentColor,.5)}function xe(e){return(0,Re.mj)(e.accentColor)}const Te=new Se.Z([127,127,127,.5]),Oe=6,De=5;var Ee=n(35284),Ae=n(83639),ze=n(40508),je=n(51328),Le=n(2522),Ge=n(91526),Ue=n(40779),He=n(70619),ke=n(56529),Ve=n(4760),Fe=n(66156),Ie=n(58901),Ne=n(5693),Ze=n(99034),qe=n(585);class We{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of p.V)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case p.n.Direct:return this.direct;case p.n.Horizontal:return this.horizontal;case p.n.Vertical:return this.vertical}}}class Ye extends Ee.Z{constructor(e,t){const n=(0,Ae.EA)(Se.Z.toUnitRGBA(Me(e.effectiveTheme))),i=[new ze.r((0,He.PI)(n,1,32,32),ut)];super({view:e,renderObjects:i,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,c.YP)((()=>({color:Se.Z.toUnitRGBA(Me(e.effectiveTheme))})),(e=>n.setParameters(e)))}destroy(){this._themeHandle.remove(),super.destroy()}}class Be extends Ee.Z{constructor(e,t){let{lineSizePt:n,material:i,metadata:r}=t;super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:r}),this._options={calloutColor:(0,Pe.Ue)(),lineSizePt:n,material:i},this._themeHandle=(0,c.YP)((()=>Se.Z.toUnitRGBA(Me(e.effectiveTheme))),(e=>{this._options.calloutColor=e,ct(this,Xe({...this._options,metadata:this.metadata}))}),c.nn)}update(e){let{lineSizePt:t,material:n}=e;this._options.lineSizePt=t,this._options.material=n,ct(this,Xe({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function Xe(e){let{calloutColor:t,lineSizePt:n,material:i,metadata:r}=e;return{calloutLength:.25*Le.M_*.8*(0,we.F2)(n)+18,calloutColor:t,calloutWidth:2,customStateMask:ut,discScale:.3,focusMultiplier:2,material:i,metadata:r}}function Ke(e,t){let{computation:n,view:i}=t;return[(0,Ne.Xd)(e,((e,t,r)=>{Qe({cancel:r,computation:n,settingHeading:!1,steps:t,view:i})})),e.events.on("immediate-click",(e=>{!function(e,t,n){const{dimension:i,geometry:r}=t;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if(null==r)return;const{renderCoordsHelper:s}=n,o=ee({...$(t),orientation:90},s),a=ee({...$(t),orientation:270},s);if(null==o||null==a)return;const l=fe(o,s),c=fe(a,s),u=et(r,n),d=be.BV.shortestSignedDiff(u,l),h=be.BV.shortestSignedDiff(u,c);i.orientation=Math.abs(d)<Math.abs(h)?90:270,e.stopPropagation()}(e,n,i)}))]}function Qe(e){var t,n;const{cancel:i,computation:r,settingHeading:s,steps:o,view:a}=e;if(!me(r))return;const{renderCoordsHelper:l}=a,{dimension:c,geometry:u}=r,d=(0,b.Ue)(),h=rt((0,b.Ue)(),u,u.directSegment,l),p=st(P.WM.get(),{forHeading:s,geometry:u,renderCoordsHelper:l}),f=(0,Ce.Yq)(h,p,(0,Ce.Ue)()),_=s?null!==(t=c.orientation)&&void 0!==t?t:fe(u,a.renderCoordsHelper):null!==(n=c.orientation)&&void 0!==n?n:0;o.next((0,je._N)(a,f)).next((e=>{"start"===e.action&&(0,S.c)(d,e.renderStart);const t=(0,Ce.st)(f),n=(0,Ae.Gd)(d,e.renderEnd,h,t);let i=_-(0,g.BV)(n);s||(i=function(e){const t=be.BV.normalize(e)%90;return t<De?e-t:90-t<De?e+(90-t):e}(i)),c.orientation=i})),i.next((0,Ne.di)(c,["orientation"]))}function Je(e,t){let{computation:n,manipulatorMeasureType:i,view:r}=t,s=p.n.Direct,o=0,a=0;return[e.events.on("grab-changed",(t=>{if("start"!==t.action||!me(n))return;const{dimension:l,geometry:c}=n;s=l.measureType,o=l.offset,a=l.orientation;const u=(0,S.c)(P.WM.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,n,i){const{directSegment:r}=n,s=ae(P.WM.get(),{measureType:t,directSegment:r,renderCoordsHelper:i}),o=ue(oe,{offsetAxis:s,offset:0,relativeToSegment:r,renderCoordsHelper:i}).eval(.5,P.WM.get()),a=(0,S.z)(P.WM.get(),e,o);return(0,S.k)(a,s)*i.unitInMeters}(u,i,c,r.renderCoordsHelper),l.orientation=0})),(0,Ne.Xd)(e,((e,t,l)=>{if(!me(n))return;const{geometry:c,dimension:u}=n,{renderCoordsHelper:d}=r,h=ie(ft,i,n,d),p=ae(P.WM.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:d}),f=(0,je.J4)(e);t.next(f).next($e(r,u,h,p)),l.next(f).next((e=>(u.measureType=s,u.offset=o,u.orientation=a,e)))}))]}function $e(e,t,n,i){const r=(0,S.f)(P.WM.get(),n.endRenderSpace,n.startRenderSpace);(0,S.b)(r,r,i);const s=(0,Ce.Yq)(n.startRenderSpace,r,(0,Ce.Ue)()),o=(0,Ce.Yq)(n.startRenderSpace,i,(0,Ce.Ue)()),a=t.offset;let l,c=0;const u=new Ne.hM;return u.next((0,je._N)(e,s)).next((n=>{"start"===n.action&&(c=(0,Ce.jH)(o,n.renderStart));const i=((0,Ce.jH)(o,n.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=a+i,l=n})),e=>(u.execute(e),l)}function et(e,t){const{directSegment:n}=e,{renderCoordsHelper:i}=t,r=de(P.WM.get(),e,i),s=he(P.WM.get(),e),o=(0,S.b)(P.WM.get(),s,r),{viewForward:a}=t.state.camera;(0,S.k)(o,a)>0&&(0,S.h)(o,o,-1);const l=n.eval(.5,P.WM.get());return i.headingAtPosition(l,o)}function tt(e,t,n,i){let{forHeading:r}=i;const{dimension:s,geometry:o}=t,{primaryOffsetAxis:a}=o,l=(0,S.h)(nt,a,s.offset>=0?1:-1),c=st(it,{forHeading:r,geometry:o,renderCoordsHelper:n});(0,S.b)(c,c,l);const u=(0,Ae.Aq)(l,c,b.AG,pt);e.modelTransform=u,e.renderLocation=rt(dt,o,o.dimensionSegment,n)}const nt=(0,b.Ue)(),it=(0,b.Ue)();function rt(e,t,n,i){const{startRenderSpace:r,endRenderSpace:s}=n,o=function(e,t){const n=he(ot,e),i=de(at,e,t);return(0,S.k)(n,i)>0}(t,i)?r:s;return(0,S.c)(e,o)}function st(e,t){let{forHeading:n,geometry:i,renderCoordsHelper:r}=t;return n?de(e,i,r):pe(e,i,{invert:!0})}const ot=(0,b.Ue)(),at=(0,b.Ue)();function lt(e){return(0,we.F2)(e)+Oe}function ct(e,t){var n,i,r,s,o,a,l;const c=null!==(n=t.material)&&void 0!==n?n:new Fe.j({transparent:!0,writeDepth:!1,textureId:null===(i=t.texture)||void 0===i?void 0:i.id,renderOccluded:ke.yD.Opaque,isDecoration:!0}),u=null!==(r=t.focusMultiplier)&&void 0!==r?r:Ae.rotateManipulatorDefaults.focusMultiplier,d=null!==(s=t.calloutLength)&&void 0!==s?s:Ae.rotateManipulatorDefaults.calloutLength,h=Ae.rotateManipulatorDefaults.discRadius*(null!==(o=t.discScale)&&void 0!==o?o:1),p=h*u,f=(e,t)=>{const n=[0,1,2,2,3,0];return new Ue.Z(t,[[Ve.T.POSITION,new Ge.a([d-e,-e,0,d+e,-e,0,d+e,e,0,d-e,e,0],n,3,!0)],[Ve.T.UV0,new Ge.a([0,0,1,0,1,1,0,1],n,2,!0)]])},_=null!==(a=t.calloutWidth)&&void 0!==a?a:Ae.rotateManipulatorDefaults.calloutWidth,g=new Ie.U({width:_,color:t.calloutColor,renderOccluded:ke.yD.OccludeAndTransparent,isDecoration:!0}),m=(0,He.rh)(g,[[0,0,0],[d-h,0,0]]),v=(0,He.rh)(g,[[0,0,0],[d-p,0,0]]),y=null!==(l=t.customStateMask)&&void 0!==l?l:Ze.jg.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[d,0,0]},e.focusMultiplier=u,e.metadata=t.metadata,e.radius=h,e.renderObjects=[new ze.r(f(h,c),Ze.Q9.Unfocused|y),new ze.r(m,Ze.Q9.Unfocused|y),new ze.r(f(p,c),Ze.Q9.Focused|y),new ze.r(v,Ze.Q9.Focused|y)]}const ut=Ze.jg.Custom1,dt=(0,b.Ue)(),ht=(0,b.Ue)(),pt=(0,y.Ue)(),ft=new M.y;var _t,gt=n(25810),mt=n(100),vt=n(84652),yt=n(97942),St=n(66978),bt=n(46634);function wt(e,t,n){const{constraint:i,elevationAlignedStartPoint:r,elevationAlignedEndPoint:s,unconstrainedGeometry:o,view:a}=n,{dimension:l,previousConstraint:c,preConstraintProperties:u}=e;if(null==r||null==s)return;const d=()=>{"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==i)d(),null!=c&&null!=u&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType=p.n.Direct,i){case _t.Horizontal:if(i!==c&&(l.orientation=0),"startPoint"in t){const e=t.startPoint;null!=e&&(e.z=s.z),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.z=r.z),l.endPoint=e}break;case _t.Vertical:if(i!==c&&(l.orientation=et(o,a)),"startPoint"in t){const e=t.startPoint;null!=e&&(e.x=s.x,e.y=s.y),l.startPoint=e}else if("endPoint"in t){const e=t.endPoint;null!=e&&(e.x=r.x,e.y=r.y),l.endPoint=e}break;case _t.Direct:i!==c&&null!=u&&(l.orientation=u.orientation),d()}e.previousConstraint=i,e.unconstrainedGeometry=o}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(_t||(_t={}));var Pt=n(11526),Ct=n(74509),Rt=n(19093),Mt=n(99894),xt=n(70444),Tt=n(95773),Ot=n(85981),Dt=n(40885),Et=n(19182),At=n(62389),zt=n(19265),jt=n(39077);class Lt extends Et.i{constructor(e){super(e),this._ray=(0,Dt.Ue)(),this._isWorldDown=!1,this._start=(0,b.Ue)(),this._end=(0,b.al)(1,0,0),this._width=1,this._color=(0,Mt.al)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,Mt.al)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Vt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=ke.yD.OccludeAndTransparent,this._fadedExtensions=It,this._laserline=new At.W({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,S.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,S.f)(this._end,e,this._end),(0,Dt.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,S.j)(this._start,e)||((0,S.c)(this._start,e),(0,Dt.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,S.j)(this._end,e)||((0,S.c)(this._end,e),(0,Dt.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,Rt.a)(e,this._color)||((0,Rt.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,Rt.a)(e,this._innerColor)||((0,Rt.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,Rt.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,Mt.d9)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===ke.yD.OccludeAndTransparentStencil?ke.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:It,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:n}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(n),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(n)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new Ie.U(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const i=this._createGeometry(e);n.push(i),t.addGeometry(i),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Ie.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new jt.z(t)}_createGeometry(e){const t=this.extensionType===Vt.FADED,n=t?[(0,b.Ue)(),(0,b.Ue)(),(0,b.Ue)(),(0,b.Ue)()]:[(0,b.Ue)(),(0,b.Ue)()];return(0,He.rh)(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===Vt.FADED?this._updateLineSegmentFinite(kt):this._updateLineSegmentInfinite(this._extensionType,kt)}_updateLineSegmentFinite(e){return(0,Ot.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const n=this.view.state.camera;switch((0,xt.iL)(this._ray,Gt),e){case Vt.LINE:Gt.c0=-Number.MAX_VALUE;break;case Vt.RAY:case Vt.GROUND_RAY:{var i;const e=this._ray.origin,t=null!==(i=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==i?i:0,n=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&n<t&&(0,S.F)(Gt.ray.direction,Gt.ray.direction),this._extensionType===Vt.GROUND_RAY&&null!=t&&(Gt.c1=Math.abs(n-t));break}}if(!(0,Tt.zq)(n.frustum,Gt))return this._updateLineSegmentFinite(t);const r=(0,xt.Ws)(Gt,Ut),s=(0,xt.S$)(Gt,Ht);return(0,Ot.zk)(r,s,t)}_updateVertexAttributesObject3D(e,t){var n;const i=null===(n=e.geometries[0].getMutableAttribute(Ve.T.POSITION))||void 0===n?void 0:n.data;if(!i)return;let r=0;for(const s of this._lineVertices(t))i[r++]=s[0],i[r++]=s[1],i[r++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],Ve.T.POSITION)}_updateVertexAttributesDraped(e,t){var n;const i=null===(n=e.getMutableAttribute(Ve.T.POSITION))||void 0===n?void 0:n.data;if(!i)return;let r=0;for(const s of this._lineVertices(t))i[r++]=s[0],i[r++]=s[1],i[r++]=zt.gi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===Vt.FADED?(yield(0,Ot.KU)(e,-this.fadedExtensions.start,Ut),yield(0,Ot.KU)(e,0,Ut),yield(0,Ot.KU)(e,1,Ut),yield(0,Ot.KU)(e,1+this.fadedExtensions.end,Ut)):(yield(0,Ot.KU)(e,0,Ut),yield(0,Ot.KU)(e,1,Ut))}}const Gt=(0,xt.Ue)(),Ut=(0,b.Ue)(),Ht=(0,b.Ue)(),kt=(0,Ot.Ue)();var Vt;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(Vt||(Vt={}));const Ft=1/3,It={start:Ft,end:Ft};var Nt=n(13611),Zt=n(6644);class qt extends Et.i{constructor(e){super(e),this._location=(0,b.Ue)(),this._direction=(0,b.al)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,Mt.al)(1,0,1,1),this._renderOccluded=ke.yD.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,S.j)(this._location,e)||((0,S.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,S.j)(this._direction,e)||((0,S.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,S.n)(this._direction,(0,S.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,Rt.a)(e,this._color)||((0,Rt.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new Ie.U(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:e=>{e(t),n.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){const[i,r]=this._createGeometries(e);t.addGeometry(i),t.addGeometry(r),n.push(i),n.push(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Ie.U(this.materialParameters),t=(0,c.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new jt.z(e)))}_createGeometries(e){return[(0,He.rh)(e,[(0,b.Ue)(),(0,b.Ue)()]),(0,He.rh)(e,[(0,b.Ue)(),(0,b.Ue)()])]}_updateMaterial(){var e,t;const{materialParameters:n}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(n),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(n)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,Kt),(0,S.g)(Wt,this.location,this.direction),t.projectToScreen(Wt,Qt),(0,Nt.Fv)(Qt,(0,Nt.$X)(Qt,Qt,Kt)),this._updateVertexAttributesObject3D(t,e,0,Kt,Qt,1),this._updateVertexAttributesObject3D(t,e,1,Kt,Qt,-1)}_updateVertexAttributesObject3D(e,t,n,i,r,s){var o;const a=t.geometries[n],l=null===(o=a.getMutableAttribute(Ve.T.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:u}=this._computeStartEnd(r,i,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,we.c$)(c),Wt),l[0]=Wt[0],l[1]=Wt[1],l[2]=Wt[2],e.unprojectFromScreen((0,we.c$)(u),Wt),l[3]=Wt[0],l[4]=Wt[1],l[5]=Wt[2],t.geometryVertexAttributeUpdated(a,Ve.T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{location:i,width:r,length:s,offset:o}=this,a=Jt;a.spatialReference=t.renderer.spatialReference,a.x=i[0],a.y=i[1];const l=this.view.overlayPixelSizeInMapUnits(a)*n,c=r*l,u=s*l,d=o*l;this._updateVertexAttributesDraped(e[0],c,u,d,-1),this._updateVertexAttributesDraped(e[1],c,u,d,1)}_updateVertexAttributesDraped(e,t,n,i,r){var s;const o=null===(s=e.getMutableAttribute(Ve.T.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:c,end:u}=this._computeStartEnd(l,a,r,i,t,n);o[0]=c[0],o[1]=c[1],o[2]=zt.gi,o[3]=u[0],o[4]=u[1],o[5]=zt.gi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,n,i,r,s){const o=(0,Nt.bA)(Yt,(0,Nt.t8)(Yt,e[1]*n,e[0]*-n),i+r/2),a=(0,Nt.IH)(Bt,(0,Nt.IH)(Bt,(0,Nt.IH)(Bt,t,(0,Nt.bA)(Bt,e,s/2)),o),o);return{start:a,end:(0,Nt.IH)(Xt,a,(0,Nt.bA)(Xt,e,-s))}}}const Wt=(0,b.Ue)(),Yt=(0,Zt.Ue)(),Bt=(0,Zt.Ue)(),Xt=(0,Zt.Ue)(),Kt=(0,we.s1)(),Qt=(0,we.s1)(),Jt=(0,C.T)(0,0,void 0,null);var $t=n(66730),en=n(98917),tn=n(26279),nn=n(38054),rn=n(46784);let sn=class extends rn.wq{constructor(){super(...arguments),this.enabled=!0}};(0,r._)([(0,u.Cb)({type:Boolean})],sn.prototype,"enabled",void 0),sn=(0,r._)([(0,d.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],sn);let on=class extends rn.wq{constructor(e){super(e),this.lineSnapper=new sn,this.parallelLineSnapper=new sn,this.rightAngleSnapper=new sn,this.rightAngleTriangleSnapper=new sn,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Se.Z([255,127,0]),this.orangeTransparent=new Se.Z([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,r._)([(0,u.Cb)({type:sn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],on.prototype,"lineSnapper",void 0),(0,r._)([(0,u.Cb)({type:sn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],on.prototype,"parallelLineSnapper",void 0),(0,r._)([(0,u.Cb)({type:sn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],on.prototype,"rightAngleSnapper",void 0),(0,r._)([(0,u.Cb)({type:sn,constructOnly:!0,nonNullable:!0,json:{write:!0}})],on.prototype,"rightAngleTriangleSnapper",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],on.prototype,"shortLineThreshold",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],on.prototype,"distance",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],on.prototype,"pointThreshold",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],on.prototype,"intersectionParallelLineThreshold",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],on.prototype,"parallelLineThreshold",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],on.prototype,"verticalLineThresholdMeters",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],on.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],on.prototype,"pointOnLineThreshold",void 0),(0,r._)([(0,u.Cb)({type:Se.Z,nonNullable:!0})],on.prototype,"orange",void 0),(0,r._)([(0,u.Cb)({type:Se.Z,nonNullable:!0})],on.prototype,"orangeTransparent",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],on.prototype,"lineHintWidthReference",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],on.prototype,"lineHintWidthTarget",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],on.prototype,"lineHintFadedExtensions",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],on.prototype,"parallelLineHintWidth",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],on.prototype,"parallelLineHintLength",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],on.prototype,"parallelLineHintOffset",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],on.prototype,"rightAngleHintSize",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],on.prototype,"rightAngleHintOutlineSize",void 0),(0,r._)([(0,u.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],on.prototype,"satisfiesConstraintScreenThreshold",void 0),on=(0,r._)([(0,d.j)("esri.views.interactive.snapping.Settings.Defaults")],on);const an=new on;var ln=n(80371),cn=n(34356),un=n(55054);class dn extends un.r{constructor(e,t){super(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:ln.B.ALL),this.intersectionPoint=e}equals(e){return e instanceof dn&&(0,S.j)(this.intersectionPoint,e.intersectionPoint)}}var hn=n(53397);class pn extends un.r{constructor(e,t,n){super(n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:ln.B.ALL),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof pn&&(0,S.j)(this.lineStart,e.lineStart)&&(0,S.j)(this.lineEnd,e.lineEnd)}}var fn=n(61309);class _n extends un.r{constructor(e,t,n,i){super(i,arguments.length>4&&void 0!==arguments[4]?arguments[4]:ln.B.ALL),this.previousVertex=e,this.centerVertex=t,this.nextVertex=n}equals(e){return e instanceof _n&&(0,S.j)(this.previousVertex,e.previousVertex)&&(0,S.j)(this.centerVertex,e.centerVertex)&&(0,S.j)(this.nextVertex,e.nextVertex)}}class gn{draw(e,t){const n=this._getUniqueHints(e),i=this.sortUniqueHints(n),r=[];for(const s of i)s instanceof dn&&r.push(this.visualizeIntersectionPoint(s,t)),s instanceof hn.w&&r.push(this.visualizeLine(s,t)),s instanceof pn&&r.push(this.visualizeParallelSign(s,t)),s instanceof _n&&r.push(this.visualizeRightAngleQuad(s,t)),s instanceof fn.n&&r.push(this.visualizePoint(s,t));return(0,o.AL)(r)}sortUniqueHints(e){return e}_getUniqueHints(e){const t=[];for(const n of e){let e=!0;for(const i of t)if(n.equals(i)){e=!1;break}e&&t.push(n)}return t}}var mn=n(11208);class vn extends gn{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof hn.w?t.length:0)-(e instanceof hn.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:n,view:i}=t,r=yn(t);return(0,o.ed)(new $t.L({view:i,primitive:"circle",geometry:(0,nn.Ju)(e.intersectionPoint,n),elevationInfo:e.isDraped?Ct.tR:Ct.jG,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:n,spatialReference:i}=t,r=yn(t),s=Sn(e.point,e.domain,t);return(0,o.ed)(new $t.L({view:n,primitive:"circle",geometry:(0,nn.Ju)(s,i),elevationInfo:bn(e,t),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:n,spatialReference:i}=t,r=yn(t),s=Sn(e.lineStart,e.domain,t),a=Sn(e.lineEnd,e.domain,t);return(0,o.ed)(this._createLineSegmentHint(e.type,s,a,i,bn(e,t),n,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:n,spatialReference:i}=t,r=yn(t),{isDraped:s}=e,a=bn(e,t),l=Sn(e.lineStart,e.domain,t),c=Sn(e.lineEnd,e.domain,t),u=Pn(l,i,a,n,s),d=Pn(c,i,a,n,s),h=(0,S.m)(d,u,d,.5),p=new qt({view:n,attached:!1,offset:an.parallelLineHintOffset,length:an.parallelLineHintLength,width:an.parallelLineHintWidth,color:r.parallelSignColor,location:h,renderOccluded:s?ke.yD.OccludeAndTransparent:ke.yD.Opaque,isDraped:s,renderGroup:tn.eZ.SnappingHint,isDecoration:!0});return p.setDirectionFromPoints(u,h),p.attached=!0,(0,o.ed)(p)}visualizeRightAngleQuad(e,t){const{view:n,spatialReference:i}=t,r=yn(t),s=bn(e,t),{isDraped:a}=e,l=Sn(e.previousVertex,e.domain,t),c=Sn(e.centerVertex,e.domain,t),u=Sn(e.nextVertex,e.domain,t),d=Pn(l,i,s,n,a),h=Pn(c,i,s,n,a),p=Pn(u,i,s,n,a);return(0,o.ed)(new en.R({view:n,attached:!0,color:a?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:a?ke.yD.OccludeAndTransparent:ke.yD.Transparent,outlineRenderOccluded:a?ke.yD.OccludeAndTransparent:ke.yD.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:an.rightAngleHintOutlineSize,size:an.rightAngleHintSize,isDraped:a,geometry:{previous:d,center:h,next:p},renderGroup:tn.eZ.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,n,i,r,s,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const u=Pn(t,i,r,s,a),d=Pn(n,i,r,s,a),h=new Lt({view:s,extensionType:Vt.FADED,start:u,end:d,isDraped:a,color:o.lineColor,renderOccluded:a?ke.yD.OccludeAndTransparent:ke.yD.Opaque,renderGroup:tn.eZ.SnappingHint,isDecoration:!0});switch(e){case cn.ze.TARGET:h.width=an.lineHintWidthTarget,h.fadedExtensions={start:0,end:an.lineHintFadedExtensions};break;case cn.ze.REFERENCE_EXTENSION:h.width=an.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case cn.ze.REFERENCE:h.width=an.lineHintWidthReference,h.fadedExtensions={start:l?an.lineHintFadedExtensions:0,end:c?an.lineHintFadedExtensions:0}}return h.attached=!0,h}}function yn(e){const{effectiveTheme:t}=e.view,n=Se.Z.toUnitRGBA(t.accentColor),i=[0,0,0,0];return{intersectionPointColor:i,intersectionPointOutlineColor:n,pointColor:i,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:Se.Z.toUnitRGBA((0,Re.G)(t.accentColor,.5)),rightAngleOutlineColor:n}}function Sn(e,t,n){const i=wn(t,n);return null==i?e:(0,nn.Ue)(e[0],e[1],i)}function bn(e,t){return null!=wn(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?Ct.tR:Ct.jG}function wn(e,t){let{selfSnappingZ:n}=t;return e===ln.B.SELF&&null!=n?n.value:null}function Pn(e,t,n,i,r){const s=(0,b.Ue)();if(r){const n=i.basemapTerrain.overlayManager.renderer.spatialReference;(0,x.S)(e,t,s,n)}else(0,mn.RS)(e,t,n,i,s);return s}var Cn=n(33837),Rn=n(52168),Mn=n(78935),xn=n(86372),Tn=n(69691);var On=n(68401),Dn=n(11606);class En extends Rn._{constructor(e){super(e),this.view=null,this._renderOccluded=ke.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,Pe.nI)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,Pe.nI)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,Rt.a)(e,this._color)||((0,Rt.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,Rt.a)(e,this._outlineColor)||((0,Rt.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,n,i,r){const s=(0,xn.bg)(3*e.length),o=(0,xn.bg)(s.length);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const a=(0,Tn.rR)(s,t,0,o,0,s,0,s.length/3,n,i,r),l=null!=a;return{numVertices:e.length,position:s,mapPositions:o,projectionSuccess:l,sampledElevation:a}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Mn.o.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,r=t.position;for(let s=0;s<i;++s){const e=(0,S.s)(An,r[3*s],r[3*s+1],r[3*s+2]),t=zn(this._vertexMaterial,.5,e),i=zn(this._vertexOutlineMaterial,.5,e);n.push({vertexGeometry:t,vertexOutlineGeometry:i})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:n,vertexOutlineGeometry:i}of t)e.addGeometry(n),e.addGeometry(i)}createExternalResources(){this._vertexMaterial=new Dn.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:On.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Dn.Q({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:On.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const An=(0,b.Ue)();function zn(e,t,n){return(0,He.PI)(e,t,16,16,{offset:n})}var jn=n(86700),Ln=n(14813),Gn=n(84954),Un=n(95172),Hn=n(70758),kn=n(80987);let Vn=class extends s.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new kn.Z}};(0,r._)([(0,u.Cb)({constructOnly:!0})],Vn.prototype,"layer",void 0),(0,r._)([(0,u.Cb)()],Vn.prototype,"enabled",void 0),(0,r._)([(0,u.Cb)()],Vn.prototype,"updating",void 0),(0,r._)([(0,u.Cb)()],Vn.prototype,"availability",void 0),(0,r._)([(0,u.Cb)()],Vn.prototype,"sublayerSources",void 0),Vn=(0,r._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Vn);const Fn=Vn;var In=n(63780);let Nn=class extends s.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new kn.Z,this.distance=an.distance,this.touchSensitivityMultiplier=an.touchSensitivityMultiplier,this.constraintsActive=!1}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var e,t,n;const i=this.featureSources;i.some(qn)&&a.Z.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const r=i.filter(Yn),s=null!==(e=null===(t=this._get("_effectiveFeatureSources"))||void 0===t?void 0:t.filter(qn))&&void 0!==e?e:new kn.Z;for(const a of r){const e=s.find((e=>e.layer===a.layer.parent));if(e)e.sublayerSources.includes(a)||e.sublayerSources.add(a);else if(a.layer.parent){const e=new Fn({layer:a.layer.parent});e.sublayerSources.add(a),s.add(e)}}for(const a of s){const e=a.sublayerSources.filter((e=>!r.includes(e)));a.sublayerSources.removeMany(e)}s.removeMany(s.filter((e=>0===e.sublayerSources.length)));const o=i.filter(Wn),l=null!==(n=this._get("_effectiveFeatureSources"))&&void 0!==n?n:new kn.Z,{added:c,removed:u}=(0,In.e5)(l.toArray(),[...o,...s]);return l.removeMany(u),l.addMany(c),l}};(0,r._)([(0,u.Cb)()],Nn.prototype,"enabled",void 0),(0,r._)([(0,u.Cb)()],Nn.prototype,"enabledToggled",void 0),(0,r._)([(0,u.Cb)()],Nn.prototype,"forceDisabled",void 0),(0,r._)([(0,u.Cb)()],Nn.prototype,"selfEnabled",void 0),(0,r._)([(0,u.Cb)()],Nn.prototype,"featureEnabled",void 0),(0,r._)([(0,u.Cb)({type:kn.Z.ofType(Fn)})],Nn.prototype,"featureSources",void 0),(0,r._)([(0,u.Cb)()],Nn.prototype,"distance",void 0),(0,r._)([(0,u.Cb)()],Nn.prototype,"touchSensitivityMultiplier",void 0),(0,r._)([(0,u.Cb)()],Nn.prototype,"constraintsActive",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],Nn.prototype,"effectiveEnabled",null),(0,r._)([(0,u.Cb)({readOnly:!0})],Nn.prototype,"effectiveSelfEnabled",null),(0,r._)([(0,u.Cb)({readOnly:!0})],Nn.prototype,"effectiveFeatureEnabled",null),(0,r._)([(0,u.Cb)({readOnly:!0})],Nn.prototype,"_effectiveFeatureSources",null),Nn=(0,r._)([(0,d.j)("esri.views.interactive.snapping.SnappingOptions")],Nn);const Zn=Nn;function qn(e){return"subtype-group"===e.layer.type}function Wn(e){return"subtype-group"!==e.layer.type}function Yn(e){return"subtype-sublayer"===e.layer.type}var Bn=n(24204),Xn=n(44179),Kn=n(76672),Qn=n(18661),Jn=n(87072),$n=n(37933),ei=n(69787);let ti=class extends s.Z{get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){var e,t,n;const{layer:i,snappingSource:r}=this;if(!(0,$n.e9)(i)||null===(e=i.subtypes)||void 0===e||!e.length)return{mode:"not-in-use",filter:null};const s=r.layerSource.sublayerSources.filter((e=>{var t;return e.enabled&&e.layer.visible&&(0,ei.rs)(null===(t=this.view)||void 0===t?void 0:t.scale,e.layer.effectiveScaleRange.minScale,e.layer.effectiveScaleRange.maxScale)})).map((e=>e.layer.subtypeCode));if(!s.length)return{mode:"none-visible",filter:null};if(s.length===i.subtypes.length)return{mode:"all-visible",filter:null};const o=null!==(t=null===(n=i.fieldsIndex.get(i.subtypeField))||void 0===n?void 0:n.name)&&void 0!==t?t:i.subtypeField;return 1===s.length?{mode:"in-use",filter:"".concat(o," = ").concat(s.getItemAt(0))}:{mode:"in-use",filter:"".concat(o," IN (").concat(s.join(", "),")")}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,Jn.c)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const n=e;this.addHandles(n.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,c.YP)((()=>t.updating),(e=>t.layerSource.updating=e),c.tX),(0,c.YP)((()=>t.availability),(e=>t.layerSource.availability=e),c.tX)])}getFetchCandidatesParameters(e,t,n){var i,r,s,o,a;if(!this.valid)return[];const{layer:l,layerView:c,floorFilter:u,rulesTable:d,subtypeFilter:h}=this,p={distance:n,mode:null!==(i=null===(r=this.view)||void 0===r?void 0:r.type)&&void 0!==i?i:"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:c&&"filter"in c?c.filter:null};if(u&&(p.filter=ni(p.filter,u)),"not-in-use"!==h.mode&&"all-visible"!==h.mode){if("none-visible"===h.mode)return[];p.filter?p.filter.where=(0,Kn._)(p.filter.where,h.mode):p.filter=new Qn.Z({where:h.filter})}const f=t.feature,_="subtype-sublayer"===(null===f||void 0===f||null===(s=f.sourceLayer)||void 0===s?void 0:s.type)?f.sourceLayer.parent:null===f||void 0===f?void 0:f.sourceLayer;if(d&&f&&(0,cn.n0)(null===(o=this.view)||void 0===o?void 0:o.map)&&((0,$n.Te)(l)||(0,$n.e9)(l))&&l.layerId&&((0,$n.Te)(_)||(0,$n.e9)(_))&&null!==(a=this.view.map.utilityNetworks)&&void 0!==a&&a.find((e=>e.isUtilityLayer(_)))){var g;if("loaded"!==d.loadStatus)return[];const e=[],t=l.layerId,n=null===(g=d.getFeatureSQL(_,f))||void 0===g?void 0:g[t];if(!n)return[];const i=n.anyVertex;let r=n.endVertex;return r&&i&&r===i&&(r=""),r&&e.push({...p,returnEdge:!1,vertexMode:"ends",filter:ni(p.filter,r)}),i&&e.push({...p,returnEdge:!1,vertexMode:"all",filter:ni(p.filter,i)}),e}return[p]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,cn.n0)(null===t||void 0===t?void 0:t.map)&&((0,$n.Te)(e)||(0,$n.e9)(e))){var n;const s=null===(n=t.map.utilityNetworks)||void 0===n?void 0:n.find((t=>t.isUtilityLayer(e)));if(s)try{var i;this.rulesTable=await s.getRulesTable(),await(null===(i=this.rulesTable)||void 0===i?void 0:i.load())}catch(r){return void a.Z.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function ni(e,t){return null==e?new Qn.Z({where:t}):e.where?new Qn.Z({where:(0,Kn._)(e.where,t)}):new Qn.Z({where:t})}(0,r._)([(0,u.Cb)({constructOnly:!0})],ti.prototype,"layer",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],ti.prototype,"snappingSource",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],ti.prototype,"view",void 0),(0,r._)([(0,u.Cb)()],ti.prototype,"layerView",null),(0,r._)([(0,u.Cb)()],ti.prototype,"rulesTable",void 0),(0,r._)([(0,u.Cb)()],ti.prototype,"valid",null),(0,r._)([(0,u.Cb)()],ti.prototype,"subtypeFilter",null),(0,r._)([(0,u.Cb)()],ti.prototype,"floorFilter",null),(0,r._)([(0,u.Cb)()],ti.prototype,"_valid",void 0),ti=(0,r._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],ti);var ii,ri=n(97760),si=n(95905),oi=n(75691),ai=n(92605);class li extends ai.j{constructor(e){let{targetPoint:t,constraint:n,previousVertex:i,otherVertex:r,otherVertexType:s,objectId:o,isDraped:a}=e;super(t,n,a,ln.B.SELF),this.previousVertex=i,this.otherVertex=r,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===ii.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===ii.CENTER?this.targetPoint:this.otherVertex;return[new hn.w(cn.ze.TARGET,t,n,this.isDraped,this.domain),new hn.w(cn.ze.REFERENCE,e,t,this.isDraped,this.domain),new _n(this.previousVertex,t,n,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(ii||(ii={}));let ci=class extends s.Z{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=ln.B.FEATURE,this._updatingHandles=new bt.R,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,c.TP)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e._effectiveFeatureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,o.ed)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,n,i){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const r=[],s=this._computeScreenSizeDistanceParameters(e,n);for(const l of this._snappingSources){var o;if(null==l||!l.valid||!l.snappingSource.layerSource.enabled||null!==(o=l.layerView)&&void 0!==o&&o.suspended)continue;const t=l.getFetchCandidatesParameters(e,n,s);for(const e of t)r.push(l.snappingSource.fetchCandidates(e,i).then((e=>e.filter((e=>!this._candidateIsExcluded(l.snappingSource,e,n.excludeFeature))))))}const a=(await(0,St.OT)(r)).flat();return this._addRightAngleCandidates(a,e,s,n),(0,St.k_)(i),(0,cn.lQ)(e,a),a}_addRightAngleCandidates(e,t,n,i){var r,s,o,a;const l=null!=i.vertexHandle?null===(r=i.vertexHandle.rightEdge)||void 0===r||null===(r=r.rightVertex)||void 0===r?void 0:r.pos:null!=i.editGeometryOperations&&"polygon"===i.editGeometryOperations.data.type?null===(s=i.editGeometryOperations.data.components[0])||void 0===s||null===(s=s.getFirstVertex())||void 0===s?void 0:s.pos:null,c=null!=i.vertexHandle?null===(o=i.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=i.editGeometryOperations?null===(a=i.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:u}=this,d=(0,nn.j7)(l,u,i),h=(0,nn.j7)(c,u,i),p=e.length;for(let f=0;f<p;f++)this._addRightAngleCandidate(e[f],h,t,n,e),this._addRightAngleCandidate(e[f],d,t,n,e)}_addRightAngleCandidate(e,t,n,i,r){if(null==t||!function(e){return(e instanceof si.L||e instanceof ri.k)&&!function(e){let{constraint:{start:t,end:n}}=e;const i=(0,S.a)(t,n),r=(0,Nt.bI)((0,nn.eR)(t),(0,nn.eR)(n));return i<(0,Bn.bn)()||r/i<pi}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-n[0])/i.x,a=(s[1]-n[1])/i.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const n=new li({targetPoint:s,otherVertex:t,otherVertexType:ii.NEXT,previousVertex:(0,Nt.bI)((0,nn.eR)(s),(0,nn.eR)(l))>(0,Nt.bI)((0,nn.eR)(s),(0,nn.eR)(c))?l:c,constraint:new Xn.aU(t,s),objectId:e.objectId,isDraped:e.isDraped});r.push(n)}}_computeScreenSizeDistanceParameters(e,t){let n=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:n,y:n,z:n,distance:n}:"2d"===this.view.type?(n*=this.view.resolution,{x:n,y:n,z:n,distance:n}):this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,n,i){const{spatialReference:r}=i;n.renderCoordsHelper.toRenderCoords(e,r,di);const s=n.state.camera.computeScreenPixelSizeAt(di),o=s*n.renderCoordsHelper.unitInMeters,a=o/(0,f.c9)(r),l=o/(0,f._R)(r),c=t*a,u=t*l,d=(0,mn.Rs)(e,r,Ct.jG,n),h=d?ui(d,e,a,0,0,n,i):0,p=d?ui(d,e,0,a,0,n,i):0,_=d?ui(d,e,0,0,l,n,i):0;return{x:0===h?0:c/h,y:0===p?0:c/p,z:0===_?0:u/_,distance:s*t}}_candidateIsExcluded(e,t,n){if(null==n)return!1;const i=this._getCandidateObjectId(t);if(null==i)return!1;const r=e.layerSource.layer;return"graphics"===r.type?n.uid===i:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===i}_getCandidateObjectId(e){return e instanceof oi.a?e.objectId:null}async _createSourceInfo(e,t){const n=e.layer;n.loaded||(await n.load(),(0,St.k_)(t));const{view:i}=this,r=await this._createFeatureSnappingSourceType(e);return(0,St.k_)(t),new ti(null==r?{}:{snappingSource:r,view:i,layer:n})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,n;return null!==(t=null===(n=e.layer.sublayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),n={module:null,loader:t};this._sourceModules[e]=n;const i=await t,r={module:i,loader:t};return this._sourceModules[e]=r,i}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(n.e(5532).then(n.bind(n,5532)));case"featureCollection":return t.addPromise(n.e(26823).then(n.bind(n,26823)));case"graphics":case"notes":return t.addPromise(Promise.all([n.e(54054),n.e(45026),n.e(71486),n.e(14346),n.e(33518)]).then(n.bind(n,33518)));case"scene":return t.addPromise(n.e(92767).then(n.bind(n,92767)))}}get test(){return{snappingSources:this._snappingSources}}};function ui(e,t,n,i,r,s,o){let{spatialReference:a}=o;const l=(0,S.c)(hi,t);l[0]+=n,l[1]+=i,l[2]+=r;const c=(0,mn.Rs)(l,a,Ct.jG,s);return c?(0,cn.fG)(c,e):1/0}(0,r._)([(0,u.Cb)({constructOnly:!0})],ci.prototype,"spatialReference",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],ci.prototype,"view",void 0),(0,r._)([(0,u.Cb)()],ci.prototype,"options",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],ci.prototype,"updating",null),(0,r._)([(0,u.Cb)()],ci.prototype,"_snappingSources",void 0),ci=(0,r._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],ci);const di=(0,b.Ue)(),hi=(0,b.Ue)(),pi=1e-4;var fi,_i=n(91505),gi=n(79803);class mi{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=an.shortLineThreshold*an.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,nn.j7)(e.leftVertex.pos,this.view,t),(0,nn.j7)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,n){let{spatialReference:i}=n;return 0===this.squaredShortLineThreshold||(0,cn.Bb)((0,mn.Rs)(t,i,Ct.jG,this.view),(0,mn.Rs)(e,i,Ct.jG,this.view))>this.squaredShortLineThreshold}isVertical(e,t,n){let{spatialReference:i}=n;const r=(0,f.c9)(i);return(0,Nt.TE)((0,nn.eR)(e),(0,nn.eR)(t))*r<an.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}}class vi extends ai.j{constructor(e){let{lineStart:t,lineEnd:n,targetPoint:i,isDraped:r}=e;super(i,new Xn.jg(t,n),r,ln.B.SELF),this._referenceLineHint=new hn.w(cn.ze.REFERENCE_EXTENSION,t,n,r,this.domain)}get hints(){return[this._referenceLineHint,new hn.w(cn.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}!function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"}(fi||(fi={}));(()=>{const e=(0,b.Ue)(),t=(0,b.Ue)()})();const yi=(()=>{const e=(0,Zt.Ue)(),t=(0,b.Ue)(),n=(0,b.Ue)();return(i,r,s,o)=>{if((0,S.j)(i,r))return;const a=(0,V.Lc)(s),l=(0,V.Lc)(o);if(a&&l&&(0,T.fS)(a,l)&&(0,x.S)(i,s,t,a)&&(0,x.S)(r,o,n,l)){const{azimuth:e}=(0,V.cA)(wi,t,n,a);return null!=e?(0,f.En)(e,"degrees","radians"):void 0}e[0]=r[0]-i[0],e[1]=r[1]-i[1];let c=(0,Nt.EU)(Zt.IO,e);return e[0]<0&&(c=Pi-c),c}})();const Si=(()=>{const e=(0,b.Ue)();return function(t,n,i,r,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,S.c)(e,n);const a=bi(s);if("geodesic"===o){const s=(0,V.Lc)(i);if(s&&(0,x.S)(e,i,e,s))return(0,V.TB)(t,e,a,r,s),t[2]=n[2],!!(0,x.S)(t,s,t,i)}const l=(0,m.hw)(a,"geographic","arithmetic"),c=(0,f.En)(l,"degrees","radians"),u=n[0]+r*Math.cos(c),d=n[1]+r*Math.sin(c),h=n[2];return(0,S.s)(t,u,d,h),!0}})();function bi(e){return null!=e?(0,m.hw)((0,f.En)(e.value,e.unit,"degrees"),e.rotationType,"geographic"):void 0}const wi=new V._q,Pi=2*Math.PI;new be.pE(-180,180);var Ci=n(55793),Ri=n(94163);class Mi extends mi{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=[];if(i<1)return r;const{spatialReference:s}=t,o=(0,mn.Rs)(e,s,Ct.jG,this.view),{view:a}=this,l=n.edges[i-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const n=(0,cn._j)(c,a,t);this._processCandidateProposal(n.left,n.right,e,o,t,r)}c=c.leftVertex.leftEdge}while(c&&c!==l);return r}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return n;const{view:s}=this,{spatialReference:o}=t,a=(0,mn.Rs)(e,o,Ct.jG,s),l=i.leftEdge,c=i.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,nn.j7)(l.leftVertex.pos,s,t),(0,nn.j7)(c.rightVertex.pos,s,t),e,a,t,n);const u=r.edges[0];let d=u;do{if(d!==i.leftEdge&&d!==i.rightEdge&&this.edgeExceedsShortLineThreshold(d,t)){const i=(0,cn._j)(d,s,t);this._processCandidateProposal(i.left,i.right,e,a,t,n)}d=d.rightVertex.rightEdge}while(d&&d!==u);return n}_processCandidateProposal(e,t,n,i,r,s){var o;const{spatialReference:a,pointer:l}=r,c=(0,b.Ue)();this._projectedLine(c,e,t,n,r);const u=(0,nn.uo)(c);(0,cn.Bb)(i,(0,mn.Rs)(u,a,Ct.jG,this.view))<this.squaredProximityThreshold(l)&&s.push(new vi({lineStart:e,lineEnd:t,targetPoint:u,isDraped:"on-the-ground"===(null===(o=r.elevationInfo)||void 0===o?void 0:o.mode)}))}_projectedLine(e,t,n,i,r){this._projectToLineGeodesic(e,t,n,i,r)||this._projectToLinePlanar(e,i,t,n)}_projectToLineGeodesic(e,t,n,i,r){let{spatialReference:s}=r;const o=yi(t,n,s,s);if(null==o)return!1;const a=yi(n,i,s,s);if(null==a)return!1;const l=N(n,i,s);if(null==l)return!1;const c=Math.abs(be.Q4.shortestSignedDiff(o,a))>Math.PI/2?be.c5.normalize(o+Math.PI):o;return Si(e,n,s,(0,m.mE)(l,"meters"),(0,m.GJ)(c,"radians","geographic"),"geodesic"),e[2]=i[2],!0}_projectToLinePlanar(e,t,n,i){(0,Ci.ZE)(t,{start:n,end:i,type:Ri.SP.LINE},e),e[2]=t[2]}}class xi extends ai.j{constructor(e){let{referenceLine:t,lineStart:n,targetPoint:i,isDraped:r}=e;const s=(0,b.d9)(n),{left:o,right:a}=t;(0,S.f)(s,(0,S.g)(s,s,a),o),super(i,new Xn.jg(n,(0,nn.uo)(s)),r,ln.B.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new hn.w(cn.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new pn(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new hn.w(cn.ze.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((n=>{(0,S.j)(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),(0,S.j)(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),(0,S.j)(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),(0,S.j)(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class Ti extends mi{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=n.vertices.length,s=[];if(i<2)return s;const{view:o}=this,a=(0,mn.Rs)(e,t.spatialReference,Ct.jG,o),l=(0,nn.j7)(n.vertices[r-1].pos,o,t),c=(0,nn.j7)(n.vertices[0].pos,o,t),u=n.edges[i-1];let d=u;do{if(this.edgeExceedsShortLineThreshold(d,t)){const n=(0,cn._j)(d,o,t);this._checkEdgeForParallelLines(n,l,e,a,t,s),this._checkEdgeForParallelLines(n,c,e,a,t,s)}d=d.leftVertex.leftEdge}while(d&&d!==u);return s}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<3)return n;const{view:s}=this,o=(0,mn.Rs)(e,t.spatialReference,Ct.jG,s),a=i.leftEdge,l=i.rightEdge,c=r.vertices[0],u=(0,nn.j7)(c.pos,s,t),d=r.vertices.length,h=r.vertices[d-1],p=(0,nn.j7)(h.pos,s,t),f=r.edges[0];let _=f;do{if(_!==a&&_!==l&&this.edgeExceedsShortLineThreshold(_,t)){const r=(0,cn._j)(_,s,t);a&&this._checkEdgeForParallelLines(r,(0,nn.j7)(a.leftVertex.pos,s,t),e,o,t,n),l&&this._checkEdgeForParallelLines(r,(0,nn.j7)(l.rightVertex.pos,s,t),e,o,t,n),i===c?this._checkEdgeForParallelLines(r,p,e,o,t,n):i===h&&this._checkEdgeForParallelLines(r,u,e,o,t,n)}_=_.rightVertex.rightEdge}while(_&&_!==f);return n}_checkEdgeForParallelLines(e,t,n,i,r,s){const o=e.left,a=e.right;if((0,Ri.k0)(Oi,(0,nn.eR)(t),(0,nn.eR)(o),(0,nn.eR)(a)),(0,Nt.bI)(Oi,(0,nn.eR)(t))<an.parallelLineThreshold)return;(0,Ri.k0)(Oi,(0,nn.eR)(n),(0,nn.eR)(o),(0,nn.eR)(a),(0,nn.eR)(t));const{spatialReference:l,pointer:c}=r,u=(0,nn.al)(Oi[0],Oi[1],n[2]);if((0,cn.Bb)(i,(0,mn.Rs)(u,l,Ct.jG,this.view))<this.squaredProximityThreshold(c)){var d;if(this.isVertical(u,t,r)||this.isVertical(o,a,r))return;if(this._parallelToPreviousCandidate(e,s))return;s.push(new xi({referenceLine:e,lineStart:t,targetPoint:u,isDraped:"on-the-ground"===(null===(d=r.elevationInfo)||void 0===d?void 0:d.mode)}))}}_parallelToPreviousCandidate(e,t){const n=e.left,i=e.right;for(const r of t)if((0,Ri.k0)(Oi,(0,nn.eR)(i),(0,nn.eR)(r.constraint.start),(0,nn.eR)(r.constraint.end),(0,nn.eR)(n)),(0,Nt.bI)(Oi,(0,nn.eR)(i))<an.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}}const Oi=(0,Zt.Ue)();class Di extends mi{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=[];if(n.vertices.length<2)return i;const{view:r}=this,s=(0,mn.Rs)(e,t.spatialReference,Ct.jG,r),o=n.vertices.at(-1);this._checkForSnappingCandidate(i,o.leftEdge,o,o.leftEdge.leftVertex,e,s,t);const a=n.vertices[0];return this._checkForSnappingCandidate(i,a.rightEdge,a,a.rightEdge.rightVertex,e,s,t),i}snapExistingVertex(e,t){const n=[],i=t.vertexHandle;if(i.component.vertices.length<3)return n;const{view:r}=this,s=(0,mn.Rs)(e,t.spatialReference,Ct.jG,r),o=i.leftEdge,a=i.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const i=o.leftVertex.leftEdge;this._checkForSnappingCandidate(n,i,i.rightVertex,i.leftVertex,e,s,t)}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const i=a.rightVertex.rightEdge;this._checkForSnappingCandidate(n,i,i.leftVertex,i.rightVertex,e,s,t)}return n}_checkForSnappingCandidate(e,t,n,i,r,s,o){if(!this.edgeExceedsShortLineThreshold(t,o))return;const a=this.view,l=(0,nn.j7)(n.pos,a,o),c=(0,nn.j7)(i.pos,a,o);this._checkForSnappingCandidateNormalized(e,c,l,r,s,o)}_checkForSnappingCandidateNormalized(e,t,n,i,r,s){this._projectionRay(Ai,t,n,i,s),this._checkForSnappingCandidateAlongProjectedRay(e,t,n,Ai,i,r,s)}_projectionRay(e,t,n,i,r){this._projectionRayGeodesic(e,t,n,i,r)||this._projectionRayPlanar(e,t,n)}_projectionRayGeodesic(e,t,n,i,r){let{spatialReference:s}=r;const o=yi(t,n,s,s);if(null==o)return!1;const a=yi(n,i,s,s);if(null==a)return!1;const l=Math.sign(be.c5.shortestSignedDiff(o,a))*Math.PI*.5,c=(0,m.GJ)(o+l,"radians","geographic"),u=(0,b.Ue)(),d=N(n,i,s);return null!=d&&(Si(u,n,s,(0,m.mE)(d,"meters"),c,"geodesic"),(0,S.f)(e,u,n),!0)}_projectionRayPlanar(e,t,n){const i=(0,Nt.$X)(Ei,(0,nn.eR)(n),(0,nn.eR)(t));(0,S.s)(e,i[1],-i[0],0)}_checkForSnappingCandidateAlongProjectedRay(e,t,n,i,r,s,o){var a;const{spatialReference:l,pointer:c}=o,u=(0,Nt.$X)(Ei,(0,nn.eR)(r),(0,nn.eR)(n)),d=(0,Nt.AK)(i,u)/(0,Nt.we)(i),h=(0,Nt.od)(Ei,(0,nn.eR)(n),i,d),p=(0,nn.al)(h[0],h[1],r[2]);if((0,cn.Bb)(s,(0,mn.Rs)(p,l,Ct.jG,this.view))>this.squaredProximityThreshold(c)||this.isVertical(p,n,o)||this.isVertical(n,t,o))return;const f=(0,S.r)((0,b.Ue)(),n,i,Math.sign(d));e.push(new li({targetPoint:p,constraint:new Xn.aU(n,(0,nn.uo)(f)),previousVertex:t,otherVertex:n,otherVertexType:ii.CENTER,isDraped:"on-the-ground"===(null===(a=o.elevationInfo)||void 0===a?void 0:a.mode)}))}}const Ei=(0,Zt.Ue)(),Ai=(0,b.Ue)();class zi extends ai.j{constructor(e){let{targetPoint:t,point1:n,point2:i,isDraped:r}=e;super(t,new Xn.kt((0,nn.uo)((0,S.m)((0,b.Ue)(),n,i,.5)),.5*(0,Nt.TE)((0,nn.eR)(n),(0,nn.eR)(i))),r,ln.B.SELF),this._p1=n,this._p2=i}get hints(){return[new hn.w(cn.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new hn.w(cn.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new _n(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class ji extends mi{snapNewVertex(e,t){const n=t.editGeometryOperations.data.components[0],i=[],r=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;const{view:s}=this,o=n.vertices[0],a=n.vertices[r-1],l=(0,nn.j7)(o.pos,s,t),c=(0,nn.j7)(a.pos,s,t);return this._processCandidateProposal(l,c,e,t,i),i}snapExistingVertex(e,t){const n=[],i=t.vertexHandle,r=i.component;if(r.edges.length<2)return n;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===r.vertices.length-1))return n;const{view:s}=this,o=(0,nn.j7)(i.leftEdge.leftVertex.pos,s,t),a=(0,nn.j7)(i.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,n),n}_processCandidateProposal(e,t,n,i,r){if(!this.exceedsShortLineThreshold(e,t,i))return;const s=(0,Nt.t7)(Li,(0,nn.eR)(e),(0,nn.eR)(t),.5),o=.5*(0,Nt.TE)((0,nn.eR)(e),(0,nn.eR)(t)),a=(0,Ri.xO)(Li,(0,nn.eR)(n),s,o),l=(0,nn.al)(a[0],a[1],n[2]),{spatialReference:c,pointer:u}=i,d=(0,mn.Rs)(n,c,Ct.jG,this.view);if((0,cn.Bb)(d,(0,mn.Rs)(l,c,Ct.jG,this.view))<this.squaredProximityThreshold(u)){var h;if(this.isVertical(e,l,i)||this.isVertical(l,t,i))return;r.push(new zi({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(h=i.elevationInfo)||void 0===h?void 0:h.mode)}))}}}const Li=(0,Zt.Ue)();let Gi=class extends s.Z{constructor(e){super(e),this.updating=!1,this._snappers=new kn.Z,this._domain=ln.B.SELF}initialize(){this._snappers.push(new Ti(this.view,this.options),new Mi(this.view,this.options),new Di(this.view,this.options),new ji(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,n){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const i=[];for(const r of this._snappers.items)for(const t of r.snap(e,n))i.push(t);return(0,cn.lQ)(e,i),i}};function Ui(e,t){return[new Gi({view:e,options:t}),new ci({view:e,options:t,spatialReference:e.spatialReference})]}(0,r._)([(0,u.Cb)({readOnly:!0})],Gi.prototype,"updating",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],Gi.prototype,"view",void 0),(0,r._)([(0,u.Cb)()],Gi.prototype,"options",null),Gi=(0,r._)([(0,d.j)("esri.views.interactive.snapping.SelfSnappingEngine")],Gi);class Hi extends ai.j{constructor(e,t,n,i){super(e,new Xn.Hk(e),i,ln.B.ALL),this.first=t,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new dn(this.targetPoint,this.isDraped,this.domain)]}}let ki=class extends(_i.Z.EventedMixin(s.Z)){constructor(e){super(e),this.options=new Zn,this.snappingEnginesFactory=Ui,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Vi.MAIN}initialize(){this.addHandles([(0,c.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:i,constraintsActive:r}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:n,distance:i,constraintsActive:r}}),(()=>{this.doneSnapping(),this.emit("changed")}),c.Z_),(0,c.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),c.Z_),(0,c.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:n}=e;return this._recreateEngines(t,n)}),c.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:n,options:i}=this;this._engines=t(n,i)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}get _squaredSatisfiesConstraintThreshold(){return an.satisfiesConstraintScreenThreshold*an.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:n}=e;this._removeVisualization();const i=this._currentMainCandidate;if(null==i)return t;const r=this._selectUpdateInput(e);if(null==r)return t;const{spatialReference:s}=n,o=(0,gi.project)(r,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=n,u=[],d=(0,nn.SN)(o,a,l),h=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,h,n))return this._resetSnappingState(),t;i.targetPoint=h,u.push(...i.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,u.push(...p.hints);return null!=c&&this.addHandles(c.draw(u,{spatialReference:s,elevationInfo:Ii(n),view:a,selfSnappingZ:n.selfSnappingZ}),Fi),(0,nn.aK)(h,a,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:n}=e;switch(this._currentSnappedType){case Vi.MAIN:return t;case Vi.SCENE:return n}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Vi.MAIN}_removeVisualization(){this.removeHandles(Fi)}async _snapSinglePoint(e){let{point:t,context:n,signal:i}=e;const{view:r}=this,{elevationInfo:s}=n,o=(0,nn.SN)(t,r,s),a=await this._fetchCandidates(o,ln.B.ALL,n,i);return this._createSnapResult(o,Vi.MAIN,a,r,t,n,i)}async _snapMultiPoint(e){var t,n;let{point:i,scenePoint:r,context:s,signal:o}=e;const{view:a}=this,{coordinateHelper:l,elevationInfo:c,spatialReference:u}=s;await(0,gi.initializeProjection)(r.spatialReference,u);const d=(0,gi.project)(r,u),h=(0,nn.SN)(d,a,c),p=await this._fetchCandidates(h,ln.B.FEATURE,s,o);if(p.length>0){const e=await this._fetchCandidates(h,ln.B.SELF,s,o);return this._createSnapResult(h,Vi.SCENE,[...p,...e],a,d,s,o)}const f=(0,nn.SN)(i,a,c),_=await this._fetchCandidates(f,ln.B.SELF,s,o);return this._createSnapResult(f,Vi.MAIN,_,a,{z:l.hasZ()&&i.hasZ?null!==(t=i.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&i.hasM?null!==(n=i.m)&&void 0!==n?n:0:void 0},s,o)}async _fetchCandidates(e,t,n,i){return(await Promise.all(this._engines.map((r=>r.fetchCandidates(e,t,n,i))))).flat()}_createSnapResult(e,t,n,i,r,s,o){return{get valid(){return!(0,St.Hc)(o)},apply:()=>{const{spatialReference:o}=s,{snappedPoint:a,hints:l}=this._processCandidates(e,t,n,s);return this._removeVisualization(),null!=s.visualizer&&this.addHandles(s.visualizer.draw(l,{spatialReference:o,elevationInfo:Ct.jG,view:i,selfSnappingZ:s.selfSnappingZ}),Fi),(0,nn.aK)(a,i,r,s)}}}_processCandidates(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,cn.lQ)(e,n);const r=this._currentMainCandidate;if(null!=r){const s=this._findOldConstraintInNewCandidates(r,n);if(s>=0){if(!(n[s]instanceof Hi))return this._intersectWithOtherCandidates(s,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,i))return this._updateSnappingCandidate(r,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}_findOldConstraintInNewCandidates(e,t){return e instanceof Hi?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,n,i,r){const{coordinateHelper:s}=r,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const i=t[l],r=o.constraint.intersect(i.constraint);if(r)for(const e of r.closestPoints(o.targetPoint))a.push([new Hi(e,o,i,i.isDraped),this._squaredScreenDistance(n,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(a[0][0],i,t,r):this.options.constraintsActive&&(o instanceof vi||o instanceof si.L||o instanceof li||o instanceof xi)?{snappedPoint:n,hints:[]}:this._updateSnappingCandidate(o,i,t,r)}_updateSnappingCandidate(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of n){if(e instanceof Hi){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(r);this._squaredScreenDistance(t,r,i.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=r,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:r,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return(0,cn.Bb)(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return(0,mn.Rs)(e,t.spatialReference,Ct.jG,this.view)}_findOldCandidateIndex(e,t){let n=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}get test(){return{visualizationsActive:this.hasHandles(Fi),engines:this._engines}}};var Vi;(0,r._)([(0,u.Cb)({constructOnly:!0})],ki.prototype,"view",void 0),(0,r._)([(0,u.Cb)()],ki.prototype,"options",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],ki.prototype,"updating",null),(0,r._)([(0,u.Cb)()],ki.prototype,"snappingEnginesFactory",void 0),(0,r._)([(0,u.Cb)()],ki.prototype,"_engines",void 0),(0,r._)([(0,u.Cb)()],ki.prototype,"_squaredMouseProximityThreshold",null),(0,r._)([(0,u.Cb)()],ki.prototype,"_squaredTouchProximityThreshold",null),(0,r._)([(0,u.Cb)()],ki.prototype,"_squaredSatisfiesConstraintThreshold",null),ki=(0,r._)([(0,d.j)("esri.views.interactive.snapping.SnappingManager")],ki),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Vi||(Vi={}));const Fi="visualization-handle";function Ii(e){let{coordinateHelper:t,elevationInfo:n}=e;return t.hasZ()?Ct.jG:n}const Ni=new Map;function Zi(e){if(!Ni.has(e)){const t=function(e,t){var n,i;const r=new Zn({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(n=null===t||void 0===t?void 0:t.distance)&&void 0!==n?n:an.distance,touchSensitivityMultiplier:null!==(i=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==i?i:an.touchSensitivityMultiplier});return{...(0,c.YP)((()=>{var t,n;return null!==(t=null===(n=e.map)||void 0===n||null===(n=n.allLayers)||void 0===n?void 0:n.toArray())&&void 0!==t?t:[]}),(e=>{r.featureSources=new kn.Z(e.map((e=>new Fn({layer:e,enabled:!0}))))}),c.nn),options:r}}(e,{distance:10}),n=function(e,t){return new ki({view:e,options:t,snappingEnginesFactory:(t,n)=>[new ci({view:e,spatialReference:e.spatialReference,options:n})]})}(e,t.options);Ni.set(e,{referenceCount:0,snappingManager:n,remove:()=>{t.remove(),n.destroy()}})}const t=Ni.get(e);t.referenceCount++;const n=(0,o.kB)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,Hn.Y)((()=>{0===t.referenceCount&&(t.remove(),Ni.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...n}}class qi{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}var Wi=n(70178),Yi=n(93463);function Bi(e){let{predicate:t=(()=>!0),snappingManager:n,snappingContext:i,updatingHandles:r,useZ:s=!0}=e;const o=new Ne.hM;if(null==n)return{snappingStep:[Ji,o],cancelSnapping:Ji};let a,u=null,d=null,h=null;const p=()=>{var e;u=(0,l.IM)(u),n.doneSnapping(),null!==(e=d)&&void 0!==e&&e.frameTask.remove(),d=null,a=(0,l.hw)(a),h=null},f=function(e,t,n){return(0,St.Ds)((async(i,r)=>{let{frameTask:s,point:o,scenePoint:a,context:l,event:c,delta:u,getLastState:d}=i;const h=await s.schedule((()=>e.snap({point:o,scenePoint:a,context:l,signal:r})),r);if(h.valid){let i=await s.schedule((()=>h.apply()),r);const a=d();null!=a.point&&o!==a.point&&(i=e.update({point:a.point,scenePoint:a.scenePoint,context:l})),null!=a.updatePoint&&(0,Wi.kg)(i,a.updatePoint)||(Qi(c.mapEnd,i,u,t),n.execute(c))}}))}(n,s,o);let _=null,g=null,m=null;return{snappingStep:[e=>{if(!t(e))return e;const{action:o}=e;if("start"===o){const{info:t}=e,r=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(Yi.T8.SNAPPING):Yi.sq}(n.view);if(d=function(e,t,n){return{context:new qi({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}(i,e,r),d.context.selfSnappingZ=null,!s&&null!=t){var l;const e=function(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const r of n){const t=e.getZ(r.pos);if(null!=i&&null!=t&&Math.abs(t-i)>1e-6)return null;null==i&&(i=t)}return i}(i.coordinateHelper,t.handle.component);null!=e&&(d.context.selfSnappingZ={value:e,elevationInfo:null!==(l=i.elevationInfo)&&void 0!==l?l:Ct.jG})}}if(null!=d){const{context:t,originalScenePos:i,originalPos:l}=d,{mapEnd:p,mapStart:v,scenePoints:y}=e,S=Xi(l,Ki(p,v)),b=Ki(v,l),w={...e,action:"update"},P=d.context,C=function(e,t){return null==e||null==t?null:Xi(e,Ki(t.sceneEnd,t.sceneStart))}(i,y),R=n.update({point:S,scenePoint:C,context:t});if(m=R,Qi(p,R,b,s),_=S,g=C,"end"!==o){const{frameTask:e}=d;null==u&&(u=new AbortController),h=t=>{r.addPromise((0,St.R8)(f({frameTask:e,event:w,context:P,point:S,scenePoint:C,delta:b,getLastState:()=>({point:_,scenePoint:g,updatePoint:t.forceUpdate?null:m})},u.signal)))},h({forceUpdate:!1}),null==a&&(a=(0,c.YP)((()=>n.options.effectiveEnabled),(()=>{var e;return null===(e=h)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===o&&p(),e},o],cancelSnapping:e=>(p(),e)}}function Xi(e,t){let[n,i,r]=t;const s=(0,R.WG)(e);return s.x+=n,s.y+=i,s.hasZ&&(s.z+=r),s}function Ki(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function Qi(e,t,n,i){let[r,s,o]=n;e.x=t.x+r,e.y=t.y+s,i&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function Ji(e){return e}let $i=class extends s.Z{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,St.Ds)((async(e,t,n,i)=>{const r=this._frameTask;if(null==r)return;const s=await r.schedule((()=>t.snap({...e,context:n,signal:i})),i);s.valid&&await r.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))}),i)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(Yi.T8.SNAPPING):Yi.sq}destroy(){this._abortController=(0,l.IM)(this._abortController),this._frameTask=(0,l.hw)(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:r}=e,s=t.update({point:i,scenePoint:r,context:n});return this.stagedPoint=s,s}async snap(e,t,n){const{point:i,scenePoint:r}=e;return this.stagedPoint=t.update({point:i,scenePoint:r,context:n}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,l.IM)(this._abortController),this._snapPoints=null}};(0,r._)([(0,u.Cb)({constructOnly:!0})],$i.prototype,"view",void 0),(0,r._)([(0,u.Cb)()],$i.prototype,"stagedPoint",null),(0,r._)([(0,u.Cb)()],$i.prototype,"constrainResult",void 0),(0,r._)([(0,u.Cb)()],$i.prototype,"_stagedPoint",void 0),$i=(0,r._)([(0,d.j)("esri.views.interactive.snapping.SnappingOperation")],$i);let er=class extends s.Z{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new mt.Z,this._orientationManipulatorTexture=null,this._updatingHandles=new bt.R,this._getSnappingContext=(0,yt.H)((e=>new qi({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new Un.c(new Gn.XE("point",(0,Ln.Y6)(!0,!1,this.view.spatialReference))),visualizer:new vn})));const{view:t}=e;this._snappingManagerResult=Zi(t),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,jn.z5)(2)}),this._constraintSnappingIndicator=new Cn.r({view:t,attached:!0,width:1,renderOccluded:ke.yD.OccludeAndTransparent,stipplePattern:(0,jn.z5)(5),isDecoration:!0});const n=Se.Z.toUnitRGBA(Te);this._stagedStartIndicator=new En({view:t,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:n,size:10,outlineSize:0,renderOccluded:ke.yD.OccludeAndTransparent,isDecoration:!0})}initialize(){var e;const{view:t}=this;this._snappingOperation=new $i({view:t});const n=!(null!==(e=t._stage)&&void 0!==e&&e.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._orientationManipulatorMaterial=new Fe.j({transparent:!0,writeDepth:!1,renderOccluded:ke.yD.Opaque,isDecoration:!0}),this.addHandles((0,c.YP)((()=>({accentColor:Me(t.effectiveTheme),contrastColor:xe(t.effectiveTheme)})),(e=>{let{accentColor:i,contrastColor:r}=e;const s=this._orientationManipulatorTexture,o=(0,Pt.O)(t.textures,{accentColor:i,contrastColor:r,preMultiplyAlpha:n});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,null===s||void 0===s||s.release();const a=Se.Z.toUnitRGBA(i);this._unfocusedOffsetManipulatorMaterial.setParameters({color:a}),this._focusedOffsetManipulatorMaterial.setParameters({color:a}),this._thinOffsetManipulatorMaterial.setParameters({color:a}),this._constraintSnappingIndicator.color=a}),c.nn));const i=(0,c.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createManipulators(t)}));this.addHandles((0,o.ed)(i)),this.addHandles([(0,c.YP)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(e=>{let{stagedPoint:t,stagedComputation:n}=e;if(null==n||null==t)return;const i=(0,R.WG)(t,new qe.Z);this._applyPointUpdate(n,{endPoint:i})}),c.Z_),(0,c.YP)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:n,selectedComputation:i,firstGrabbedManipulator:r}=e;if(n===(null===t||void 0===t?void 0:t.stagedDimension)&&r===(null===t||void 0===t?void 0:t.firstGrabbedManipulator)){for(const s of[i,null===t||void 0===t?void 0:t.selectedComputation])if(null!=s){const t=this._computationManipulators.get(s);null!=t&&this._updateManipulators(s,t,e)}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,e)}),c.tX),(0,c.YP)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),c.nn),(0,c.YP)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.YP)((()=>{const e=this._stagedComputation;if(!e)return null;const t=e.elevationAlignedStartPoint,n=(0,b.Ue)();return null!=t&&this.view.renderCoordsHelper.toRenderCoords(t,n)?n:null}),(e=>{null!=e?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,cn.Ob)(this,(()=>{const e=this._activeComputation,t=this._stagedComputation;if(null==e||null!=t){var n;const e=null!==(n=this.view.inputManager.latestPointerType)&&void 0!==n?n:"mouse",t=this._getSnappingContext(e);this._updatingHandles.addPromise((0,St.R8)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,t)))}if(null!=e){const{start:t,end:n}=this._computationManipulators.get(e);if(t.grabbing||n.grabbing){!function(e,t,n){let{constraint:i,view:r}=n;const{unconstrainedGeometry:s}=e;if(null==s)return;const{renderCoordsHelper:o,spatialReference:a}=r,{startRenderSpace:l,endRenderSpace:c}=s.directSegment,u=o.fromRenderCoords(l,new qe.Z({spatialReference:a})),d=o.fromRenderCoords(c,new qe.Z({spatialReference:a}));let h;h="start"===t?{startPoint:u}:{endPoint:d},wt(e,h,{constraint:i,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:s,view:r})}(e,t.grabbing?"start":"end",{constraint:this._computeConstraint(e),view:this.view})}}}))}destroy(){var e;this._snappingOperation=(0,l.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),null===(e=this._orientationManipulatorTexture)||void 0===e||e.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=e?e:null}get _stagedComputation(){var e;const t=this._stagedDimension,n=null===(e=this.analysisViewData.computations.at(-1))||void 0===e?void 0:e.computation;return null==t||null==n||n.dimension!==t?null:n}get _constraintHandles(){return[(0,c.gx)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=this._computeConstraint(e)}),{...c.tX,equals:vt.fS}),(0,c.YP)((()=>{const e=this._activeComputation;if(null==e)return null;const{measureType:t,orientation:n}=e.dimension;return{measureType:t,orientation:n,computation:e}}),((e,t)=>{if(null!=e&&null==t){const{measureType:t,orientation:n,computation:i}=e;switch(i.previousConstraint){case _t.Horizontal:i.preConstraintProperties={measureType:p.n.Horizontal,orientation:0};break;case _t.Vertical:i.preConstraintProperties={measureType:p.n.Vertical,orientation:0};break;case _t.Direct:i.preConstraintProperties={measureType:p.n.Direct,orientation:n};break;default:i.preConstraintProperties={measureType:t,orientation:n}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),c.Z_)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,c.YP)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(t=>{let{stagedComputation:n,activeComputation:i}=t;const r=this._constraintSnappingIndicator;if(this.removeHandles(e),null!=i)if(i===n)r.attached=!0;else{const{start:t,end:n}=this._computationManipulators.get(i),s=()=>{r.attached=t.grabbing||n.grabbing};s(),this.addHandles([t.events.on("grab-changed",s),n.events.on("grab-changed",s)],e)}else r.attached=!1})),(0,c.YP)((()=>{const e=this._activeComputation;return null!=e?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(e=>{let{geometry:t,constraint:n}=e;const i=this._constraintSnappingIndicator;null!=t&&null!=n&&n!==_t.Direct?(i.visible=!0,i.setGeometryFromSegment(t.directSegment)):i.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if(null==t){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove(e){let{mapPoint:t,pointerType:n}=e;if("touch"===n)return;const i=this._getSnappingContext(n);this._updatingHandles.addPromise((0,St.R8)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(e){let{mapPoint:t,pointerType:n}=e,i=t;if("mouse"===n){const e=this._getSnappingContext(n);i=this._snappingManager.update({point:t,context:e})}const r=new gt.Z({startPoint:(0,R.WG)(i,new qe.Z),endPoint:null,measureType:p.n.Horizontal});return this._stagedDimension=r,this._resetSnappingState(),r}_onStagedClick(e){let{mapPoint:t,pointerType:n}=e;const i=this._stagedComputation;if(null==i)return;let r=t;if("mouse"===n){const e=this._getSnappingContext(n);r=this._snappingManager.update({point:t,context:e})}const s=(0,R.WG)(r,new qe.Z);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(e){const t=this._setupPointManipulator(e,{isStart:!0}),n=this._setupPointManipulator(e,{isStart:!1}),i=this._setupOffsetManipulator(e),r=this._setupHeadingManipulator(e),s=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,p.n.Direct),a=this._setupMeasureTypeManipulator(e,p.n.Horizontal),l=this._setupMeasureTypeManipulator(e,p.n.Vertical),c=new We({start:t,end:n,offset:i,heading:r,rotation:s,direct:o,horizontal:a,vertical:l});return this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of c.values())this.manipulators.remove(e)}}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,c.YP)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...c.tX,equals:vt.fS})],e)}_setupPointManipulator(e,t){const{view:n}=this,{dimension:i}=e,r=new Ye(n,{metadata:i}),s=function(e,t){let{isStart:n,createSnappingPipelineStep:i,dimension:r,onUpdate:s,view:o}=t;const a=n?"startPoint":"endPoint",l=(0,Ne.Xd)(e,((e,t,n,l)=>{const c=(0,je.J4)(e),{snappingStep:u,cancelSnapping:d}=i(l);n=n.next(c).next((0,Ne.di)(r,[a,"measureType","orientation"])).next(d),t.next(c).next((0,je.gv)(o)).next(...u).next((e=>{const t=(0,R.WG)(e.mapEnd,new qe.Z);s("startPoint"===a?{startPoint:t}:{endPoint:t})}))}));return[l]}(r,{isStart:t.isStart,createSnappingPipelineStep:e=>Bi({snappingContext:this._getSnappingContext(e),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:i,onUpdate:t=>this._applyPointUpdate(e,t),view:n});return this._computationHandles.add(s,e),r}_setupOffsetManipulator(e){const{view:t}=this,n=function(e,t){const n=[(0,b.al)(-.5,0,0),(0,b.al)(.5,0,0)],i=(0,He.rh)(t.unfocusedMaterial,n.map((e=>(0,S.h)((0,b.Ue)(),e,.5)))),r=i.instantiate({material:t.focusedMaterial});return new Ee.Z({view:e,renderObjects:[new ze.r(i,Ze.Q9.Unfocused|Ze.Q9.Selected|ut),new ze.r(r,Ze.Q9.Focused|ut)],collisionType:{type:"line",paths:[n]},radius:lt(t.lineSizePt)/2,metadata:t.metadata,available:!1,...Ae.X9})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,Ne.Xd)(e,((e,t,r)=>{if(!me(n)||!e.selected)return;const{geometry:s,dimension:o}=n,a=(0,je.J4)(e);t.next(a).next($e(i,o,s.dimensionSegment,s.primaryOffsetAxis)),r.next(a).next((0,Ne.di)(o,["offset"]))}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupHeadingManipulator(e){const{view:t}=this,n=new Be(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,t){let{computation:n,view:i}=t;return[(0,Ne.Xd)(e,((e,t,r)=>{Qe({cancel:r,computation:n,settingHeading:!0,steps:t,view:i})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupRotationManipulator(e){const{view:t}=this,n=new Be(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=Ke(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}_setupMeasureTypeManipulator(e,t){const{view:n}=this,i=function(e,t){const n=[(0,b.al)(-.5,0,0),(0,b.al)(.5,0,0)],i=(0,He.rh)(t.thinOffsetManipulatorMaterial,n),r=(0,He.rh)(t.unfocusedMaterial,n.map((e=>(0,S.h)((0,b.Ue)(),e,.5)))),s=r.instantiate({material:t.focusedMaterial});return new Ee.Z({view:e,renderObjects:[new ze.r(r,Ze.Q9.Unfocused|ut),new ze.r(s,Ze.Q9.Focused|ut),new ze.r(i,ut)],collisionType:{type:"line",paths:[n]},radius:lt(t.lineSizePt)/2,available:!1,metadata:t.metadata,...Ae.X9})}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),r=Je(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(r,e),i}_updateManipulators(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:i,selectedComputation:r,firstGrabbedManipulator:s}=n,{start:o,end:a,offset:l,heading:c,rotation:u}=t,d=r===e,h=me(e),{dimension:f}=e;for(const p of t.values()){const e=h&&null==i&&(null==s||p===s);p===l?(p.available=e,p.selected=d):p.available=e&&d}if(!h)return;null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(f.measureType).available=!1;for(const m of[c,u])f.measureType===p.n.Direct&&0!==f.offset||(m.available=!1);ce(e)?u.available=!1:c.available=!1;const{geometry:_}=e;o.renderLocation=_.directSegment.startRenderSpace,a.renderLocation=_.directSegment.endRenderSpace;const{renderCoordsHelper:g}=this.view;(function(e,t,n){const{dimensionSegment:i,primaryOffsetAxis:r}=t,s=pe(dt,t),o=(0,S.j)(s,b.AG)?(0,v.yR)(pt):(0,Ae.Aq)(s,r,b.AG,pt),a=Math.max((0,S.l)(s),.1/n.unitInMeters);(0,v.bA)(o,o,(0,S.s)(dt,a,a,a)),e.modelTransform=o,e.renderLocation=i.eval(.5,dt)})(l,_,g),c.available&&function(e,t,n){tt(e,t,n,{forHeading:!0})}(c,e,g),u.available&&function(e,t,n){tt(e,t,n,{forHeading:!1})}(u,e,g),t.forEachMeasureTypeManipulator(((t,n)=>{t.available&&function(e,t,n,i){const{geometry:r}=t,s=ie(ft,n,t,i),o=ae(dt,{measureType:n,directSegment:r.directSegment,renderCoordsHelper:i}),a=(0,S.z)(ht,s.endRenderSpace,s.startRenderSpace),l=(0,Ae.Aq)(a,o,b.AG,pt),c=(0,S.l)(a);(0,v.bA)(l,l,(0,S.s)(ht,c,c,c)),e.modelTransform=l,e.renderLocation=s.eval(.5,ht)}(t,e,n,g)}))}_updateManipulatorStyle(e){const t=function(e){return(0,we.F2)(e)+4}(e),n=lt(e),i={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:r,heading:s,rotation:o}of this._computationManipulators.values())r.radius=n/2,s.update(i),o.update(i);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:n})}_applyPointUpdate(e,t){const{view:n}=this,i=$(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);const r=ee(i,n.renderCoordsHelper);if(null==r)return;const s=this._computeConstraint({...i,geometry:r});wt(e,t,{...i,constraint:s,unconstrainedGeometry:r,view:n}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if(null==e.geometry)return;e.geometry.directSegment.eval(.5,tr);const t=this.view.state.camera.computeScreenPixelSizeAt(tr);e.dimension.offset=50*t}_computeConstraint(e){return function(e,t){if(ge(e))return _t.Direct;if(!e.enabled)return null;const{geometry:n}=e;if(null==n||(0,S.j)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;const{camera:i}=t.state,r=de(P.WM.get(),n,t.renderCoordsHelper),s=he(P.WM.get(),n),o=(0,S.h)(P.WM.get(),r,(0,S.k)(s,r)),a=(0,S.f)(P.WM.get(),s,o),l=(0,S.p)(a),c=(0,S.p)(o),{startRenderSpace:u,endRenderSpace:d}=n.directSegment,h=Math.max(10*i.computeScreenPixelSizeAt(u),10*i.computeScreenPixelSizeAt(d))**2;return l<h?_t.Vertical:c<h?_t.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new Ie.U({width:1,renderOccluded:ke.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){const e=e=>{var t;return null===(t=this.analysisViewData.computations.find((t=>{let{computation:n}=t;return n.dimension===e})))||void 0===t?void 0:t.computation};return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=ke.yD.Occlude,this.manipulators.forEach((e=>{let{manipulator:t}=e;for(const{geometry:n}of t.renderObjects)n.material.setParameters({renderOccluded:ke.yD.Occlude})}))},getManipulatorsForDimension:t=>this._computationManipulators.get(e(t)),getComputationForDimension:t=>e(t),getConstraintForDimension:t=>{const n=e(t);return null!=n?this._computeConstraint(n):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};(0,r._)([(0,u.Cb)({constructOnly:!0})],er.prototype,"analysis",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],er.prototype,"analysisViewData",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],er.prototype,"manipulators",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],er.prototype,"parentTool",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0,nonNullable:!0})],er.prototype,"view",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],er.prototype,"updating",null),(0,r._)([(0,u.Cb)()],er.prototype,"firstGrabbedManipulator",null),(0,r._)([(0,u.Cb)()],er.prototype,"hasGrabbedManipulators",null),(0,r._)([(0,u.Cb)()],er.prototype,"snappingOptions",null),(0,r._)([(0,u.Cb)()],er.prototype,"_stagedDimension",void 0),(0,r._)([(0,u.Cb)()],er.prototype,"_activeComputation",null),(0,r._)([(0,u.Cb)()],er.prototype,"_stagedComputation",null),er=(0,r._)([(0,d.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],er);const tr=(0,b.Ue)();var nr,ir=n(76365),rr=n(87888),sr=n(81298),or=n(72612);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(nr||(nr={}));let ar=class extends ir.f{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,sr.w)(this.view.state.viewingMode),this._lengthDimensionSubTool=new er({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.ed)(this._lengthDimensionSubTool),(0,o.kB)((()=>this._clearPointerMoveTimeout())),(0,c.YP)((()=>this.state),(e=>{e===nr.Created&&this.finishToolCreation()}),c.tX),(0,c.gx)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),c.tX),(0,c.YP)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.tX)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?null!=this._activeSubTool?nr.Creating:nr.Created:nr.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(rr.Sn.cancel===e.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else rr.Sn.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if(null==this._activeSubTool)return;const t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,or.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const n=this._intersector.results.min,i=P.WM.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,new qe.Z({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>e.manipulator.state|=ut)),this._prevPointerMoveTimeout=ye.m.setTimeout((()=>{this.manipulators.forEach((e=>e.manipulator.state&=~ut))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:e=>{this._pointerMoveTimerMs=e,this._resetPointerMoveTimeout()}}}};(0,r._)([(0,u.Cb)({constructOnly:!0})],ar.prototype,"view",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],ar.prototype,"analysis",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],ar.prototype,"state",null),(0,r._)([(0,u.Cb)({readOnly:!0})],ar.prototype,"updating",null),(0,r._)([(0,u.Cb)({readOnly:!0})],ar.prototype,"cursor",null),(0,r._)([(0,u.Cb)({constructOnly:!0})],ar.prototype,"analysisViewData",void 0),(0,r._)([(0,u.Cb)()],ar.prototype,"selectedDimension",null),(0,r._)([(0,u.Cb)()],ar.prototype,"automaticManipulatorSelection",void 0),(0,r._)([(0,u.Cb)()],ar.prototype,"_activeSubTool",void 0),(0,r._)([(0,u.Cb)()],ar.prototype,"_lengthDimensionSubTool",void 0),ar=(0,r._)([(0,d.j)("esri.views.3d.analysis.Dimension.DimensionTool")],ar);n(59166);var lr=n(58935),cr=n(61201),ur=n(79685),dr=n(21317);class hr extends Rn._{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=ke.yD.OccludeAndTransparent,this._width=1,this._color=(0,Mt.al)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=null!=t,this.applyProperties(e)}setGeometryFromSegment(e,t){const n=e.endRenderSpace;this.transform=(0,v.vc)(pr,n),this._normal=t;const{points:i}=e.createRenderGeometry(n,this.view.renderCoordsHelper);this.geometry=[i]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,null!=this._material&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(e){this._width=e,null!=this._material&&this._material.setParameters({width:e})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(e){this._color=(0,Mt.d9)(e),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.markerPrimitive)&&void 0!==e?e:this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,null!=this._material&&this._material.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new dr.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,ur.c)(this.geometry,this.normal)){const n=(0,ur.Y)(this._material,t);e.addGeometry(n)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const pr=(0,y.Ue)();class fr{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new mt.Z,this._messages=null,this._labelSegment=new M.y;const{analysis:t,computation:n,view:i,messages:r,isDecoration:s}=e;this.analysis=t,this.computation=n,this.view=i,this._messages=r;const o=e.visible,a={view:i,attached:o,isDecoration:s},{fontSize:l,textColor:u,textBackgroundColor:d}=t.style;this._visualElements=new vr({marker:new hr(a,e.markerMaterial),dimension:new Cn.r(a,e.dimensionLineMaterial),startOffset:new Cn.r(a,e.offsetLineMaterial),endOffset:new Cn.r(a,e.offsetLineMaterial),dimensionSmall:new Cn.r(a,e.smallDimensionLineMaterial),startOffsetSmall:new Cn.r(a,e.smallOffsetLineMaterial),endOffsetSmall:new Cn.r(a,e.smallOffsetLineMaterial),label:new cr.K({view:i,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,we.F2)(l),textColor:u.clone(),backgroundColor:d.clone(),isDecoration:s})}),this._handles.add([(0,c.YP)((()=>n.geometry),(e=>{this.updateCameraDependentElements(i.state.camera,e,t.style),null!=n.geometry&&this._updateLines(n.geometry)}),{...c.nn,equals:vt.fS}),(0,c.YP)((()=>n.length),(e=>this._updateLabelContent(e)),c.nn)])}destroy(){this.destroyed=!0,this._handles=(0,l.SC)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=te(_r,ne.Start,e.directSegment,e.dimensionSegment),n=te(gr,ne.End,e.directSegment,e.dimensionSegment),i=this._visualElements;i.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),i.dimension.setGeometryFromSegment(e.dimensionSegment),i.startOffset.setGeometryFromSegment(t),i.endOffset.setGeometryFromSegment(n),i.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),i.startOffsetSmall.setGeometryFromSegment(t),i.endOffsetSmall.setGeometryFromSegment(n)}updateCameraDependentElements(e,t,n){const i=this._visualElements;if(null==t){for(const e of i.values())e.visible=!1;return}const r=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,mr)),s=function(e,t){return(0,S.p)(pe(_e,e))/t**2}(t,r),o=s<(2*(0,we.F2)(n.lineSize))**2,a=!o;i.marker.visible=a,i.dimension.visible=a,i.startOffset.visible=a,i.endOffset.visible=a,i.dimensionSmall.visible=o,i.startOffsetSmall.visible=o,i.endOffsetSmall.visible=o;const l=5*(0,we.F2)(n.fontSize),{label:c}=i;if(c.visible=s>=l**2,!c.visible)return;const{dimensionSegment:u,primaryOffsetAxis:d}=t,{offset:h}=this.computation.dimension,p=(Math.sign(h)>=0?1:-1)*this._labelOffsetPx(n)*r;(function(e,t,n,i){(0,S.r)(e.startRenderSpace,t.startRenderSpace,n,i),(0,S.r)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,u,d,p),c.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,we.F2)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;null!=e&&null!=this._messages?t.text=(0,lr.VG)(this._messages,e,e.unit):t.text=""}_labelOffsetPx(e){return 1.5*(0,we.F2)(e.fontSize)+20+(0,we.F2)(e.lineSize/2)}}const _r=new M.y,gr=new M.y,mr=(0,b.Ue)();class vr{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var yr=n(33720),Sr=n(36257),br=n(41201);let wr=class extends s.Z{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(e){super(e),this.loadingMessages=!1,this._messages=null}initialize(){const e=this.isDecoration;this._markerMaterial=new dr.X({width:1,anchor:yr.i5.Tip,color:Pe.AG,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:ke.yD.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:e}),this._dimensionLineMaterial=new Ie.U({width:1,color:Pe.AG,renderOccluded:ke.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:e}),this._offsetLineMaterial=new Ie.U({width:1,color:Pe.AG,renderOccluded:ke.yD.OccludeAndTransparent,stipplePattern:(0,jn.z5)(5),isDecoration:e}),this._smallDimensionLineMaterial=new Ie.U({width:1,color:Pe.AG,renderOccluded:ke.yD.OccludeAndTransparent,isDecoration:e}),this._smallOffsetLineMaterial=new Ie.U({width:1,color:Pe.AG,renderOccluded:ke.yD.OccludeAndTransparent,stipplePattern:(0,jn.z5)(5),isDecoration:e});for(const n of this._lineMaterials())this.view._stage.add(n),this.addHandles((0,o.kB)((()=>{var e;null===(e=this.view._stage)||void 0===e||e.remove(n)})));const t=(0,c.wZ)((()=>this.analysisViewData.computations),(e=>{let{computation:t}=e;return this._createVisualization(t)}));this._dimensionVisualizations=t,this.addHandles([(0,o.ed)(t),(0,c.YP)((()=>Se.Z.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),c.tX),(0,c.YP)((()=>this.analysis.style.lineSize),(e=>{const t=(0,we.F2)(e);this._markerMaterial.setParameters({width:.8*t}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const n=Math.max(.25*t,1);this._offsetLineMaterial.setParameters({width:n})}),c.tX),(0,c.YP)((()=>({camera:this.view.state.camera,style:Pr(this.analysis)})),(e=>{let{camera:t,style:n}=e;for(const{visualization:i}of this._dimensionVisualizations)i.updateCameraDependentElements(t,i.computation.geometry,n),i.updateLabelStyle(n)})),(0,c.YP)((()=>this.visible),(e=>{for(const{visualization:t}of this._dimensionVisualizations)t.visible=e}))]),this.addHandles([(0,Sr.qe)((()=>this._updateMessageBundle())),(0,c.gx)((()=>!this.loadingMessages),(()=>{for(const{visualization:e}of this._dimensionVisualizations)e.updateUnitsMessages(this._messages)}),c.Z_)]),this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map((e=>{let{visualization:t}=e;return t})),disablePartialOcclusion:()=>{for(const e of this._lineMaterials())e.setParameters({renderOccluded:ke.yD.Occlude})}}}_createVisualization(e){const t=new fr({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:()=>t.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,br.ME)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Pr(e){const{fontSize:t,lineSize:n,textColor:i,textBackgroundColor:r}=e.style;return{fontSize:t,lineSize:n,textBackgroundColor:r.clone(),textColor:i.clone()}}(0,r._)([(0,u.Cb)({constructOnly:!0})],wr.prototype,"analysisViewData",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0,nonNullable:!0})],wr.prototype,"view",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0})],wr.prototype,"isDecoration",void 0),(0,r._)([(0,u.Cb)()],wr.prototype,"analysis",null),(0,r._)([(0,u.Cb)()],wr.prototype,"visible",null),(0,r._)([(0,u.Cb)()],wr.prototype,"loadingMessages",void 0),wr=(0,r._)([(0,d.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],wr);let Cr=class extends s.Z{constructor(e){super(e),this.dimension=null,this.length=null}};(0,r._)([(0,u.Cb)({constructOnly:!0,nonNullable:!0})],Cr.prototype,"dimension",void 0),(0,r._)([(0,u.Cb)()],Cr.prototype,"length",void 0),Cr=(0,r._)([(0,d.j)("esri.views.3d.analysis.LengthDimensionResult")],Cr);const Rr=Cr;let Mr=class extends s.Z{constructor(e){super(e),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...n}=e;return{result:new Rr({dimension:t}),...n}}initialize(){this.addHandles([(0,c.YP)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),c.tX),(0,c.YP)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),c.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,r._)([(0,u.Cb)({constructOnly:!0,nonNullable:!0})],Mr.prototype,"result",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0,nonNullable:!0})],Mr.prototype,"projectAndAlignPoint",void 0),(0,r._)([(0,u.Cb)()],Mr.prototype,"dimension",null),(0,r._)([(0,u.Cb)()],Mr.prototype,"length",null),(0,r._)([(0,u.Cb)()],Mr.prototype,"geometry",void 0),(0,r._)([(0,u.Cb)()],Mr.prototype,"unconstrainedGeometry",void 0),(0,r._)([(0,u.Cb)()],Mr.prototype,"elevationAlignedStartPoint",void 0),(0,r._)([(0,u.Cb)()],Mr.prototype,"elevationAlignedEndPoint",void 0),(0,r._)([(0,u.Cb)()],Mr.prototype,"preConstraintProperties",void 0),(0,r._)([(0,u.Cb)()],Mr.prototype,"previousConstraint",void 0),Mr=(0,r._)([(0,d.j)("esri.views.3d.analysis.LengthDimensionComputation")],Mr);var xr=n(33906),Tr=n(70209);const Or=e=>{let t=class extends e{constructor(){super(...arguments),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new kn.Z}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,r._)([(0,u.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,r._)([(0,u.Cb)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,r._)([(0,u.Cb)()],t.prototype,"tool",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],t.prototype,"results",null),(0,r._)([(0,u.Cb)()],t.prototype,"selectedDimension",void 0),(0,r._)([(0,u.Cb)()],t.prototype,"interactive",void 0),(0,r._)([(0,u.Cb)()],t.prototype,"visible",void 0),t=(0,r._)([(0,d.j)("esri.views.analysis.DimensionAnalysisView")],t),t};let Dr=class extends(Or((0,h.p)(s.Z))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:n}=this.view,i=(0,xr.G)(e,t,n);return null==i&&(0,xr.e)(this.analysis,e.spatialReference,a.Z.getLogger(this)),i};const e=(0,c.wZ)((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([(0,Tr.Lp)(this,ar),(0,o.ed)(e)]),this._analysisVisualization=new wr({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new ve({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.IM)(this._placementTask),this._analysisVisualization=(0,l.SC)(this._analysisVisualization),(0,Tr.Yq)(this)}get updating(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,l.IM)(this._placementTask),this._placementTask=(0,Tr.Er)(this,e),this._placementTask.promise}_createComputation(e){const{_dimensionsToComputations:t}=this,n=new Mr({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,n),{computation:n,remove:()=>this._removeComputation(n)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};(0,r._)([(0,u.Cb)({readOnly:!0})],Dr.prototype,"type",void 0),(0,r._)([(0,u.Cb)()],Dr.prototype,"tool",void 0),(0,r._)([(0,u.Cb)()],Dr.prototype,"updating",null),(0,r._)([(0,u.Cb)({readOnly:!0})],Dr.prototype,"results",null),(0,r._)([(0,u.Cb)()],Dr.prototype,"computations",void 0),(0,r._)([(0,u.Cb)()],Dr.prototype,"selectedDimension",void 0),(0,r._)([(0,u.Cb)()],Dr.prototype,"selectedComputation",null),(0,r._)([(0,u.Cb)()],Dr.prototype,"_analysisVisualization",void 0),(0,r._)([(0,u.Cb)()],Dr.prototype,"_analysisController",void 0),(0,r._)([(0,u.Cb)()],Dr.prototype,"_dimensionsToComputations",void 0),(0,r._)([(0,u.Cb)()],Dr.prototype,"_placementTask",void 0),Dr=(0,r._)([(0,d.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],Dr);const Er=Dr},19182:(e,t,n)=>{n.d(t,{i:()=>y});var i=n(27366),r=n(7138),s=n(79056),o=n(49861),a=(n(93169),n(32718),n(84936),n(69912)),l=n(26279),c=n(78289),u=n(78485);class d{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.eZ.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const n=null===(t=this._resources)||void 0===t?void 0:t.layerView;n&&(n.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this._resourceFactory.createResources(),n=new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new h({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:t,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(n)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const t=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,c.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,c.T.UPDATE),this._resources.geometriesAdded=!0))}}let h=class extends((0,s.IG)(r.Z)){constructor(e){super(e),this.drapeSourceType=l.Lw.Features,this.updatePolicy=u.j.SYNC,this.renderGroup=l.eZ.Outline}};(0,i._)([(0,o.Cb)({constructOnly:!0})],h.prototype,"view",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],h.prototype,"drapeSourceType",void 0),(0,i._)([(0,o.Cb)()],h.prototype,"renderGroup",void 0),h=(0,i._)([(0,a.j)("DrapedVisualElementLayerView")],h);var p=n(86244),f=n(94172),_=n(79100),g=n(66327),m=n(97882);class v{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==_.U.Mesh&&t.type!==_.U.Line&&t.type!==_.U.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==_.U.Mesh&&t.type!==_.U.Line&&t.type!==_.U.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,n=t._stage;if(!n)return;const i=new m.F(n,{pickable:!1,updatePolicy:u.j.SYNC}),r=new g.T({castShadow:!1}),s=e.createResources(r,i);s.forEach((e=>{n.add(e),e.type===_.U.Texture&&e.load(n.renderView.renderingContext)})),n.add(r),i.add(r);const o=e.cameraChanged,a=o?(0,f.YP)((()=>t.state.camera),(e=>o(e)),f.nn):null;this._resources={layer:i,object:r,external:s,cameraHandle:a},this._syncVisible()}_destroyResources(){var e;if(null==this._resources)return;const t=this._resourceFactory.view._stage;t&&(t.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((e=>{t.remove(e),e.type===_.U.Texture&&e.unload()}))),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class y extends p.l{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new v(this.createObject3DResourceFactory(e.view)),this.drapedResources=new d(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},98917:(e,t,n)=>{n.d(t,{R:()=>w});var i=n(94172),r=n(29134),s=n(7025),o=n(32035),a=n(12400),l=n(19093),c=n(86361),u=n(51378),d=n(55946),h=n(19182),p=n(19265),f=n(91526),_=n(40779),g=n(70619),m=n(56529),v=n(39077),y=n(4760),S=n(66832),b=n(58901);class w extends h.i{constructor(e){super(e),this._maxSize=0,this._position=(0,a.Ue)(),this._up=(0,a.Ue)(),this._right=(0,a.Ue)(),this._renderOccluded=m.yD.OccludeAndTransparent,this._color=(0,c.al)(1,0,0,1),this._outlineColor=(0,c.al)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=m.yD.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,l.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,l.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:n,next:i}=e;this._maxSize=Math.min((0,o.q)(n,t),(0,o.q)(n,i))/3,(0,o.n)(this._up,(0,o.f)(this._up,t,n)),(0,o.n)(this._right,(0,o.f)(this._right,i,n)),(0,o.c)(this._position,n),this.recreateGeometry()}_createObject3DResources(e){const t=new S.E(this._quadMaterialParameters),n=0===this._outlineSize?void 0:new b.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,n),{quadMaterial:t,outlineMaterial:n,forEach:e=>{e(t),n&&e(n)}}}_createObject3DGeometries(e,t,n){if((0,o.j)(this._up,a.AG)&&(0,o.j)(this._right,a.AG))return;const i=this._createGeometries(t,n);for(const r of i)e.addGeometry(r);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new S.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new b.U(this._outlineMaterialParameters),n=this._createGeometries(e,t).map((e=>new v.z(e)));return this._setTransformDraped(n),{quadMaterial:e,outlineMaterial:t,geometries:n,pixelRatioHandle:(0,i.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:n,right:i,corner:r}=this._getVertices(),s=this._quadGeometryData(n,i,r,e);return t?[s,(0,g.rh)(t,[n,r,i])]:[s]}_getVertices(){let e=this._up,t=this._right;const n=(0,o.g)(u.WM.get(),e,t);return this.isDraped&&(e=(0,o.c)(u.WM.get(),e),t=(0,o.c)(u.WM.get(),t),e[2]=0,t[2]=0,n[2]=0),{up:e,right:t,corner:n}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);(0,r.vc)(P,this._position),(0,r.bA)(P,P,[i,i,i]),e.transformation=P}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{_position:i,_size:s}=this,a=(0,o.c)(u.WM.get(),i);a[2]=p.gi;const l=C;l.spatialReference=t.renderer.spatialReference,l.x=a[0],l.y=a[1];const c=s*(this.view.overlayPixelSizeInMapUnits(l)*n),d=Math.min(this._maxSize,c);(0,r.vc)(P,a),(0,r.bA)(P,P,[d,d,1]);for(const r of e)r.transformation=P}_quadGeometryData(e,t,n,i){return new _.Z(i,[[y.T.POSITION,new f.a([0,0,0,...t,...e,...n],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&null!==(e=e.outlineMaterial)&&void 0!==e&&e.setParameters(this._outlineMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||null===(t=t.outlineMaterial)||void 0===t||t.setParameters(this._outlineMaterialParameters)}}const P=(0,s.Ue)(),C=(0,d.T)(0,0,void 0,null)},87888:(e,t,n)=>{n.d(t,{Kj:()=>r,Sn:()=>i});const i={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},r={toggle:"Control"}},44179:(e,t,n)=>{n.d(t,{Hk:()=>y,M8:()=>k,aU:()=>G,jg:()=>U,kt:()=>C,ku:()=>b});var i=n(63780),r=n(16889),s=n(13611),o=n(6644),a=n(32035),l=n(12400),c=n(19093),u=n(86361),d=(n(38516),n(15559)),h=n(55652),p=n(23470),f=n(80064),_=n(38054),g=n(55793),m=n(94163);class v{intersect(e){return V(this,e)}closestPoints(e){return[this.closestTo(e)]}}class y extends v{constructor(e){super(),this.point=e}equals(e){return this===e||$(e)&&(0,a.j)(this.point,e.point)}closestTo(){return(0,_.d9)(this.point)}}class S extends v{constructor(e,t,n){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:n}}equals(e){return this===e||ee(e)&&this.lineLike.type===e.lineLike.type&&(0,a.j)(this.start,e.start)&&(0,a.j)(this.end,e.end)}closestTo(e){const t=(0,g.ZE)(e,this.lineLike);return(0,_.uo)(t)}}class b extends S{constructor(e,t){super(e,t,m.SP.LINE)}}class w extends S{constructor(e,t){super(e,t,m.SP.RAY)}}class P extends v{constructor(e){super(),this.constraints=e}equals(e){return this===e||J(e)&&(0,i.fS)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,n=1/0;for(const i of this.constraints){const r=i.closestTo(e),s=(0,a.a)(e,r);s<n&&(n=s,t=r)}return t?(0,_.d9)(t):e}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class C extends v{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ie(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,g.sc)(e,this.center,this.radius);return(0,_.uo)(t)}}class R extends v{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||re(e)&&(0,a.j)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,g.sc)(e,this.center,this.radius);return t[2]=this.center[2],(0,_.uo)(t)}asCircle(){return new M((0,_.d9)(this.center),this.radius,(0,_.al)(0,0,1))}}class M extends v{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;super(),this.center=e,this.radius=t,this.normal=n,this.slicePlane=i}equals(e){return this===e||se(e)&&(0,a.j)(this.center,e.center)&&(0,a.j)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:n}=this;(0,h.nF)(this.getPlane(T),e,x);const i=(0,a.z)(x,x,t),r=(0,a.p)(i);if((0,g.hA)(r,0))return(0,_.d9)(e);const s=n/Math.sqrt(r),o=(0,a.r)((0,l.Ue)(),t,i,s),{slicePlane:c}=this;if(c&&!(0,g.zf)(c,o)){var u;const t=I(c,this);return null!==(u=null===t||void 0===t?void 0:t.closestTo(e))&&void 0!==u?u:(0,_.d9)(e)}return(0,_.uo)(o)}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.Ue)();return(0,h.Yq)(this.center,this.normal,e)}}const x=(0,l.Ue)(),T=(0,h.Ue)();class O extends v{constructor(e){super(),this.z=e}equals(e){return this===e||te(e)&&this.z===e.z}closestTo(e){return(0,_.uo)((0,l.al)(e[0],e[1],this.z))}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.Ue)();return(0,a.s)(D,0,0,this.z),(0,h.Yq)(D,l.eG,e)}}const D=(0,l.Ue)();class E extends v{constructor(e,t,n){super(),this.start=e,this.end=t,this.planeLike={start:(0,_.eR)(e),end:(0,_.eR)(t),type:n}}equals(e){return this===e||ne(e)&&this.planeLike.type===e.planeLike.type&&(0,a.j)(this.start,e.start)&&(0,a.j)(this.end,e.end)}closestTo(e){return(0,_.uo)((0,g.z9)(e,this.planeLike))}closestEndTo(e){const{start:t,end:n}=this.planeLike;return Math.sign((0,s.AK)((0,s.$X)(A,n,t),(0,s.$X)(z,(0,_.eR)(e),t)))>0?this.end:this.start}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.Ue)();const t=(0,a.c)(j,this.end);return t[2]+=1,(0,h.zk)(this.start,this.end,t,e)}getSlicePlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.Ue)();const{start:t,end:n,type:i}=this.planeLike;if(i===g.Jk.PLANE)return;const r=(0,a.s)(j,t[0],t[1],0),s=(0,a.s)(L,n[0],n[1],0),o=(0,a.f)(L,s,r);return(0,h.Yq)(r,o,e),e}}const A=(0,o.Ue)(),z=(0,o.Ue)(),j=(0,l.Ue)(),L=(0,l.Ue)();class G extends E{constructor(e,t){super(e,t,g.Jk.HALF_PLANE)}}class U extends E{constructor(e,t){super(e,t,g.Jk.PLANE)}}class H extends v{constructor(e,t){super(),this.sphere=(0,p.k)(e,t)}equals(e){return this===e||oe(e)&&(0,p.l)(this.sphere,e.sphere)}closestTo(e){const t=(0,p.p)(this.sphere,e,(0,l.Ue)());return(0,_.uo)(t)}get center(){return(0,p.g)(this.sphere)}get radius(){return this.sphere[3]}}class k extends v{constructor(e,t,n){super(),this.start=e,this.end=t,this.getZ=n,this.planeLike={start:(0,_.eR)(e),end:(0,_.eR)(t),type:g.Jk.PLANE}}equals(e){return this===e||ae(e)&&(0,a.j)(this.start,e.start)&&(0,a.j)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){var n;const i=(0,g.z9)(t,e.planeLike);return i[2]=null!==(n=e.getZ(i[0],i[1]))&&void 0!==n?n:le,(0,_.uo)(i)}(this,e)}addIfOnTheGround(e,t){for(const i of t){var n;const t=null!==(n=this.getZ(i[0],i[1]))&&void 0!==n?n:0;(0,g.hA)(i[2],t)&&(i[2]=t,e.push(i))}}}new d._q;new d._q;function V(e,t){if(J(e)){const n=[];for(const i of e.constraints){const e=i.intersect(t);e&&n.push(e)}return Q(n)}if(J(t))return V(t,e);if(ae(e))return Y(e,t);if(ae(t))return Y(t,e);if($(e)){const{point:n}=e;if($(t))return(0,a.j)(n,t.point)?e:void 0;const i=t.closestTo(n);return(0,a.G)(i,n)?e:void 0}if(ee(e)){if($(t))return V(t,e);if(ee(t))return X((0,g.Au)(e.lineLike,t.lineLike));if(te(t))return F(e,t);if(ne(t))return X((0,g.fK)(t.planeLike,e.lineLike));if(ie(t))return X((0,g.CJ)(e.lineLike,t.center,t.radius));if(se(t))return X((0,g.UG)(e.lineLike,t));if(re(t))return function(e,t){let{lineLike:n}=e,{center:i,radius:r}=t;const s=i[2];return X((0,g.CJ)(n,i,r).filter((e=>(0,g.hA)(e[2],s))))}(e,t);if(oe(t))return function(e,t){let{lineLike:n}=e,{sphere:i}=t;return X((0,p.m)(i,n.start,n.end))}(e,t)}else if(te(e)){if($(t)||ee(t))return V(t,e);if(te(t))return function(e,t){return(0,g.hA)(e.z,t.z)?e:void 0}(e,t);if(ne(t))return function(e,t){let{z:n}=e,{planeLike:i}=t;const[r,s]=i.start,[o,a]=i.end,l=(0,_.al)(r,s,n),c=(0,_.al)(o,a,n);return i.type===g.Jk.PLANE?new b(l,c):new w(l,c)}(e,t);if(ie(t))return function(e,t){const[n,i]=t.center;return new R((0,_.al)(n,i,e.z),t.radius)}(e,t);if(se(t))return N(e,t);if(re(t))return function(e,t){return(0,g.hA)(t.center[2],e.z)?t:void 0}(e,t);if(oe(t))return function(e,t){let{center:n,radius:i}=t;const r=Math.abs(n[2]-e.z);if(r>i&&!(0,g.hA)(r,i))return;const s=(0,_.al)(n[0],n[1],e.z),o=Math.sqrt(i**2-r**2);return(0,g.hA)(o,0)?void 0:new R(s,o)}(e,t)}else if(ne(e)){if($(t)||ee(t)||te(t))return V(t,e);if(ne(t))return B((0,g.Nn)(e.planeLike,t.planeLike));if(ie(t))return B((0,g.SD)(e.planeLike,t.center,t.radius));if(se(t))return q(e,t);if(re(t))return Z(e,t);if(oe(t))return W(e,t)}else if(ie(e)){if($(t)||ee(t)||te(t)||ne(t))return V(t,e);if(ie(t))return B((0,g.Yf)((0,_.eR)(e.center),e.radius,(0,_.eR)(t.center),t.radius));if(se(t))return;if(re(t))return function(e,t){const n=(0,s.bI)((0,_.eR)(e.center),(0,_.eR)(t.center));return(0,g.hA)(n,0)&&(0,g.hA)(e.radius,t.radius)?t:K((0,g.Yf)((0,_.eR)(e.center),e.radius,(0,_.eR)(t.center),t.radius),t.center[2])}(e,t);if(oe(t))return}else if(se(e)){if($(t)||ee(t)||te(t)||ne(t)||ie(t))return V(t,e);if(se(t))return;if(re(t))return void t.asCircle();if(oe(t))return}else if(re(e)){if($(t)||ee(t)||te(t)||ne(t)||ie(t)||se(t))return V(t,e);if(re(t))return function(e,t){if(!(0,g.$7)(e.center,t.center))return;const n=(0,s.bI)((0,_.eR)(e.center),(0,_.eR)(t.center));return(0,g.hA)(n,0)&&(0,g.hA)(e.radius,t.radius)?e:K((0,g.Yf)((0,_.eR)(e.center),e.radius,(0,_.eR)(t.center),t.radius),e.center[2])}(t,e);if(oe(t))return}else if(oe(e)){if($(t)||ee(t)||te(t)||ne(t)||ie(t)||re(t))return V(t,e);if(oe(t))return}}const F=(()=>{const e=(0,h.Ue)();return(t,n)=>{const{start:i,end:r}=t;if((0,g.$7)(i,r)&&(0,g.hA)(i[2],n.z))return t;const s=(0,l.Ue)();return(0,h.fn)(n.getPlane(e),i,r,s)?new y((0,_.uo)(s)):void 0}})();const I=(()=>{const e=(0,u.Ue)(),t=(0,l.Ue)(),n=(0,l.Ue)();return(i,s,o)=>{const{normal:u,center:d,radius:p}=s;(0,f._F)(u,t,n);const m=(0,h.st)(i),v=p*(0,a.k)(m,t),S=p*(0,a.k)(m,n);(0,c.s)(e,d[0],d[1],d[2],1);const b=(0,c.g)(i,e),w=Math.hypot(v,S),P=(0,g.hA)(w,0);if((0,g.hA)((0,h.TE)(i,d),0)){if(P)return s;if((0,g.hA)(p,0))return!o||(0,g.zf)(o,d)?new y((0,_.d9)(d)):void 0;(0,a.b)(t,m,u),(0,a.n)(t,t);const e=new Array,n=(0,l.d9)(d);(0,a.r)(n,n,t,p),o&&!(0,g.zf)(o,n)||e.push(n);const i=(0,l.d9)(d);return(0,a.r)(i,i,t,-p),o&&!(0,g.zf)(o,i)||e.push(i),X(e)}if(P)return;const C=-b/w;if(Math.abs(C)>1||(0,g.hA)(C,1))return;const R=Math.atan(v/S),M=(0,r.Kt)(C)-R,x=Math.PI-M,T=new Array,O=(0,l.Ue)();(0,a.r)(O,d,t,p*Math.cos(M)),(0,a.r)(O,O,n,p*Math.sin(M)),T.push(O);const D=(0,l.Ue)();return(0,a.r)(D,d,t,p*Math.cos(x)),(0,a.r)(D,D,n,p*Math.sin(x)),T.push(D),X(o?(0,g.rq)(o,T):T)}})();const N=(()=>{const e=(0,h.Ue)();return(t,n)=>I(t.getPlane(e),n,n.slicePlane)})();const Z=(()=>{const e=(0,h.Ue)();return(t,n)=>{let{center:i,radius:r}=n;const s=(0,g.SD)(t.planeLike,i,r),o=i[2];t.getSlicePlane(e);const a=new Array;for(const[l,c]of s){const t=[l,c,o];(0,g.zf)(e,t)&&a.push(t)}return X(a)}})(),q=(()=>{const e=(0,h.Ue)(),t=(0,h.Ue)();return(n,i)=>I(n.getPlane(e),i,n.getSlicePlane(t))})(),W=(()=>{const e=(0,h.Ue)();return(t,n)=>{let{center:i,radius:r}=n;const s=t.getPlane(e),o=(0,h.jH)(s,i),c=Math.abs(o);if(c>r&&!(0,g.hA)(c,r))return;const u=(0,l.d9)((0,h.st)(s)),d=(0,a.r)((0,l.Ue)(),i,u,o),p=Math.sqrt(r**2-o**2);return(0,g.hA)(p,0)?new y((0,_.uo)((0,h.nF)(s,i,(0,l.Ue)()))):new M((0,_.uo)(d),p,u,t.getSlicePlane())}})();function Y(e,t){const{planeLike:n,getZ:i}=e,r=new Array;if($(t))e.addIfOnTheGround(r,(0,g.hm)(n,t.point));else if(ee(t))e.addIfOnTheGround(r,(0,g.fK)(n,t.lineLike));else if(ie(t))for(const[o,a]of(0,g.SD)(n,t.center,t.radius)){const e=i(o,a);null!=e&&r.push((0,l.al)(o,a,e))}else if(ne(t)||ae(t))for(const[o,a]of(0,g.Nn)(n,t.planeLike)){var s;const e=null!==(s=i(o,a))&&void 0!==s?s:le;r.push((0,l.al)(o,a,e))}return X(r)}function B(e){return Q(e.map((e=>{let[t,n]=e;const i=(0,_.al)(t,n,0),r=(0,_.al)(t,n,1);return new b(i,r)})))}function X(e){return Q(e.map((e=>e?new y((0,_.uo)(e)):void 0)))}function K(e,t){return X(e.map((e=>{let[n,i]=e;return[n,i,t]})))}function Q(e){var t;if(0!==e.length)return 1===e.length?null!==(t=e[0])&&void 0!==t?t:void 0:new P(e.filter(i.pC))}function J(e){return e instanceof P}function $(e){return e instanceof y}function ee(e){return e instanceof S}function te(e){return e instanceof O}function ne(e){return e instanceof E}function ie(e){return e instanceof C}function re(e){return e instanceof R}function se(e){return e instanceof M}function oe(e){return e instanceof H}function ae(e){return e instanceof k}const le=0},38054:(e,t,n)=>{n.d(t,{Ju:()=>p,SN:()=>h,Ue:()=>o,aK:()=>f,al:()=>c,d9:()=>u,eR:()=>l,j7:()=>d,uo:()=>a});var i=n(12400),r=n(55946),s=n(74509);function o(e,t,n){return(0,i.al)(e,t,n)}function a(e){return e}function l(e){return e}function c(e,t,n){return(0,i.al)(e,t,n)}function u(e){return(0,i.d9)(e)}function d(e,t,n){let{coordinateHelper:i,elevationInfo:r}=n;return e?h(i.vectorToDehydratedPoint(e,_),t,r):null}function h(e,t,n){var r,o;if(null==e)return null;if(null==t)return(0,i.al)(e.x,e.y,null!==(r=e.z)&&void 0!==r?r:0);if("2d"===t.type)return(0,i.al)(e.x,e.y,0);const a=null!==(o=(0,s.vQ)(t,e,n,s.jG))&&void 0!==o?o:0;return(0,i.al)(e.x,e.y,a)}function p(e,t){return(0,r.T)(e[0],e[1],e[2],t)}function f(e,t,n,i){let{z:o,m:a}=n;const{spatialReference:l,elevationInfo:c}=i;let u;if(null==o&&null==a)u=void 0;else if(null==t||"2d"===t.type)u=null!==o&&void 0!==o?o:void 0;else{var d;u=null!==(d=(0,s.zx)(t,e,l,s.jG,c))&&void 0!==d?d:0}const h=(0,r.T)(e[0],e[1],u,l);return null!=a&&(h.m=a,h.hasM=!0),h}const _=(0,r.T)(0,0,0,null)},80371:(e,t,n)=>{var i;n.d(t,{B:()=>i}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(i||(i={}))},97760:(e,t,n)=>{n.d(t,{k:()=>a});var i=n(44179),r=n(34356),s=n(75691),o=n(53397);class a extends s.a{constructor(e){super({...e,isDraped:!0,constraint:new i.M8(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.w(r.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},95905:(e,t,n)=>{n.d(t,{L:()=>a});var i=n(44179),r=n(34356),s=n(75691),o=n(53397);class a extends s.a{constructor(e){super({...e,constraint:new i.ku(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(r.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75691:(e,t,n)=>{n.d(t,{a:()=>s});var i=n(80371),r=n(92605);class s extends r.j{constructor(e){let{targetPoint:t,objectId:n,constraint:r,isDraped:s}=e;super(t,r,s,i.B.FEATURE),this.objectId=n}}},92605:(e,t,n)=>{n.d(t,{j:()=>i});class i{constructor(e,t,n,i){this.targetPoint=e,this.constraint=t,this.isDraped=n,this.domain=i}}},53397:(e,t,n)=>{n.d(t,{w:()=>o});n(93169),n(32718);var i=n(32035),r=n(80371),s=n(55054);class o extends s.r{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.B.ALL,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(i,s),this.type=e,this.lineStart=t,this.lineEnd=n,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,i.j)(this.lineStart,e.lineStart)&&(0,i.j)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return(0,i.q)(this.lineStart,this.lineEnd)}}},61309:(e,t,n)=>{n.d(t,{n:()=>s});var i=n(32035),r=n(55054);class s extends r.r{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof s&&(0,i.j)(this.point,e.point)}}},55054:(e,t,n)=>{n.d(t,{r:()=>i});class i{constructor(e,t){this.isDraped=e,this.domain=t}}},34356:(e,t,n)=>{n.d(t,{ze:()=>i,_j:()=>v,n0:()=>w,ML:()=>y,rh:()=>m,fG:()=>_,Ob:()=>b,lQ:()=>g,Bb:()=>f});var i,r=n(94172),s=n(92377),o=n(76672),a=n(86710),l=n(32035),c=n(55946),u=n(21149),d=n(51678),h=n(87888),p=n(38054);function f(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function _(e,t){return Math.sqrt(f(e,t))}function g(e,t){t.sort(((t,n)=>(0,l.a)(t.targetPoint,e)-(0,l.a)(n.targetPoint,e)))}function m(e,t,n){let{point:i,distance:r,returnEdge:l,vertexMode:d,coordinateHelper:{spatialReference:h},filter:p}=e;return n=null!=n?n.clone():new u.Z({where:"1=1"}),p&&(n.geometry=p.geometry,n.distance=p.distance,n.spatialRelationship=p.spatialRelationship,n.where=(0,o._)(n.where,p.where),n.timeExtent=(0,a.Ov)(n.timeExtent,p.timeExtent),n.objectIds=function(e,t){return e||t?t?e?Array.from((0,s.jV)(new Set(e),new Set(t))):t:e:null}(n.objectIds,p.objectIds)),{point:(0,c.T)(i[0],i[1],i[2],h.toJSON()),mode:t,distance:r,returnEdge:l,vertexMode:d,query:n.toJSON()}}function v(e,t,n){return{left:(0,p.j7)(e.leftVertex.pos,t,n),right:(0,p.j7)(e.rightVertex.pos,t,n)}}function y(e){return e.createQuery()}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(i||(i={}));const S=Symbol("snapping-toggle");function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};const n=(0,r.YP)((()=>({view:e.view,snappingOptions:e.snappingOptions})),(n=>{let{view:i,snappingOptions:r}=n;if(e.removeHandles(S),!i||!r)return;const s=d.f.TOOL,o=[i.on("key-down",(e=>{e.key!==h.Kj.toggle||e.repeat||(r.enabledToggled=!0,t())}),s),i.on("key-up",(e=>{e.key===h.Kj.toggle&&(r.enabledToggled=!1,t())}),s),i.on("pointer-move",(e=>{const n=e.native.ctrlKey;r.enabledToggled!==n&&(r.enabledToggled=n,t())}),s)];e.addHandles(o,S)}),r.tX);e.addHandles(n)}function w(e){var t;return function(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}(e)&&"utilityNetworks"in e&&!(null===(t=e.utilityNetworks)||void 0===t||!t.length)}},47072:(e,t,n)=>{n.d(t,{T:()=>s,Y:()=>o});var i=n(15559),r=n(92975);function s(e,t,n,s){for(var o=arguments.length,a=new Array(o>4?o-4:0),l=4;l<o;l++)a[l-4]=arguments[l];return(0,r.sT)(e)&&(0,i.Gb)(e)?t.apply(void 0,a):(0,r.sS)(e)?n.apply(void 0,a):s.apply(void 0,a)}const o=1e5},55793:(e,t,n)=>{n.d(t,{$7:()=>C,Au:()=>b,CJ:()=>S,Jk:()=>T,Nn:()=>_,SD:()=>h,UG:()=>y,Yf:()=>w,ZE:()=>v,fK:()=>p,hA:()=>R,hm:()=>f,rq:()=>M,sc:()=>m,z9:()=>g,zf:()=>x});var i=n(16889),r=n(13611),s=n(6644),o=n(32035),a=n(12400),l=n(24204),c=n(55652),u=n(80064),d=n(94163);function h(e,t,n){let{start:i,end:o,type:a}=e;const l=[],c=(0,r.$X)(D,o,i),u=(0,r.$X)(E,i,t),d=(0,r.we)(c),h=2*(0,r.AK)(c,u),p=h*h-4*d*((0,r.we)(u)-n*n);if(0===p){const e=-h/(2*d);(a===T.PLANE||e>=0)&&l.push((0,r.od)((0,s.Ue)(),i,c,e))}else if(p>0){const e=Math.sqrt(p),t=(-h+e)/(2*d);(a===T.PLANE||t>=0)&&l.push((0,r.od)((0,s.Ue)(),i,c,t));const n=(-h-e)/(2*d);(a===T.PLANE||n>=0)&&l.push((0,r.od)((0,s.Ue)(),i,c,n))}return l}function p(e,t){const n=e.start,i=e.end,s=(0,r.$X)(D,i,n),c=(0,o.s)(z,-s[1],s[0],0),u=t.start,h=t.end,p=(0,o.z)(j,h,u),f=(0,o.k)(p,c),_=(0,o.s)(L,n[0],n[1],0),g=(0,o.z)(G,_,u),m=(0,o.k)(g,c),v=(0,l.bn)();if(Math.abs(f)<v)return Math.abs(m),[];const y=(0,o.r)(U,u,p,m/f);if(t.type===d.SP.RAY){const e=(0,o.z)(H,y,u);if((0,o.k)(e,p)<-v)return[]}if(e.type===T.HALF_PLANE){const e=(0,r.lu)(E,y,n);if((0,r.AK)(e,s)<-v)return[]}return[(0,a.d9)(y)]}function f(e,t){return function(e,t){let{start:n,end:i,type:r}=e;const s=(0,o.z)(A,t,n),c=(0,o.z)(z,i,n),u=(0,o.b)(j,c,s),h=(0,o.x)(u)/(0,o.x)(c),p=(0,l.bn)();if(h<p)switch(r){case d.SP.LINE:return[(0,a.d9)(t)];case d.SP.RAY:return(0,o.k)(c,s)<-p?[]:[(0,a.d9)(t)]}return[]}(P(V,t[2],e),t)}function _(e,t){return b(P(V,0,e),P(F,0,t)).map((e=>{let[t,n]=e;return(0,s.al)(t,n)}))}function g(e,t){return v(e,P(V,e[2],t))}function m(e,t,n){const i=(0,r.$X)(D,e,t),s=(0,r.kE)(i),o=0===s?1:n/s,l=(0,a.Ue)();return(0,r.od)(l,t,i,o),l[2]=e[2],l}function v(e,t){let{start:n,end:i,type:r}=t,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,a.Ue)();const l=(0,o.z)(A,e,n),c=(0,o.z)(z,i,n),u=(0,o.k)(l,c)/(0,o.k)(c,c);return(0,o.r)(s,n,c,r===d.SP.RAY?Math.max(u,0):u)}const y=(()=>{const e=(0,a.Ue)(),t=(0,a.Ue)(),n=(0,a.Ue)();return(i,l)=>{let{start:h,end:p}=i,{center:f,radius:_,normal:g,slicePlane:m}=l;const v=(0,c.Yq)(f,g,k);if(R((0,c.TE)(v,h),0)&&R((0,c.TE)(v,p),0)){(0,u._F)(g,e,t);const i=(i,s)=>((0,o.f)(n,s,f),(0,r.t8)(i,(0,o.k)(n,e),(0,o.k)(n,t)),i),l=(0,d.UG)({start:i(D,h),end:i(E,p),type:d.SP.LINE},s.AG,_),c=[];for(const[n,r]of l){const i=(0,o.c)((0,a.Ue)(),f);(0,o.r)(i,i,e,n),(0,o.r)(i,i,t,r),m&&!x(m,i)||c.push(i)}return c}const y=(0,a.Ue)();return(0,c.fn)(v,h,p,y)?!R((0,o.q)(y,f),_)||m&&!x(m,y)?[]:[y]:[]}})();function S(e,t,n){let{start:i,end:s,type:l}=e;const c=[],u=(0,o.f)(A,s,i),h=(0,r.$X)(E,i,t),p=(0,r.we)(u),f=2*(0,r.AK)(u,h),_=f*f-4*p*((0,r.we)(h)-n*n);if(0===_){const e=-f/(2*p);(l===d.SP.LINE||e>=0)&&c.push((0,o.r)((0,a.Ue)(),i,u,e))}else if(_>0){const e=Math.sqrt(_),t=(-f+e)/(2*p);(l===d.SP.LINE||t>=0)&&c.push((0,o.r)((0,a.Ue)(),i,u,t));const n=(-f-e)/(2*p);(l===d.SP.LINE||n>=0)&&c.push((0,o.r)((0,a.Ue)(),i,u,n))}return c}function b(e,t){const n=e.start,i=e.end,r=t.start,s=t.end,c=(0,o.z)(A,i,n),u=(0,o.z)(z,s,r),h=(0,o.z)(j,r,n),p=(0,o.b)(L,c,u);if(!R((0,o.k)(h,p),0))return[];const f=(0,o.x)(p);if(R(f,0))return[];const _=(0,o.b)(G,h,u),g=(0,o.k)(_,p)/f,m=(0,o.r)(U,n,c,g);if(e.type===d.SP.RAY){const e=(0,o.z)(H,m,n);if((0,o.k)(c,e)<-(0,l.bn)())return[]}if(t.type===d.SP.RAY){const e=(0,o.z)(H,m,r);if((0,o.k)(u,e)<-(0,l.bn)())return[]}return[(0,a.d9)(m)]}function w(e,t,n,i){const[o,a]=e,[l,c]=n,u=l-o,d=c-a,h=u*u+d*d,p=Math.sqrt(h);if(p>t+i)return[];if(p<Math.abs(t-i))return[];if(R(p,0)&&R(t,i))return[];const f=(t*t-i*i+h)/(2*p),_=Math.sqrt(t*t-f*f),g=_*d/p,m=_*u/p,[v,y]=(0,r.t7)(D,e,n,f/p);return R(g,m)?[(0,s.al)(v,y)]:[(0,s.al)(v+g,y-m),(0,s.al)(v-g,y+m)]}function P(e,t,n){let{start:i,end:r,type:s}=n;return(0,o.s)(e.start,i[0],i[1],t),(0,o.s)(e.end,r[0],r[1],t),e.type=O[s],e}function C(e,t){return R(e[2],t[2])}function R(e,t){return(0,i.W8)(Math.abs(e-t),0,(0,l.bn)())}function M(e,t){return t.filter((t=>x(e,t)))}function x(e,t){return(0,c.Ac)(e,t)}var T;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(T||(T={}));const O={[T.PLANE]:d.SP.LINE,[T.HALF_PLANE]:d.SP.RAY},D=(0,s.Ue)(),E=(0,s.Ue)(),A=(0,a.Ue)(),z=(0,a.Ue)(),j=(0,a.Ue)(),L=(0,a.Ue)(),G=(0,a.Ue)(),U=(0,a.Ue)(),H=(0,a.Ue)(),k=(0,c.Ue)(),V={start:(0,a.Ue)(),end:(0,a.Ue)(),type:d.SP.LINE},F={start:(0,a.Ue)(),end:(0,a.Ue)(),type:d.SP.LINE}}}]);
//# sourceMappingURL=78027.179be182.chunk.js.map