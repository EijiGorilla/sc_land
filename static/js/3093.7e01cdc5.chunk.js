"use strict";(self.webpackChunksc_land=self.webpackChunksc_land||[]).push([[3093],{97942:(e,t,i)=>{function r(e){let t,i,r=[],n=!1;return function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return n&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(o,r)||(i=e.apply(this,o),t=this,r=o,n=!0),i}}i.d(t,{H:()=>r})},79311:(e,t,i)=>{i.d(t,{_:()=>B});var r=i(51995),n=i(86950),s=(i(93169),i(42537)),o=i(32035),a=i(12400),l=i(5986),c=i(74509),u=i(97411),d=i(94172),h=i(17842),p=i(13611),_=i(6644),g=i(19093),f=i(99894),m=i(55946),v=i(19182),y=i(19265),x=i(70619),S=i(56529),O=i(39077),D=i(4760),R=i(58901);class w extends v.i{constructor(e){super(e),this._location=(0,a.Ue)(),this._direction=(0,a.al)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,f.al)(1,0,1,1),this._renderOccluded=S.yD.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:b,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:G,recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,o.e)(this._location,e)||((0,o.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,o.e)(this._direction,e)||((0,o.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,o.n)(this._direction,(0,o.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,g.a)(e,this._color)||((0,g.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new R.U(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[r,n]=z(e);t.addGeometry(r),t.addGeometry(n),i.push(r),i.push(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new R.U(this.materialParameters),t=(0,d.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=z(e);return this._updateVerticesDraped(t),t.map((e=>new O.z(e)))}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,A),(0,o.g)(M,this.location,this.direction),t.projectToScreen(M,I),(0,p.Fv)(I,(0,p.$X)(I,I,A)),this._updateVertexAttributesObject3D(t,e,0,A,I,1),this._updateVertexAttributesObject3D(t,e,1,A,I,-1)}_updateVertexAttributesObject3D(e,t,i,r,n,s){var o;const a=t.geometries[i],l=null===(o=a.getMutableAttribute(D.T.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:u}=P(n,r,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,h.c$)(c),M),l[0]=M[0],l[1]=M[1],l[2]=M[2],e.unprojectFromScreen((0,h.c$)(u),M),l[3]=M[0],l[4]=M[1],l[5]=M[2],t.geometryVertexAttributeUpdated(a,D.T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:r,width:n,length:s,offset:o}=this,a=j;a.spatialReference=t.renderer.spatialReference,a.x=r[0],a.y=r[1];const l=this.view.overlayPixelSizeInMapUnits(a)*i,c=n*l,u=s*l,d=o*l;this._updateVertexAttributesDraped(e[0],c,u,d,-1),this._updateVertexAttributesDraped(e[1],c,u,d,1)}_updateVertexAttributesDraped(e,t,i,r,n){var s;const o=null===(s=e.getMutableAttribute(D.T.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:c,end:u}=P(l,a,n,r,t,i);o[0]=c[0],o[1]=c[1],o[2]=y.gi,o[3]=u[0],o[4]=u[1],o[5]=y.gi,e.invalidateBoundingInfo()}}function z(e){return[(0,x.rh)(e,[(0,a.Ue)(),(0,a.Ue)()]),(0,x.rh)(e,[(0,a.Ue)(),(0,a.Ue)()])]}function P(e,t,i,r,n,s){const o=(0,p.bA)(T,(0,p.t8)(T,e[1]*i,e[0]*-i),r+n/2),a=(0,p.IH)(C,(0,p.IH)(C,(0,p.IH)(C,t,(0,p.bA)(C,e,s/2)),o),o);return{start:a,end:(0,p.IH)(E,a,(0,p.bA)(E,e,-s))}}function b(e){e.geometries.length=0}function G(e){e.pixelRatioHandle.remove(),e.geometries=[]}const M=(0,a.Ue)(),T=(0,_.Ue)(),C=(0,_.Ue)(),E=(0,_.Ue)(),A=(0,h.s1)(),I=(0,h.s1)(),j=(0,m.T)(0,0,void 0,null);var H=i(66730),U=i(98917),F=i(26279),Z=i(38054),V=i(76014),q=i(80371),L=i(34356),k=i(38561),N=i(53397),W=i(11208);class B extends k.a{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof N.w?t.length:0)-(e instanceof N.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:r}=t,n=Q(t);return(0,s.ed)(new H.L({view:r,primitive:"circle",geometry:(0,Z.Ju)(e.intersectionPoint,i),elevationInfo:e.isDraped?c.tR:c.jG,size:20,outlineSize:2,color:n.intersectionPointColor,outlineColor:n.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:r}=t,n=Q(t),o=Y(e.point,e.domain,t);return(0,s.ed)(new H.L({view:i,primitive:"circle",geometry:(0,Z.Ju)(o,r),elevationInfo:$(e),size:20,outlineSize:2,color:n.pointColor,outlineColor:n.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:r}=t,n=Q(t),o=Y(e.lineStart,e.domain,t),a=Y(e.lineEnd,e.domain,t);return(0,s.ed)(function(e,t,i,r,n,s,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const d=J(t,r,n,s,a),h=J(i,r,n,s,a),p=new u.V({view:s,extensionType:u.n.FADED,start:d,end:h,isDraped:a,color:o.lineColor,renderOccluded:a?S.yD.OccludeAndTransparent:S.yD.Opaque,renderGroup:F.eZ.SnappingHint,isDecoration:!0});switch(e){case L.ze.TARGET:p.width=V.c.lineHintWidthTarget,p.fadedExtensions={start:0,end:V.c.lineHintFadedExtensions};break;case L.ze.REFERENCE_EXTENSION:p.width=V.c.lineHintWidthReference,p.fadedExtensions={start:0,end:0};break;case L.ze.REFERENCE:p.width=V.c.lineHintWidthReference,p.fadedExtensions={start:l?V.c.lineHintFadedExtensions:0,end:c?V.c.lineHintFadedExtensions:0}}return p.attached=!0,p}(e.type,o,a,r,$(e),i,n,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:r}=t,n=Q(t),{isDraped:a}=e,l=$(e),c=Y(e.lineStart,e.domain,t),u=Y(e.lineEnd,e.domain,t),d=J(c,r,l,i,a),h=J(u,r,l,i,a),p=(0,o.o)(h,d,h,.5),_=new w({view:i,attached:!1,offset:V.c.parallelLineHintOffset,length:V.c.parallelLineHintLength,width:V.c.parallelLineHintWidth,color:n.parallelSignColor,location:p,renderOccluded:a?S.yD.OccludeAndTransparent:S.yD.Opaque,isDraped:a,renderGroup:F.eZ.SnappingHint,isDecoration:!0});return _.setDirectionFromPoints(d,p),_.attached=!0,(0,s.ed)(_)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:r}=t,n=Q(t),o=$(e),{isDraped:a}=e,l=Y(e.previousVertex,e.domain,t),c=Y(e.centerVertex,e.domain,t),u=Y(e.nextVertex,e.domain,t),d=J(l,r,o,i,a),h=J(c,r,o,i,a),p=J(u,r,o,i,a);return(0,s.ed)(new U.R({view:i,attached:!0,color:a?n.rightAngleColorDraped:n.rightAngleColor,renderOccluded:a?S.yD.OccludeAndTransparent:S.yD.Transparent,outlineRenderOccluded:a?S.yD.OccludeAndTransparent:S.yD.Opaque,outlineColor:n.rightAngleOutlineColor,outlineSize:V.c.rightAngleHintOutlineSize,size:V.c.rightAngleHintSize,isDraped:a,geometry:{previous:d,center:h,next:p},renderGroup:F.eZ.SnappingHint,isDecoration:!0}))}}function Q(e){const{effectiveTheme:t}=e.view,i=r.Z.toUnitRGBA(t.accentColor),s=[0,0,0,0];return{intersectionPointColor:s,intersectionPointOutlineColor:i,pointColor:s,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:r.Z.toUnitRGBA((0,n.G)(t.accentColor,.5)),rightAngleOutlineColor:i}}function Y(e,t,i){let{selfSnappingZ:r,view:n,spatialReference:s}=i;return t&q.B.SELF&&(0,Z.hx)(e)&&null!=r?(0,Z.Vx)(e,r,n,s):e}function $(e){return e.isDraped?c.tR:c.jG}function J(e,t,i,r,n){const s=(0,a.Ue)();if(n){const i=r.basemapTerrain.overlayManager.renderer.spatialReference;(0,l.S)(e,t,s,i)}else(0,W.RS)(e,t,i,r,s);return s}},66730:(e,t,i)=>{i.d(t,{L:()=>v});var r=i(16889),n=i(32035),s=i(12400),o=i(19093),a=i(86361),l=i(5986),c=i(41414),u=i(51378),d=i(52168),h=i(69691),p=i(78935),_=i(67794),g=i(70619),f=i(4760),m=i(21400);class v extends d._{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,a.al)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,a.al)(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,o.a)(e,this._color)||((0,o.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,o.a)(e,this._outlineColor)||((0,o.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const i=t.getMutableAttribute(f.T.SIZE).data,r=this._geometrySize;i[0]=r,i[1]=r,e.geometryVertexAttributeUpdated(e.geometries[0],f.T.SIZE)}get _materialParameters(){var e;return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,_.Rg)(this._primitive),distanceFieldBoundingBox:x,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:null===(e=this._texture)||void 0===e?void 0:e.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/y}createExternalResources(){this._texture=(0,_.cU)(this._primitive,this._preferredTextureSize),this._material=new m.A(this._materialParameters);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return(0,r.uZ)(2*this._geometrySize,16,128)}calculateMapBounds(e){var t;const i=null===(t=this.object)||void 0===t?void 0:t.geometries[0];if(!i)return!1;const r=i.attributes.get(f.T.POSITION).data;return(0,l.S)(r,this.view.renderCoordsHelper.spatialReference,S,this.view.spatialReference),(0,c.G1)(e,S),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:i,elevationProvider:r}=this.view,s=(0,h.w7)(e,r,p.o.fromElevationInfo(this.elevationInfo),i),o=(0,n.s)(u.WM.get(),e.x,e.y,s),a=u.WM.get();(0,l.S)(o,e.spatialReference,a,i.spatialReference);const c=this._geometrySize;return(0,g.dV)(t,null,a,null,[c,c],[0,0,0,1])}}const y=_.hy,x=[y/2,y/2,1-y/2,1-y/2],S=(0,s.Ue)()},98917:(e,t,i)=>{i.d(t,{R:()=>O});var r=i(94172),n=i(29134),s=i(7025),o=i(32035),a=i(12400),l=i(19093),c=i(86361),u=i(51378),d=i(55946),h=i(19182),p=i(19265),_=i(91526),g=i(40779),f=i(70619),m=i(56529),v=i(39077),y=i(4760),x=i(66832),S=i(58901);class O extends h.i{constructor(e){super(e),this._maxSize=0,this._position=(0,a.Ue)(),this._up=(0,a.Ue)(),this._right=(0,a.Ue)(),this._renderOccluded=m.yD.OccludeAndTransparent,this._color=(0,c.al)(1,0,0,1),this._outlineColor=(0,c.al)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=m.yD.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:D}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,l.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,l.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:i,next:r}=e;this._maxSize=Math.min((0,o.p)(i,t),(0,o.p)(i,r))/3,(0,o.n)(this._up,(0,o.f)(this._up,t,i)),(0,o.n)(this._right,(0,o.f)(this._right,r,i)),(0,o.c)(this._position,i),this.recreateGeometry()}_createObject3DResources(e){const t=new x.E(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new S.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_createObject3DGeometries(e,t,i){if((0,o.e)(this._up,a.AG)&&(0,o.e)(this._right,a.AG))return;const r=this._createGeometries(t,i);for(const n of r)e.addGeometry(n);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new x.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new S.U(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new v.z(e)));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,r.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_createGeometries(e,t){const{up:i,right:r,corner:n}=this._getVertices(),s=function(e,t,i,r){return new g.Z(r,[[y.T.POSITION,new _.a([0,0,0,...t,...e,...i],[0,1,2,1,2,3],3,!0)]])}(i,r,n,e);return t?[s,(0,f.rh)(t,[i,n,r])]:[s]}_getVertices(){let e=this._up,t=this._right;const i=(0,o.g)(u.WM.get(),e,t);return this.isDraped&&(e=(0,o.c)(u.WM.get(),e),t=(0,o.c)(u.WM.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);(0,n.vc)(R,this._position),(0,n.bA)(R,R,[r,r,r]),e.transformation=R}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:r,_size:s}=this,a=(0,o.c)(u.WM.get(),r);a[2]=p.gi;const l=w;l.spatialReference=t.renderer.spatialReference,l.x=a[0],l.y=a[1];const c=s*(this.view.overlayPixelSizeInMapUnits(l)*i),d=Math.min(this._maxSize,c);(0,n.vc)(R,a),(0,n.bA)(R,R,[d,d,1]);for(const n of e)n.transformation=R}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&null!==(e=e.outlineMaterial)&&void 0!==e&&e.setParameters(this._outlineMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||null===(t=t.outlineMaterial)||void 0===t||t.setParameters(this._outlineMaterialParameters)}}function D(e){e.pixelRatioHandle.remove(),e.geometries=[]}const R=(0,s.Ue)(),w=(0,d.T)(0,0,void 0,null)},34019:(e,t,i)=>{i.d(t,{N:()=>r});class r{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}},80151:(e,t,i)=>{i.d(t,{W:()=>h});var r=i(92026),n=i(66978),s=i(94172),o=i(70178),a=i(37818),l=i(74509),c=i(74229),u=i(34019),d=i(93463);function h(e){let{predicate:t=(()=>!0),snappingManager:i,snappingContext:a,updatingHandles:h,useZ:m=!0}=e;const v=new c.hM;if(null==i)return{snappingStep:[f,v],cancelSnapping:f};let y,x=null,S=null,O=null;const D=()=>{var e;x=(0,r.IM)(x),i.doneSnapping(),null!==(e=S)&&void 0!==e&&e.frameTask.remove(),S=null,y=(0,r.hw)(y),O=null},R=(w=i,z=m,P=v,(0,n.Ds)((async(e,t)=>{let{frameTask:i,point:r,scenePoint:n,context:s,event:a,delta:l,getLastState:c}=e;const u=await i.schedule((()=>w.snap({point:r,scenePoint:n,context:s,signal:t})),t);if(u.valid){let e=await i.schedule((()=>u.apply()),t);const n=c();null!=n.point&&r!==n.point&&(e=w.update({point:n.point,scenePoint:n.scenePoint,context:s})),null!=n.updatePoint&&(0,o.kg)(e,n.updatePoint)||(g(a.mapEnd,e,l,z),P.execute(a))}})));var w,z,P;let b=null,G=null,M=null;return{snappingStep:[e=>{if(!t(e))return e;const{action:r}=e;if("start"===r){const{info:t}=e,r=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(d.T8.SNAPPING):d.sq}(i.view);if(S=function(e,t,i){return{context:new u.N({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:i}}(a,e,r),S.context.selfSnappingZ=null,!m&&null!=t){var o;const e=function(e,t){if(!e.hasZ())return null;const i=t.vertices;let r=null;for(const n of i){const t=e.getZ(n.pos);if(null!=r&&null!=t&&Math.abs(t-r)>1e-6)return null;null==r&&(r=t)}return r}(a.coordinateHelper,t.handle.component);null!=e&&(S.context.selfSnappingZ={value:e,elevationInfo:null!==(o=a.elevationInfo)&&void 0!==o?o:l.jG})}}if(null!=S){const{context:t,originalScenePos:o,originalPos:a}=S,{mapEnd:l,mapStart:c,scenePoints:u}=e,d=p(a,_(l,c)),f=_(c,a),v={...e,action:"update"},D=S.context,w=function(e,t){return null==e||null==t?null:p(e,_(t.sceneEnd,t.sceneStart))}(o,u),z=i.update({point:d,scenePoint:w,context:t});if(M=z,g(l,z,f,m),b=d,G=w,"end"!==r){const{frameTask:e}=S;null==x&&(x=new AbortController),O=t=>{h.addPromise((0,n.R8)(R({frameTask:e,event:v,context:D,point:d,scenePoint:w,delta:f,getLastState:()=>({point:b,scenePoint:G,updatePoint:t.forceUpdate?null:M})},x.signal)))},O({forceUpdate:!1}),null==y&&(y=(0,s.YP)((()=>i.options.effectiveEnabled),(()=>{var e;return null===(e=O)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===r&&D(),e},v],cancelSnapping:e=>(D(),e)}}function p(e,t){let[i,r,n]=t;const s=(0,a.WG)(e);return s.x+=i,s.y+=r,s.hasZ&&(s.z+=n),s}function _(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function g(e,t,i,r){let[n,s,o]=i;e.x=t.x+n,e.y=t.y+s,r&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function f(e){return e}},38561:(e,t,i)=>{i.d(t,{a:()=>c});var r=i(42537),n=i(90609),s=i(53397),o=i(5916),a=i(61309),l=i(41216);class c{draw(e,t){const i=function(e){const t=[];for(const i of e){let e=!0;for(const r of t)if(i.equals(r)){e=!1;break}e&&t.push(i)}return t}(e),c=this.sortUniqueHints(i),u=[];for(const r of c)r instanceof n.w&&u.push(this.visualizeIntersectionPoint(r,t)),r instanceof s.w&&u.push(this.visualizeLine(r,t)),r instanceof o.L&&u.push(this.visualizeParallelSign(r,t)),r instanceof l.y&&u.push(this.visualizeRightAngleQuad(r,t)),r instanceof a.n&&u.push(this.visualizePoint(r,t));return(0,r.AL)(u)}sortUniqueHints(e){return e}}},61309:(e,t,i)=>{i.d(t,{n:()=>s});var r=i(32035),n=i(55054);class s extends n.r{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof s&&(0,r.e)(this.point,e.point)}}}}]);
//# sourceMappingURL=3093.7e01cdc5.chunk.js.map