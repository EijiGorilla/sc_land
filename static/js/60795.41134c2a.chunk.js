"use strict";(self.webpackChunksc_land=self.webpackChunksc_land||[]).push([[60795],{99894:(e,t,i)=>{function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function o(){return r()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function d(){return s(0,0,1,0)}function u(){return s(0,0,0,1)}i.d(t,{al:()=>s,d9:()=>n});const h=o(),p=a(),f=l(),g=c(),_=d(),y=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:y,UNIT_X:f,UNIT_Y:g,UNIT_Z:_,ZEROS:h,clone:n,create:r,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:u,unitX:l,unitY:c,unitZ:d,zeros:o},Symbol.toStringTag,{value:"Module"}))},87072:(e,t,i)=>{function r(e){var t;const i=e.layer;return"floorInfo"in i&&null!==(t=i.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?s(e.view.floors,i.floorInfo.floorField):null}function n(e,t){var i;return"floorInfo"in t&&null!==(i=t.floorInfo)&&void 0!==i&&i.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(null===e||void 0===e||!e.length)return null;const i=e.filter((e=>""!==e)).map((e=>"'".concat(e,"'")));return i.push("''"),"".concat(t," IN (").concat(i.join(","),") OR ").concat(t," IS NULL")}i.d(t,{c:()=>r,f:()=>n})},62815:(e,t,i)=>{i.d(t,{_:()=>te});var r=i(51995),n=i(86950),s=(i(93169),i(42537)),o=i(32035),a=i(12400),l=i(5986),c=i(74509),d=i(19093),u=i(99894),h=i(70444),p=i(95773),f=i(85981),g=i(40885),_=i(19182),y=i(62389),v=i(19265),m=i(70619),S=i(56529),w=i(39077),b=i(4760),R=i(58901);class E extends _.i{constructor(e){super(e),this._ray=(0,g.Ue)(),this._isWorldDown=!1,this._start=(0,a.Ue)(),this._end=(0,a.al)(1,0,0),this._width=1,this._color=(0,u.al)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,u.al)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=P.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=S.yD.OccludeAndTransparent,this._fadedExtensions=j,this._laserline=new y.W({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,o.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,o.f)(this._end,e,this._end),(0,g.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,o.j)(this._start,e)||((0,o.c)(this._start,e),(0,g.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,o.j)(this._end,e)||((0,o.c)(this._end,e),(0,g.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,d.a)(e,this._color)||((0,d.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,d.a)(e,this._innerColor)||((0,d.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,d.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,u.d9)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===S.yD.OccludeAndTransparentStencil?S.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:j,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new R.U(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const r=this._createGeometry(e);i.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new R.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new w.z(t)}_createGeometry(e){const t=this.extensionType===P.FADED,i=t?[(0,a.Ue)(),(0,a.Ue)(),(0,a.Ue)(),(0,a.Ue)()]:[(0,a.Ue)(),(0,a.Ue)()];return(0,m.rh)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===P.FADED?this._updateLineSegmentFinite(T):this._updateLineSegmentInfinite(this._extensionType,T)}_updateLineSegmentFinite(e){return(0,f.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,h.iL)(this._ray,x),e){case P.LINE:x.c0=-Number.MAX_VALUE;break;case P.RAY:case P.GROUND_RAY:{var r;const e=this._ray.origin,t=null!==(r=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==r?r:0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,o.F)(x.ray.direction,x.ray.direction),this._extensionType===P.GROUND_RAY&&null!=t&&(x.c1=Math.abs(i-t));break}}if(!(0,p.zq)(i.frustum,x))return this._updateLineSegmentFinite(t);const n=(0,h.Ws)(x,C),s=(0,h.S$)(x,D);return(0,f.zk)(n,s,t)}_updateVertexAttributesObject3D(e,t){var i;const r=null===(i=e.geometries[0].getMutableAttribute(b.T.POSITION))||void 0===i?void 0:i.data;if(!r)return;let n=0;for(const s of this._lineVertices(t))r[n++]=s[0],r[n++]=s[1],r[n++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],b.T.POSITION)}_updateVertexAttributesDraped(e,t){var i;const r=null===(i=e.getMutableAttribute(b.T.POSITION))||void 0===i?void 0:i.data;if(!r)return;let n=0;for(const s of this._lineVertices(t))r[n++]=s[0],r[n++]=s[1],r[n++]=v.gi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===P.FADED?(yield(0,f.KU)(e,-this.fadedExtensions.start,C),yield(0,f.KU)(e,0,C),yield(0,f.KU)(e,1,C),yield(0,f.KU)(e,1+this.fadedExtensions.end,C)):(yield(0,f.KU)(e,0,C),yield(0,f.KU)(e,1,C))}}const x=(0,h.Ue)(),C=(0,a.Ue)(),D=(0,a.Ue)(),T=(0,f.Ue)();var P;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(P||(P={}));const O=1/3,j={start:O,end:O};var F=i(94172),L=i(17842),G=i(13611),A=i(6644),I=i(55946);class V extends _.i{constructor(e){super(e),this._location=(0,a.Ue)(),this._direction=(0,a.al)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,u.al)(1,0,1,1),this._renderOccluded=S.yD.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,o.j)(this._location,e)||((0,o.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,o.j)(this._direction,e)||((0,o.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,o.n)(this._direction,(0,o.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,d.a)(e,this._color)||((0,d.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new R.U(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[r,n]=this._createGeometries(e);t.addGeometry(r),t.addGeometry(n),i.push(r),i.push(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new R.U(this.materialParameters),t=(0,F.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new w.z(e)))}_createGeometries(e){return[(0,m.rh)(e,[(0,a.Ue)(),(0,a.Ue)()]),(0,m.rh)(e,[(0,a.Ue)(),(0,a.Ue)()])]}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,H),(0,o.g)(M,this.location,this.direction),t.projectToScreen(M,k),(0,G.Fv)(k,(0,G.$X)(k,k,H)),this._updateVertexAttributesObject3D(t,e,0,H,k,1),this._updateVertexAttributesObject3D(t,e,1,H,k,-1)}_updateVertexAttributesObject3D(e,t,i,r,n,s){var o;const a=t.geometries[i],l=null===(o=a.getMutableAttribute(b.T.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:d}=this._computeStartEnd(n,r,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,L.c$)(c),M),l[0]=M[0],l[1]=M[1],l[2]=M[2],e.unprojectFromScreen((0,L.c$)(d),M),l[3]=M[0],l[4]=M[1],l[5]=M[2],t.geometryVertexAttributeUpdated(a,b.T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:r,width:n,length:s,offset:o}=this,a=Z;a.spatialReference=t.renderer.spatialReference,a.x=r[0],a.y=r[1];const l=this.view.overlayPixelSizeInMapUnits(a)*i,c=n*l,d=s*l,u=o*l;this._updateVertexAttributesDraped(e[0],c,d,u,-1),this._updateVertexAttributesDraped(e[1],c,d,u,1)}_updateVertexAttributesDraped(e,t,i,r,n){var s;const o=null===(s=e.getMutableAttribute(b.T.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:c,end:d}=this._computeStartEnd(l,a,n,r,t,i);o[0]=c[0],o[1]=c[1],o[2]=v.gi,o[3]=d[0],o[4]=d[1],o[5]=v.gi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,r,n,s){const o=(0,G.bA)(U,(0,G.t8)(U,e[1]*i,e[0]*-i),r+n/2),a=(0,G.IH)(N,(0,G.IH)(N,(0,G.IH)(N,t,(0,G.bA)(N,e,s/2)),o),o);return{start:a,end:(0,G.IH)(z,a,(0,G.bA)(z,e,-s))}}}const M=(0,a.Ue)(),U=(0,A.Ue)(),N=(0,A.Ue)(),z=(0,A.Ue)(),H=(0,L.s1)(),k=(0,L.s1)(),Z=(0,I.T)(0,0,void 0,null);var q=i(66730),W=i(98917),B=i(26279),Y=i(38054),X=i(76014),K=i(80371),$=i(34356),Q=i(38561),J=i(53397),ee=i(11208);class te extends Q.a{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof J.w?t.length:0)-(e instanceof J.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:r}=t,n=ie(t);return(0,s.ed)(new q.L({view:r,primitive:"circle",geometry:(0,Y.Ju)(e.intersectionPoint,i),elevationInfo:e.isDraped?c.tR:c.jG,size:20,outlineSize:2,color:n.intersectionPointColor,outlineColor:n.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:r}=t,n=ie(t),o=re(e.point,e.domain,t);return(0,s.ed)(new q.L({view:i,primitive:"circle",geometry:(0,Y.Ju)(o,r),elevationInfo:ne(e,t),size:20,outlineSize:2,color:n.pointColor,outlineColor:n.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:r}=t,n=ie(t),o=re(e.lineStart,e.domain,t),a=re(e.lineEnd,e.domain,t);return(0,s.ed)(this._createLineSegmentHint(e.type,o,a,r,ne(e,t),i,n,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:r}=t,n=ie(t),{isDraped:a}=e,l=ne(e,t),c=re(e.lineStart,e.domain,t),d=re(e.lineEnd,e.domain,t),u=oe(c,r,l,i,a),h=oe(d,r,l,i,a),p=(0,o.m)(h,u,h,.5),f=new V({view:i,attached:!1,offset:X.c.parallelLineHintOffset,length:X.c.parallelLineHintLength,width:X.c.parallelLineHintWidth,color:n.parallelSignColor,location:p,renderOccluded:a?S.yD.OccludeAndTransparent:S.yD.Opaque,isDraped:a,renderGroup:B.eZ.SnappingHint,isDecoration:!0});return f.setDirectionFromPoints(u,p),f.attached=!0,(0,s.ed)(f)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:r}=t,n=ie(t),o=ne(e,t),{isDraped:a}=e,l=re(e.previousVertex,e.domain,t),c=re(e.centerVertex,e.domain,t),d=re(e.nextVertex,e.domain,t),u=oe(l,r,o,i,a),h=oe(c,r,o,i,a),p=oe(d,r,o,i,a);return(0,s.ed)(new W.R({view:i,attached:!0,color:a?n.rightAngleColorDraped:n.rightAngleColor,renderOccluded:a?S.yD.OccludeAndTransparent:S.yD.Transparent,outlineRenderOccluded:a?S.yD.OccludeAndTransparent:S.yD.Opaque,outlineColor:n.rightAngleOutlineColor,outlineSize:X.c.rightAngleHintOutlineSize,size:X.c.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:h,next:p},renderGroup:B.eZ.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,i,r,n,s,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const d=oe(t,r,n,s,a),u=oe(i,r,n,s,a),h=new E({view:s,extensionType:P.FADED,start:d,end:u,isDraped:a,color:o.lineColor,renderOccluded:a?S.yD.OccludeAndTransparent:S.yD.Opaque,renderGroup:B.eZ.SnappingHint,isDecoration:!0});switch(e){case $.ze.TARGET:h.width=X.c.lineHintWidthTarget,h.fadedExtensions={start:0,end:X.c.lineHintFadedExtensions};break;case $.ze.REFERENCE_EXTENSION:h.width=X.c.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case $.ze.REFERENCE:h.width=X.c.lineHintWidthReference,h.fadedExtensions={start:l?X.c.lineHintFadedExtensions:0,end:c?X.c.lineHintFadedExtensions:0}}return h.attached=!0,h}}function ie(e){const{effectiveTheme:t}=e.view,i=r.Z.toUnitRGBA(t.accentColor),s=[0,0,0,0];return{intersectionPointColor:s,intersectionPointOutlineColor:i,pointColor:s,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:r.Z.toUnitRGBA((0,n.G)(t.accentColor,.5)),rightAngleOutlineColor:i}}function re(e,t,i){const r=se(t,i);return null==r?e:(0,Y.Ue)(e[0],e[1],r)}function ne(e,t){return null!=se(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?c.tR:c.jG}function se(e,t){let{selfSnappingZ:i}=t;return e===K.B.SELF&&null!=i?i.value:null}function oe(e,t,i,r,n){const s=(0,a.Ue)();if(n){const i=r.basemapTerrain.overlayManager.renderer.spatialReference;(0,l.S)(e,t,s,i)}else(0,ee.RS)(e,t,i,r,s);return s}},51328:(e,t,i)=>{i.d(t,{J4:()=>_,_N:()=>f,cx:()=>r,gv:()=>y});i(59486);var r,n=i(17842),s=(i(32035),i(12400)),o=(i(79803),i(55652)),a=i(40885),l=(i(40927),i(51378)),c=(i(74509),i(81703)),d=i(88153),u=i(54463),h=i(76783),p=(i(5693),i(585));function f(e,t){return g(e,(()=>t))}function g(e,t){const i=(0,s.Ue)(),r=(0,s.Ue)();let a=!1;return s=>{const d=t(s);if("start"===s.action){const t=(0,n.md)(s.screenStart,(0,n.c$)(l.qW.get())),r=(0,c.u4)(e.state.camera,t,v);null!=r&&(a=(0,o.BR)(d,r,i))}if(!a)return null;const u=(0,n.md)(s.screenEnd,(0,n.c$)(l.qW.get())),h=(0,c.u4)(e.state.camera,u,v);return null==h?null:(0,o.BR)(d,h,r)?{...s,renderStart:i,renderEnd:r,plane:d,ray:h}:null}}function _(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return i}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=(0,d.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=u.eC.MIN,i.options.hud=!1;const o=(0,n.s1)(),a={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=(0,s.Ue)(),c=null!==t&&void 0!==t?t:e.spatialReference,f=t=>{e.map.ground&&e.map.ground.opacity<1?a.exclude.add(h.xX):a.exclude.delete(h.xX),e.sceneIntersectionHelper.intersectIntersectorScreen((0,n.md)(t,o),i,a);const s=i.results.min;let d;if(s.getIntersectionPoint(l))d=s.intersector===u.q7.TERRAIN?r.GROUND:r.OTHER;else{if(!i.results.ground.getIntersectionPoint(l))return null;d=r.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(l,new p.Z({spatialReference:c})),surfaceType:d}};let g;return e=>{if("start"===e.action){const t=f(e.screenStart);g=null!=t?t.location:null}if(null==g)return null;const t=f(e.screenEnd);return null!=(null===t||void 0===t?void 0:t.location)?{...e,mapStart:g,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(r||(r={}));(0,s.Ue)(),(0,s.Ue)();const v=(0,a.Ue)()},69763:(e,t,i)=>{i.d(t,{u:()=>je});var r=i(42537),n=i(70758),s=i(80987),o=i(94172),a=i(27366),l=i(7138),c=i(49861),d=(i(93169),i(32718)),u=(i(84936),i(69912));let h=class extends l.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new s.Z}};(0,a._)([(0,c.Cb)({constructOnly:!0})],h.prototype,"layer",void 0),(0,a._)([(0,c.Cb)()],h.prototype,"enabled",void 0),(0,a._)([(0,c.Cb)()],h.prototype,"updating",void 0),(0,a._)([(0,c.Cb)()],h.prototype,"availability",void 0),(0,a._)([(0,c.Cb)()],h.prototype,"sublayerSources",void 0),h=(0,a._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],h);const p=h;var f=i(76014),g=i(63780);let _=class extends l.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new s.Z,this.distance=f.c.distance,this.touchSensitivityMultiplier=f.c.touchSensitivityMultiplier,this.constraintsActive=!1}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var e,t,i;const r=this.featureSources;r.some(v)&&d.Z.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const n=r.filter(S),o=null!==(e=null===(t=this._get("_effectiveFeatureSources"))||void 0===t?void 0:t.filter(v))&&void 0!==e?e:new s.Z;for(const s of n){const e=o.find((e=>e.layer===s.layer.parent));if(e)e.sublayerSources.includes(s)||e.sublayerSources.add(s);else if(s.layer.parent){const e=new p({layer:s.layer.parent});e.sublayerSources.add(s),o.add(e)}}for(const s of o){const e=s.sublayerSources.filter((e=>!n.includes(e)));s.sublayerSources.removeMany(e)}o.removeMany(o.filter((e=>0===e.sublayerSources.length)));const a=r.filter(m),l=null!==(i=this._get("_effectiveFeatureSources"))&&void 0!==i?i:new s.Z,{added:c,removed:u}=(0,g.e5)(l.toArray(),[...a,...o]);return l.removeMany(u),l.addMany(c),l}};(0,a._)([(0,c.Cb)()],_.prototype,"enabled",void 0),(0,a._)([(0,c.Cb)()],_.prototype,"enabledToggled",void 0),(0,a._)([(0,c.Cb)()],_.prototype,"forceDisabled",void 0),(0,a._)([(0,c.Cb)()],_.prototype,"selfEnabled",void 0),(0,a._)([(0,c.Cb)()],_.prototype,"featureEnabled",void 0),(0,a._)([(0,c.Cb)({type:s.Z.ofType(p)})],_.prototype,"featureSources",void 0),(0,a._)([(0,c.Cb)()],_.prototype,"distance",void 0),(0,a._)([(0,c.Cb)()],_.prototype,"touchSensitivityMultiplier",void 0),(0,a._)([(0,c.Cb)()],_.prototype,"constraintsActive",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],_.prototype,"effectiveEnabled",null),(0,a._)([(0,c.Cb)({readOnly:!0})],_.prototype,"effectiveSelfEnabled",null),(0,a._)([(0,c.Cb)({readOnly:!0})],_.prototype,"effectiveFeatureEnabled",null),(0,a._)([(0,c.Cb)({readOnly:!0})],_.prototype,"_effectiveFeatureSources",null),_=(0,a._)([(0,u.j)("esri.views.interactive.snapping.SnappingOptions")],_);const y=_;function v(e){return"subtype-group"===e.layer.type}function m(e){return"subtype-group"!==e.layer.type}function S(e){return"subtype-sublayer"===e.layer.type}var w=i(66978),b=i(68860),R=i(13611),E=i(32035),x=i(12400),C=i(24204),D=i(46634),T=i(74509),P=i(44179),O=i(38054),j=i(76672),F=i(18661),L=i(87072),G=i(37933),A=i(34356),I=i(69787);let V=class extends l.Z{get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){var e,t,i;const{layer:r,snappingSource:n}=this;if(!(0,G.e9)(r)||null===(e=r.subtypes)||void 0===e||!e.length)return{mode:"not-in-use",filter:null};const s=n.layerSource.sublayerSources.filter((e=>{var t;return e.enabled&&e.layer.visible&&(0,I.rs)(null===(t=this.view)||void 0===t?void 0:t.scale,e.layer.effectiveScaleRange.minScale,e.layer.effectiveScaleRange.maxScale)})).map((e=>e.layer.subtypeCode));if(!s.length)return{mode:"none-visible",filter:null};if(s.length===r.subtypes.length)return{mode:"all-visible",filter:null};const o=null!==(t=null===(i=r.fieldsIndex.get(r.subtypeField))||void 0===i?void 0:i.name)&&void 0!==t?t:r.subtypeField;return 1===s.length?{mode:"in-use",filter:"".concat(o," = ").concat(s.getItemAt(0))}:{mode:"in-use",filter:"".concat(o," IN (").concat(s.join(", "),")")}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,L.c)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,o.YP)((()=>t.updating),(e=>t.layerSource.updating=e),o.tX),(0,o.YP)((()=>t.availability),(e=>t.layerSource.availability=e),o.tX)])}getFetchCandidatesParameters(e,t,i){var r,n,s,o,a;if(!this.valid)return[];const{layer:l,layerView:c,floorFilter:d,rulesTable:u,subtypeFilter:h}=this,p={distance:i,mode:null!==(r=null===(n=this.view)||void 0===n?void 0:n.type)&&void 0!==r?r:"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:c&&"filter"in c?c.filter:null};if(d&&(p.filter=M(p.filter,d)),"not-in-use"!==h.mode&&"all-visible"!==h.mode){if("none-visible"===h.mode)return[];p.filter?p.filter.where=(0,j._)(p.filter.where,h.mode):p.filter=new F.Z({where:h.filter})}const f=t.feature,g="subtype-sublayer"===(null===f||void 0===f||null===(s=f.sourceLayer)||void 0===s?void 0:s.type)?f.sourceLayer.parent:null===f||void 0===f?void 0:f.sourceLayer;if(u&&f&&(0,A.n0)(null===(o=this.view)||void 0===o?void 0:o.map)&&((0,G.Te)(l)||(0,G.e9)(l))&&l.layerId&&((0,G.Te)(g)||(0,G.e9)(g))&&null!==(a=this.view.map.utilityNetworks)&&void 0!==a&&a.find((e=>e.isUtilityLayer(g)))){var _;if("loaded"!==u.loadStatus)return[];const e=[],t=l.layerId,i=null===(_=u.getFeatureSQL(g,f))||void 0===_?void 0:_[t];if(!i)return[];const r=i.anyVertex;let n=i.endVertex;return n&&r&&n===r&&(n=""),n&&e.push({...p,returnEdge:!1,vertexMode:"ends",filter:M(p.filter,n)}),r&&e.push({...p,returnEdge:!1,vertexMode:"all",filter:M(p.filter,r)}),e}return[p]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,A.n0)(null===t||void 0===t?void 0:t.map)&&((0,G.Te)(e)||(0,G.e9)(e))){var i;const n=null===(i=t.map.utilityNetworks)||void 0===i?void 0:i.find((t=>t.isUtilityLayer(e)));if(n)try{var r;this.rulesTable=await n.getRulesTable(),await(null===(r=this.rulesTable)||void 0===r?void 0:r.load())}catch(h){return void d.Z.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function M(e,t){return null==e?new F.Z({where:t}):e.where?new F.Z({where:(0,j._)(e.where,t)}):new F.Z({where:t})}(0,a._)([(0,c.Cb)({constructOnly:!0})],V.prototype,"layer",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],V.prototype,"snappingSource",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],V.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],V.prototype,"layerView",null),(0,a._)([(0,c.Cb)()],V.prototype,"rulesTable",void 0),(0,a._)([(0,c.Cb)()],V.prototype,"valid",null),(0,a._)([(0,c.Cb)()],V.prototype,"subtypeFilter",null),(0,a._)([(0,c.Cb)()],V.prototype,"floorFilter",null),(0,a._)([(0,c.Cb)()],V.prototype,"_valid",void 0),V=(0,a._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],V);var U,N=i(80371),z=i(97760),H=i(95905),k=i(75691),Z=i(92605),q=i(53397),W=i(41216);class B extends Z.j{constructor(e){let{targetPoint:t,constraint:i,previousVertex:r,otherVertex:n,otherVertexType:s,objectId:o,isDraped:a}=e;super(t,i,a,N.B.SELF),this.previousVertex=r,this.otherVertex=n,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===U.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===U.CENTER?this.targetPoint:this.otherVertex;return[new q.w(A.ze.TARGET,t,i,this.isDraped,this.domain),new q.w(A.ze.REFERENCE,e,t,this.isDraped,this.domain),new W.y(this.previousVertex,t,i,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(U||(U={}));var Y=i(11208);let X=class extends l.Z{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=N.B.FEATURE,this._updatingHandles=new D.R,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,o.TP)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e._effectiveFeatureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,r.ed)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,r){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const n=[],s=this._computeScreenSizeDistanceParameters(e,i);for(const l of this._snappingSources){var o;if(null==l||!l.valid||!l.snappingSource.layerSource.enabled||null!==(o=l.layerView)&&void 0!==o&&o.suspended)continue;const t=l.getFetchCandidatesParameters(e,i,s);for(const e of t)n.push(l.snappingSource.fetchCandidates(e,r).then((e=>e.filter((e=>!this._candidateIsExcluded(l.snappingSource,e,i.excludeFeature))))))}const a=(await(0,w.OT)(n)).flat();return this._addRightAngleCandidates(a,e,s,i),(0,w.k_)(r),(0,A.lQ)(e,a),a}_addRightAngleCandidates(e,t,i,r){var n,s,o,a;const l=null!=r.vertexHandle?null===(n=r.vertexHandle.rightEdge)||void 0===n||null===(n=n.rightVertex)||void 0===n?void 0:n.pos:null!=r.editGeometryOperations&&"polygon"===r.editGeometryOperations.data.type?null===(s=r.editGeometryOperations.data.components[0])||void 0===s||null===(s=s.getFirstVertex())||void 0===s?void 0:s.pos:null,c=null!=r.vertexHandle?null===(o=r.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=r.editGeometryOperations?null===(a=r.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:d}=this,u=(0,O.j7)(l,d,r),h=(0,O.j7)(c,d,r),p=e.length;for(let f=0;f<p;f++)this._addRightAngleCandidate(e[f],h,t,i,e),this._addRightAngleCandidate(e[f],u,t,i,e)}_addRightAngleCandidate(e,t,i,r,n){if(null==t||!function(e){return(e instanceof H.L||e instanceof z.k)&&!function(e){let{constraint:{start:t,end:i}}=e;const r=(0,E.a)(t,i),n=(0,R.bI)((0,O.eR)(t),(0,O.eR)(i));return r<(0,C.bn)()||n/r<J}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-i[0])/r.x,a=(s[1]-i[1])/r.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const i=new B({targetPoint:s,otherVertex:t,otherVertexType:U.NEXT,previousVertex:(0,R.bI)((0,O.eR)(s),(0,O.eR)(l))>(0,R.bI)((0,O.eR)(s),(0,O.eR)(c))?l:c,constraint:new P.aU(t,s),objectId:e.objectId,isDraped:e.isDraped});n.push(i)}}_computeScreenSizeDistanceParameters(e,t){let i=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,r){const{spatialReference:n}=r;i.renderCoordsHelper.toRenderCoords(e,n,$);const s=i.state.camera.computeScreenPixelSizeAt($),o=s*i.renderCoordsHelper.unitInMeters,a=o/(0,b.c9)(n),l=o/(0,b._R)(n),c=t*a,d=t*l,u=(0,Y.Rs)(e,n,T.jG,i),h=u?K(u,e,a,0,0,i,r):0,p=u?K(u,e,0,a,0,i,r):0,f=u?K(u,e,0,0,l,i,r):0;return{x:0===h?0:c/h,y:0===p?0:c/p,z:0===f?0:d/f,distance:s*t}}_candidateIsExcluded(e,t,i){if(null==i)return!1;const r=this._getCandidateObjectId(t);if(null==r)return!1;const n=e.layerSource.layer;return"graphics"===n.type?i.uid===r:i.sourceLayer===n&&!(!i.attributes||!("objectIdField"in n))&&i.attributes[n.objectIdField]===r}_getCandidateObjectId(e){return e instanceof k.a?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),(0,w.k_)(t));const{view:r}=this,n=await this._createFeatureSnappingSourceType(e);return(0,w.k_)(t),new V(null==n?{}:{snappingSource:n,view:r,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,i;return null!==(t=null===(i=e.layer.sublayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),i={module:null,loader:t};this._sourceModules[e]=i;const r=await t,n={module:r,loader:t};return this._sourceModules[e]=n,r}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(i.e(5532).then(i.bind(i,5532)));case"featureCollection":return t.addPromise(i.e(26823).then(i.bind(i,26823)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(54054),i.e(45026),i.e(71486),i.e(14346),i.e(33518)]).then(i.bind(i,33518)));case"scene":return t.addPromise(i.e(92767).then(i.bind(i,92767)))}}get test(){return{snappingSources:this._snappingSources}}};function K(e,t,i,r,n,s,o){let{spatialReference:a}=o;const l=(0,E.c)(Q,t);l[0]+=i,l[1]+=r,l[2]+=n;const c=(0,Y.Rs)(l,a,T.jG,s);return c?(0,A.fG)(c,e):1/0}(0,a._)([(0,c.Cb)({constructOnly:!0})],X.prototype,"spatialReference",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],X.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],X.prototype,"options",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],X.prototype,"updating",null),(0,a._)([(0,c.Cb)()],X.prototype,"_snappingSources",void 0),X=(0,a._)([(0,u.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],X);const $=(0,x.Ue)(),Q=(0,x.Ue)(),J=1e-4;var ee=i(91505),te=i(79803),ie=i(17768),re=i(47898);class ne{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=f.c.shortLineThreshold*f.c.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,O.j7)(e.leftVertex.pos,this.view,t),(0,O.j7)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,i){let{spatialReference:r}=i;return 0===this.squaredShortLineThreshold||(0,A.Bb)((0,Y.Rs)(t,r,T.jG,this.view),(0,Y.Rs)(e,r,T.jG,this.view))>this.squaredShortLineThreshold}isVertical(e,t,i){let{spatialReference:r}=i;const n=(0,b.c9)(r);return(0,R.TE)((0,O.eR)(e),(0,O.eR)(t))*n<f.c.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class se extends Z.j{constructor(e){let{lineStart:t,lineEnd:i,targetPoint:r,isDraped:n}=e;super(r,new P.jg(t,i),n,N.B.SELF),this._referenceLineHint=new q.w(A.ze.REFERENCE_EXTENSION,t,i,n,this.domain)}get hints(){return[this._referenceLineHint,new q.w(A.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var oe=i(73840),ae=i(30541),le=i(55793),ce=i(94163);class de extends ne{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,n=[];if(r<1)return n;const{spatialReference:s}=t,o=(0,Y.Rs)(e,s,T.jG,this.view),{view:a}=this,l=i.edges[r-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const i=(0,A._j)(c,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,n)}c=c.leftVertex.leftEdge}while(c&&c!==l);return n}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<2)return i;const{view:s}=this,{spatialReference:o}=t,a=(0,Y.Rs)(e,o,T.jG,s),l=r.leftEdge,c=r.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,O.j7)(l.leftVertex.pos,s,t),(0,O.j7)(c.rightVertex.pos,s,t),e,a,t,i);const d=n.edges[0];let u=d;do{if(u!==r.leftEdge&&u!==r.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const r=(0,A._j)(u,s,t);this._processCandidateProposal(r.left,r.right,e,a,t,i)}u=u.rightVertex.rightEdge}while(u&&u!==d);return i}_processCandidateProposal(e,t,i,r,n,s){var o;const{spatialReference:a,pointer:l}=n,c=(0,x.Ue)();this._projectedLine(c,e,t,i,n);const d=(0,O.uo)(c);(0,A.Bb)(r,(0,Y.Rs)(d,a,T.jG,this.view))<this.squaredProximityThreshold(l)&&s.push(new se({lineStart:e,lineEnd:t,targetPoint:d,isDraped:"on-the-ground"===(null===(o=n.elevationInfo)||void 0===o?void 0:o.mode)}))}_projectedLine(e,t,i,r,n){this._projectToLineGeodesic(e,t,i,r,n)||this._projectToLinePlanar(e,r,t,i)}_projectToLineGeodesic(e,t,i,r,n){let{spatialReference:s}=n;const o=(0,oe.n6)(t,i,s,s);if(null==o)return!1;const a=(0,oe.n6)(i,r,s,s);if(null==a)return!1;const l=(0,ae.FB)(i,r,s);if(null==l)return!1;const c=Math.abs(ie.Q4.shortestSignedDiff(o,a))>Math.PI/2?ie.c5.normalize(o+Math.PI):o;return(0,oe.LH)(e,i,s,(0,re.mE)(l,"meters"),(0,re.GJ)(c,"radians","geographic"),"geodesic"),e[2]=r[2],!0}_projectToLinePlanar(e,t,i,r){(0,le.ZE)(t,{start:i,end:r,type:ce.SP.LINE},e),e[2]=t[2]}}var ue=i(6644),he=i(5916);class pe extends Z.j{constructor(e){let{referenceLine:t,lineStart:i,targetPoint:r,isDraped:n}=e;const s=(0,x.d9)(i),{left:o,right:a}=t;(0,E.f)(s,(0,E.g)(s,s,a),o),super(r,new P.jg(i,(0,O.uo)(s)),n,N.B.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new q.w(A.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new he.L(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new q.w(A.ze.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{(0,E.j)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,E.j)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,E.j)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,E.j)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class fe extends ne{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,n=i.vertices.length,s=[];if(r<2)return s;const{view:o}=this,a=(0,Y.Rs)(e,t.spatialReference,T.jG,o),l=(0,O.j7)(i.vertices[n-1].pos,o,t),c=(0,O.j7)(i.vertices[0].pos,o,t),d=i.edges[r-1];let u=d;do{if(this.edgeExceedsShortLineThreshold(u,t)){const i=(0,A._j)(u,o,t);this._checkEdgeForParallelLines(i,l,e,a,t,s),this._checkEdgeForParallelLines(i,c,e,a,t,s)}u=u.leftVertex.leftEdge}while(u&&u!==d);return s}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<3)return i;const{view:s}=this,o=(0,Y.Rs)(e,t.spatialReference,T.jG,s),a=r.leftEdge,l=r.rightEdge,c=n.vertices[0],d=(0,O.j7)(c.pos,s,t),u=n.vertices.length,h=n.vertices[u-1],p=(0,O.j7)(h.pos,s,t),f=n.edges[0];let g=f;do{if(g!==a&&g!==l&&this.edgeExceedsShortLineThreshold(g,t)){const n=(0,A._j)(g,s,t);a&&this._checkEdgeForParallelLines(n,(0,O.j7)(a.leftVertex.pos,s,t),e,o,t,i),l&&this._checkEdgeForParallelLines(n,(0,O.j7)(l.rightVertex.pos,s,t),e,o,t,i),r===c?this._checkEdgeForParallelLines(n,p,e,o,t,i):r===h&&this._checkEdgeForParallelLines(n,d,e,o,t,i)}g=g.rightVertex.rightEdge}while(g&&g!==f);return i}_checkEdgeForParallelLines(e,t,i,r,n,s){const o=e.left,a=e.right;if((0,ce.k0)(ge,(0,O.eR)(t),(0,O.eR)(o),(0,O.eR)(a)),(0,R.bI)(ge,(0,O.eR)(t))<f.c.parallelLineThreshold)return;(0,ce.k0)(ge,(0,O.eR)(i),(0,O.eR)(o),(0,O.eR)(a),(0,O.eR)(t));const{spatialReference:l,pointer:c}=n,d=(0,O.al)(ge[0],ge[1],i[2]);if((0,A.Bb)(r,(0,Y.Rs)(d,l,T.jG,this.view))<this.squaredProximityThreshold(c)){var u;if(this.isVertical(d,t,n)||this.isVertical(o,a,n))return;if(this._parallelToPreviousCandidate(e,s))return;s.push(new pe({referenceLine:e,lineStart:t,targetPoint:d,isDraped:"on-the-ground"===(null===(u=n.elevationInfo)||void 0===u?void 0:u.mode)}))}}_parallelToPreviousCandidate(e,t){const i=e.left,r=e.right;for(const n of t)if((0,ce.k0)(ge,(0,O.eR)(r),(0,O.eR)(n.constraint.start),(0,O.eR)(n.constraint.end),(0,O.eR)(i)),(0,R.bI)(ge,(0,O.eR)(r))<f.c.parallelLineThreshold)return n.addReferenceLine(e),!0;return!1}}const ge=(0,ue.Ue)();class _e extends ne{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[];if(i.vertices.length<2)return r;const{view:n}=this,s=(0,Y.Rs)(e,t.spatialReference,T.jG,n),o=i.vertices.at(-1);this._checkForSnappingCandidate(r,o.leftEdge,o,o.leftEdge.leftVertex,e,s,t);const a=i.vertices[0];return this._checkForSnappingCandidate(r,a.rightEdge,a,a.rightEdge.rightVertex,e,s,t),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle;if(r.component.vertices.length<3)return i;const{view:n}=this,s=(0,Y.Rs)(e,t.spatialReference,T.jG,n),o=r.leftEdge,a=r.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const r=o.leftVertex.leftEdge;this._checkForSnappingCandidate(i,r,r.rightVertex,r.leftVertex,e,s,t)}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const r=a.rightVertex.rightEdge;this._checkForSnappingCandidate(i,r,r.leftVertex,r.rightVertex,e,s,t)}return i}_checkForSnappingCandidate(e,t,i,r,n,s,o){if(!this.edgeExceedsShortLineThreshold(t,o))return;const a=this.view,l=(0,O.j7)(i.pos,a,o),c=(0,O.j7)(r.pos,a,o);this._checkForSnappingCandidateNormalized(e,c,l,n,s,o)}_checkForSnappingCandidateNormalized(e,t,i,r,n,s){this._projectionRay(ve,t,i,r,s),this._checkForSnappingCandidateAlongProjectedRay(e,t,i,ve,r,n,s)}_projectionRay(e,t,i,r,n){this._projectionRayGeodesic(e,t,i,r,n)||this._projectionRayPlanar(e,t,i)}_projectionRayGeodesic(e,t,i,r,n){let{spatialReference:s}=n;const o=(0,oe.n6)(t,i,s,s);if(null==o)return!1;const a=(0,oe.n6)(i,r,s,s);if(null==a)return!1;const l=Math.sign(ie.c5.shortestSignedDiff(o,a))*Math.PI*.5,c=(0,re.GJ)(o+l,"radians","geographic"),d=(0,x.Ue)(),u=(0,ae.FB)(i,r,s);return null!=u&&((0,oe.LH)(d,i,s,(0,re.mE)(u,"meters"),c,"geodesic"),(0,E.f)(e,d,i),!0)}_projectionRayPlanar(e,t,i){const r=(0,R.$X)(ye,(0,O.eR)(i),(0,O.eR)(t));(0,E.s)(e,r[1],-r[0],0)}_checkForSnappingCandidateAlongProjectedRay(e,t,i,r,n,s,o){var a;const{spatialReference:l,pointer:c}=o,d=(0,R.$X)(ye,(0,O.eR)(n),(0,O.eR)(i)),u=(0,R.AK)(r,d)/(0,R.we)(r),h=(0,R.od)(ye,(0,O.eR)(i),r,u),p=(0,O.al)(h[0],h[1],n[2]);if((0,A.Bb)(s,(0,Y.Rs)(p,l,T.jG,this.view))>this.squaredProximityThreshold(c)||this.isVertical(p,i,o)||this.isVertical(i,t,o))return;const f=(0,E.r)((0,x.Ue)(),i,r,Math.sign(u));e.push(new B({targetPoint:p,constraint:new P.aU(i,(0,O.uo)(f)),previousVertex:t,otherVertex:i,otherVertexType:U.CENTER,isDraped:"on-the-ground"===(null===(a=o.elevationInfo)||void 0===a?void 0:a.mode)}))}}const ye=(0,ue.Ue)(),ve=(0,x.Ue)();class me extends Z.j{constructor(e){let{targetPoint:t,point1:i,point2:r,isDraped:n}=e;super(t,new P.kt((0,O.uo)((0,E.m)((0,x.Ue)(),i,r,.5)),.5*(0,R.TE)((0,O.eR)(i),(0,O.eR)(r))),n,N.B.SELF),this._p1=i,this._p2=r}get hints(){return[new q.w(A.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new q.w(A.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new W.y(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class Se extends ne{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[],n=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||n<2)return r;const{view:s}=this,o=i.vertices[0],a=i.vertices[n-1],l=(0,O.j7)(o.pos,s,t),c=(0,O.j7)(a.pos,s,t);return this._processCandidateProposal(l,c,e,t,r),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===r.index||r.index===n.vertices.length-1))return i;const{view:s}=this,o=(0,O.j7)(r.leftEdge.leftVertex.pos,s,t),a=(0,O.j7)(r.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,i),i}_processCandidateProposal(e,t,i,r,n){if(!this.exceedsShortLineThreshold(e,t,r))return;const s=(0,R.t7)(we,(0,O.eR)(e),(0,O.eR)(t),.5),o=.5*(0,R.TE)((0,O.eR)(e),(0,O.eR)(t)),a=(0,ce.xO)(we,(0,O.eR)(i),s,o),l=(0,O.al)(a[0],a[1],i[2]),{spatialReference:c,pointer:d}=r,u=(0,Y.Rs)(i,c,T.jG,this.view);if((0,A.Bb)(u,(0,Y.Rs)(l,c,T.jG,this.view))<this.squaredProximityThreshold(d)){var h;if(this.isVertical(e,l,r)||this.isVertical(l,t,r))return;n.push(new me({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(h=r.elevationInfo)||void 0===h?void 0:h.mode)}))}}}const we=(0,ue.Ue)();let be=class extends l.Z{constructor(e){super(e),this.updating=!1,this._snappers=new s.Z,this._domain=N.B.SELF}initialize(){this._snappers.push(new fe(this.view,this.options),new de(this.view,this.options),new _e(this.view,this.options),new Se(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const r=[];for(const n of this._snappers.items)for(const t of n.snap(e,i))r.push(t);return(0,A.lQ)(e,r),r}};function Re(e,t){return[new be({view:e,options:t}),new X({view:e,options:t,spatialReference:e.spatialReference})]}(0,a._)([(0,c.Cb)({readOnly:!0})],be.prototype,"updating",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],be.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],be.prototype,"options",null),be=(0,a._)([(0,u.j)("esri.views.interactive.snapping.SelfSnappingEngine")],be);var Ee=i(90609);class xe extends Z.j{constructor(e,t,i,r){super(e,new P.Hk(e),r,N.B.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Ee.w(this.targetPoint,this.isDraped,this.domain)]}}let Ce=class extends(ee.Z.EventedMixin(l.Z)){constructor(e){super(e),this.options=new y,this.snappingEnginesFactory=Re,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=De.MAIN}initialize(){this.addHandles([(0,o.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r,constraintsActive:n}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r,constraintsActive:n}}),(()=>{this.doneSnapping(),this.emit("changed")}),o.Z_),(0,o.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),o.Z_),(0,o.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:i}=e;return this._recreateEngines(t,i)}),o.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:r}=this;this._engines=t(i,r)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}get _squaredSatisfiesConstraintThreshold(){return f.c.satisfiesConstraintScreenThreshold*f.c.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const r=this._currentMainCandidate;if(null==r)return t;const n=this._selectUpdateInput(e);if(null==n)return t;const{spatialReference:s}=i,o=(0,te.project)(n,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=i,d=[],u=(0,O.SN)(o,a,l),h=r.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,h,i))return this._resetSnappingState(),t;r.targetPoint=h,d.push(...r.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,d.push(...p.hints);return null!=c&&this.addHandles(c.draw(d,{spatialReference:s,elevationInfo:Pe(i),view:a,selfSnappingZ:i.selfSnappingZ}),Te),(0,O.aK)(h,a,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:i}=e;switch(this._currentSnappedType){case De.MAIN:return t;case De.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=De.MAIN}_removeVisualization(){this.removeHandles(Te)}async _snapSinglePoint(e){let{point:t,context:i,signal:r}=e;const{view:n}=this,{elevationInfo:s}=i,o=(0,O.SN)(t,n,s),a=await this._fetchCandidates(o,N.B.ALL,i,r);return this._createSnapResult(o,De.MAIN,a,n,t,i,r)}async _snapMultiPoint(e){var t,i;let{point:r,scenePoint:n,context:s,signal:o}=e;const{view:a}=this,{coordinateHelper:l,elevationInfo:c,spatialReference:d}=s;await(0,te.initializeProjection)(n.spatialReference,d);const u=(0,te.project)(n,d),h=(0,O.SN)(u,a,c),p=await this._fetchCandidates(h,N.B.FEATURE,s,o);if(p.length>0){const e=await this._fetchCandidates(h,N.B.SELF,s,o);return this._createSnapResult(h,De.SCENE,[...p,...e],a,u,s,o)}const f=(0,O.SN)(r,a,c),g=await this._fetchCandidates(f,N.B.SELF,s,o);return this._createSnapResult(f,De.MAIN,g,a,{z:l.hasZ()&&r.hasZ?null!==(t=r.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&r.hasM?null!==(i=r.m)&&void 0!==i?i:0:void 0},s,o)}async _fetchCandidates(e,t,i,r){return(await Promise.all(this._engines.map((n=>n.fetchCandidates(e,t,i,r))))).flat()}_createSnapResult(e,t,i,r,n,s,o){return{get valid(){return!(0,w.Hc)(o)},apply:()=>{const{spatialReference:o}=s,{snappedPoint:a,hints:l}=this._processCandidates(e,t,i,s);return this._removeVisualization(),null!=s.visualizer&&this.addHandles(s.visualizer.draw(l,{spatialReference:o,elevationInfo:T.jG,view:r,selfSnappingZ:s.selfSnappingZ}),Te),(0,O.aK)(a,r,n,s)}}}_processCandidates(e,t,i,r){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,A.lQ)(e,i);const n=this._currentMainCandidate;if(null!=n){const s=this._findOldConstraintInNewCandidates(n,i);if(s>=0){if(!(i[s]instanceof xe))return this._intersectWithOtherCandidates(s,i,e,t,r);if(this._arePointsWithinScreenThreshold(e,n.targetPoint,r))return this._updateSnappingCandidate(n,t,i,r)}}return this._intersectWithOtherCandidates(0,i,e,t,r)}_findOldConstraintInNewCandidates(e,t){return e instanceof xe?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,r,n){const{coordinateHelper:s}=n,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const r=t[l],n=o.constraint.intersect(r.constraint);if(n)for(const e of n.closestPoints(o.targetPoint))a.push([new xe(e,o,r,r.isDraped),this._squaredScreenDistance(i,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(a[0][0],r,t,n):this.options.constraintsActive&&(o instanceof se||o instanceof H.L||o instanceof B||o instanceof pe)?{snappedPoint:i,hints:[]}:this._updateSnappingCandidate(o,r,t,n)}_updateSnappingCandidate(e,t,i,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const n=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of i){if(e instanceof xe){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(n);this._squaredScreenDistance(t,n,r.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=n,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:n,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,A.Bb)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,Y.Rs)(e,t.spatialReference,T.jG,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){i=r;break}return i}get test(){return{visualizationsActive:this.hasHandles(Te),engines:this._engines}}};var De;(0,a._)([(0,c.Cb)({constructOnly:!0})],Ce.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],Ce.prototype,"options",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],Ce.prototype,"updating",null),(0,a._)([(0,c.Cb)()],Ce.prototype,"snappingEnginesFactory",void 0),(0,a._)([(0,c.Cb)()],Ce.prototype,"_engines",void 0),(0,a._)([(0,c.Cb)()],Ce.prototype,"_squaredMouseProximityThreshold",null),(0,a._)([(0,c.Cb)()],Ce.prototype,"_squaredTouchProximityThreshold",null),(0,a._)([(0,c.Cb)()],Ce.prototype,"_squaredSatisfiesConstraintThreshold",null),Ce=(0,a._)([(0,u.j)("esri.views.interactive.snapping.SnappingManager")],Ce),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(De||(De={}));const Te="visualization-handle";function Pe(e){let{coordinateHelper:t,elevationInfo:i}=e;return t.hasZ()?T.jG:i}const Oe=new Map;function je(e){if(!Oe.has(e)){const t=function(e,t){var i,r;const n=new y({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(i=null===t||void 0===t?void 0:t.distance)&&void 0!==i?i:f.c.distance,touchSensitivityMultiplier:null!==(r=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==r?r:f.c.touchSensitivityMultiplier});return{...(0,o.YP)((()=>{var t,i;return null!==(t=null===(i=e.map)||void 0===i||null===(i=i.allLayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]}),(e=>{n.featureSources=new s.Z(e.map((e=>new p({layer:e,enabled:!0}))))}),o.nn),options:n}}(e,{distance:10}),i=function(e,t){return new Ce({view:e,options:t,snappingEnginesFactory:(t,i)=>[new X({view:e,spatialReference:e.spatialReference,options:i})]})}(e,t.options);Oe.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=Oe.get(e);t.referenceCount++;const i=(0,r.kB)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,n.Y)((()=>{0===t.referenceCount&&(t.remove(),Oe.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...i}}},97760:(e,t,i)=>{i.d(t,{k:()=>a});var r=i(44179),n=i(34356),s=i(75691),o=i(53397);class a extends s.a{constructor(e){super({...e,isDraped:!0,constraint:new r.M8(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.w(n.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},95905:(e,t,i)=>{i.d(t,{L:()=>a});var r=i(44179),n=i(34356),s=i(75691),o=i(53397);class a extends s.a{constructor(e){super({...e,constraint:new r.ku(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(n.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75691:(e,t,i)=>{i.d(t,{a:()=>s});var r=i(80371),n=i(92605);class s extends n.j{constructor(e){let{targetPoint:t,objectId:i,constraint:n,isDraped:s}=e;super(t,n,s,r.B.FEATURE),this.objectId=i}}},92605:(e,t,i)=>{i.d(t,{j:()=>r});class r{constructor(e,t,i,r){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=r}}},30541:(e,t,i)=>{i.d(t,{FB:()=>h,RT:()=>u});i(59486);var r=i(47898),n=i(12400),s=i(2170);i(32035),i(96334);(0,n.Ue)();var o=i(94393),a=i(15559),l=i(92975),c=i(47072),d=i(78952);function u(e,t){if(!(0,l.fS)(e.spatialReference,t.spatialReference))return null;const{spatialReference:i}=e;return y[0]=e.x,y[1]=e.y,y[2]=e.hasZ?e.z:0,v[0]=t.x,v[1]=t.y,v[2]=t.hasZ?t.z:0,h(y,v,i)}function h(e,t,i){return(0,c.T)(i,p,f,g,e,t,i)}function p(e,t,i){return(0,r.yG)((0,a.cA)(_,e,t,i).distance,"meters")}function f(e,t,i){return(0,r.yG)((0,s.geodesicLength)(function(e,t,i){return{type:"polyline",spatialReference:i,paths:[[[...e],[...t]]]}}(e,t,i),"meters"),"meters")}function g(e,t,i){return(0,o.k)(e,i,m)&&(0,o.k)(t,i,S)?(0,r.yG)((0,a.cA)(_,m,S,d.Z.WGS84).distance,"meters"):null}const _=new a._q,y=(0,n.Ue)(),v=(0,n.Ue)(),m=(0,n.Ue)(),S=(0,n.Ue)()}}]);
//# sourceMappingURL=60795.41134c2a.chunk.js.map