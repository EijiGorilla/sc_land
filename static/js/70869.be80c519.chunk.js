"use strict";(self.webpackChunksc_land=self.webpackChunksc_land||[]).push([[70869],{70869:(e,t,r)=>{r.r(t),r.d(t,{default:()=>te});var i=r(27366),o=r(76200),s=r(11582),a=r(80987),n=r(10064),l=r(97642),d=r(66978),p=r(35995),u=r(49861),y=(r(93169),r(32718)),c=(r(84936),r(69912)),h=r(30651),f=r(42537),m=r(16054),v=r(77427),b=r(6693),g=r(56811),_=r(45948),C=r(19610),I=r(38186),w=r(7575),L=r(98995),j=r(71486);class F{constructor(e,t){this.objectId=e,this.itemSource=t,this.count=0,this.layer=null,this.sortValue=void 0}}const T=new m.z(20,(e=>e.destroy()));let R=class extends((0,g.M)((0,b.h)((0,l.R)(h.Z)))){constructor(e){super(e),this._oidToReference=new Map,this._layerToReference=new Map,this._portals=new Map,this.layers=new a.Z,this.maximumVisibleSublayers=10,this.opacity=1,this.title="Layers In View",this.type="catalog-dynamic-group",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get _orderBy(){var e,t;return null!==(e=null===(t=this.parent.orderBy)||void 0===t?void 0:t.find((e=>!e.valueExpression&&e.field)))&&void 0!==e?e:new I.Z({field:this.parent.objectIdField})}get _referenceComparator(){const e=this._orderBy,t=this.parent.fieldsIndex.get(e.field),r=(0,j.Lq)(null===t||void 0===t?void 0:t.toJSON().type,"descending"===e.order);return(e,t)=>r(e.sortValue,t.sortValue)||e.objectId-e.objectId}acquireLayer(e){const t=e.getObjectId(),r=(0,v.s1)(this._oidToReference,t,(()=>this._createLayerReference(e)));return r.count++,(0,f.kB)((()=>{r.count--,r.count||this._disposeLayerReference(r)}))}_createLayerReference(e){const t=e.getObjectId(),r=e.getAttribute(this.parent.itemSourceField),i=new F(t,r);if(T.get(r))return this._addLayer(T.pop(r),i,e),i;let o;try{o=JSON.parse(r)}catch(s){return y.Z.getLogger(this).error(s),i}return this._createLayer(o).then((t=>{this.destroyed||0===i.count?(T.get(r)||T.put(i.itemSource,t),i.layer=null):this._addLayer(t,i,e)})).catch((()=>{})),i}_addLayer(e,t,r){this._layerToReference.set(e,t),t.sortValue=r.getAttribute(this._orderBy.field),t.layer=e,e.parent=this,this.layers.add(e),this.layers.sort(((e,t)=>this._referenceComparator(this._layerToReference.get(e),this._layerToReference.get(t))))}_disposeLayerReference(e){e.layer&&(this._layerToReference.delete(e.layer),this.layers.remove(e.layer),T.put(e.itemSource,e.layer)),this._oidToReference.delete(e.objectId)}async _createLayer(e){if(!function(e){return"object"==typeof e&&null!=e&&"itemId"in e&&"portalUrl"in e}(e))return new(await C.T.UnsupportedLayer());const{itemId:t,portalUrl:r}=e,i=(0,v.s1)(this._portals,r,(()=>new w.Z({url:r})));return h.Z.fromPortalItem(new L.default({id:t,portal:i}))}};(0,i._)([(0,u.Cb)()],R.prototype,"_orderBy",null),(0,i._)([(0,u.Cb)()],R.prototype,"_referenceComparator",null),(0,i._)([(0,u.Cb)({readOnly:!0})],R.prototype,"layers",void 0),(0,i._)([(0,u.Cb)()],R.prototype,"maximumVisibleSublayers",void 0),(0,i._)([(0,u.Cb)(_.Oh)],R.prototype,"opacity",void 0),(0,i._)([(0,u.Cb)({type:String,json:{name:"title",write:!0}})],R.prototype,"title",void 0),(0,i._)([(0,u.Cb)({json:{read:!1}})],R.prototype,"type",void 0),(0,i._)([(0,u.Cb)({type:Boolean,json:{name:"visibility",write:!0}})],R.prototype,"visible",void 0),R=(0,i._)([(0,c.j)("esri.layers.catalog.CatalogDynamicGroupLayer")],R);const S=R;var x=r(44055),Z=(r(94931),r(15126),r(98689),r(57823),r(32066),r(49018),r(34999),r(28189),r(9014),r(40464)),O=r(7632),P=r(77748),q=r(85116),V=r(81085);let E=class extends((0,g.M)((0,O.b)((0,b.h)((0,l.R)(h.Z))))){constructor(e){super(e),this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.opacity=1,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.type="catalog-footprint",this.visible=!0}load(e){return this.addResolvingPromise(this.parent.load()),Promise.resolve(this)}get defaultPopupTemplate(){return this.createPopupTemplate()}get fields(){return this.parent.fields}get fieldsIndex(){return this.parent.fieldsIndex}get geometryType(){return this.parent.geometryType}get objectIdField(){return this.parent.objectIdField}get orderBy(){return this.parent.orderBy}createPopupTemplate(e){const t={fields:this.parent.fields,objectIdField:this.parent.objectIdField,title:this.title};return(0,V.eZ)(t,e)}createQuery(){return this.parent.createQuery()}queryFeatures(e,t){return this.parent.queryFeatures(e,t)}};(0,i._)([(0,u.Cb)({readOnly:!0})],E.prototype,"defaultPopupTemplate",null),(0,i._)([(0,u.Cb)({type:[P.Z],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:q.r,write:!0}})],E.prototype,"labelingInfo",void 0),(0,i._)([(0,u.Cb)(_.iR)],E.prototype,"labelsVisible",void 0),(0,i._)([(0,u.Cb)(_.rn)],E.prototype,"legendEnabled",void 0),(0,i._)([(0,u.Cb)(_.Oh)],E.prototype,"opacity",void 0),(0,i._)([(0,u.Cb)(_.C_)],E.prototype,"popupEnabled",void 0),(0,i._)([(0,u.Cb)({type:x.Z,json:{name:"popupInfo",write:!0}})],E.prototype,"popupTemplate",void 0),(0,i._)([(0,u.Cb)({types:Z.A,json:{name:"layerDefinition.drawingInfo.renderer"}})],E.prototype,"renderer",void 0),(0,i._)([(0,u.Cb)({json:{read:!1}})],E.prototype,"type",void 0),(0,i._)([(0,u.Cb)({type:Boolean,json:{name:"visibility",write:!0}})],E.prototype,"visible",void 0),E=(0,i._)([(0,c.j)("esri.layers.catalog.CatalogFootprintLayer")],E);const B=E;var Q=r(27358),N=r(63543),U=r(27961),D=r(11936),J=r(46671),k=r(7436),G=r(6061),M=r(9855),A=r(29598),z=r(71684),K=r(99063),Y=r(62594),H=r(25610),W=r(26704),X=r(21149);const $=(0,H.v)();let ee=class extends((0,k.B)((0,b.h)((0,M.c)((0,K.n)((0,g.M)((0,z.Q)((0,D.Y)((0,G.q)((0,A.I)((0,l.R)((0,J.N)((0,U.V)((0,s.J)(h.Z)))))))))))))){constructor(e){super(e),this.dynamicGroupLayer=new S({parent:this}),this.fields=null,this.fieldsIndex=null,this.footprintLayer=new B({parent:this}),this.itemSourceField="cd_itemsource",this.itemTypeField="cd_itemtype",this.layers=new a.Z([this.dynamicGroupLayer,this.footprintLayer]),this.source=new Q.default({layer:this}),this.type="catalog"}load(e){const t=null!=e?e.signal:null,r=this.loadFromPortal({supportedTypes:["Feature Service"]},e).catch(d.r9).then((async()=>{var e;if(!this.url)throw new n.Z("catalog-layer:missing-url","Catalog layer must be created with a url");if(this.url&&null==this.layerId){const e=await this._fetchFirstValidLayerId(t);if(null==e)throw new n.Z("catalog-layer:missing-layerId","There is no Catalog Layer in the service",{service:this.url});this.layerId=e}await this.source.load(),this.source.sourceJSON&&(this.sourceJSON=this.source.sourceJSON,this.read(this.source.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:null===(e=this.portalItem)||void 0===e?void 0:e.portal,url:this.parsedUrl}))})).then((()=>(0,Y.nU)(this,"load",e)));return this.addResolvingPromise(r),Promise.resolve(this)}get createQueryVersion(){var e;return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(null!==(e=this._get("createQueryVersion"))&&void 0!==e?e:0)+1}get parsedUrl(){const e=(0,p.mN)(this.url);return null!=e&&null!=this.layerId&&(e.path=(0,p.v_)(e.path,this.layerId.toString())),e}createQuery(){var e;const t=new X.Z,r=null===(e=this.capabilities)||void 0===e?void 0:e.query;t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),t.outFields=["*"];const{timeOffset:i,timeExtent:o}=this;return t.timeExtent=null!=i&&null!=o?o.offset(-i.value,i.unit):o||null,t}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var r;return null===(r=this.fieldsIndex.get(e))||void 0===r?void 0:r.domain}async queryFeatures(e,t){var r;const i=await this.load(),o=await i.source.queryFeatures(null!==(r=X.Z.from(e))&&void 0!==r?r:i.createQuery(),t);if(null!==o&&void 0!==o&&o.features)for(const s of o.features)s.layer=s.sourceLayer=i.footprintLayer;return o}async queryObjectIds(e,t){var r;return(await this.load()).source.queryObjectIds(null!==(r=X.Z.from(e))&&void 0!==r?r:this.createQuery(),t)}async queryFeatureCount(e,t){var r;return(await this.load()).source.queryFeatureCount(null!==(r=X.Z.from(e))&&void 0!==r?r:this.createQuery(),t)}async queryExtent(e,t){var r;return(await this.load()).source.queryExtent(null!==(r=X.Z.from(e))&&void 0!==r?r:this.createQuery(),t)}serviceSupportsSpatialReference(e){return this.loaded&&(0,W.D)(this,e)}read(e,t){super.read(e,t);let r=e.footprintLayer;r||"service"!==(null===t||void 0===t?void 0:t.origin)||(r={layerDefinition:{drawingInfo:(0,N.bU)(e.geometryType)}}),this.footprintLayer.read(r,t)}_fetchFirstValidLayerId(e){return(0,o.Z)(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then((e=>{var t;const r=e.data;if(r)return Array.isArray(r.layers)?null===(t=r.layers.find((e=>"Catalog Layer"===e.type)))||void 0===t?void 0:t.id:void 0}))}};(0,i._)([(0,u.Cb)({readOnly:!0})],ee.prototype,"createQueryVersion",null),(0,i._)([(0,u.Cb)({...$.fields,json:{origins:{service:{name:"fields"}}}})],ee.prototype,"fields",void 0),(0,i._)([(0,u.Cb)($.fieldsIndex)],ee.prototype,"fieldsIndex",void 0),(0,i._)([(0,u.Cb)({json:{read:!1,write:!1}})],ee.prototype,"footprintLayer",void 0),(0,i._)([(0,u.Cb)()],ee.prototype,"itemSourceField",void 0),(0,i._)([(0,u.Cb)()],ee.prototype,"itemTypeField",void 0),(0,i._)([(0,u.Cb)()],ee.prototype,"layers",void 0),(0,i._)([(0,u.Cb)({value:"CatalogLayer",type:["CatalogLayer"]})],ee.prototype,"operationalLayerType",void 0),(0,i._)([(0,u.Cb)()],ee.prototype,"outFields",void 0),(0,i._)([(0,u.Cb)({readOnly:!0})],ee.prototype,"parsedUrl",null),(0,i._)([(0,u.Cb)()],ee.prototype,"source",void 0),(0,i._)([(0,u.Cb)({json:{read:!1}})],ee.prototype,"type",void 0),ee=(0,i._)([(0,c.j)("esri.layers.CatalogLayer")],ee);const te=ee}}]);
//# sourceMappingURL=70869.be80c519.chunk.js.map